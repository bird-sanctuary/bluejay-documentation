<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1301px" preserveAspectRatio="none" style="width:633px;height:1301px;" version="1.1" viewBox="0 0 633 1301" width="633px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ki1bf89feu6g" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="140" cy="20" fill="#000000" filter="url(#f1ki1bf89feu6g)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="128" x="76" y="225.0552"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="108" x="86" y="246.1938">Temp7 = *Temp1</text><rect fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="129" x="75.5" y="348.8252"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="109" x="85.5" y="369.9639">GOTO decode_fail</text><polygon fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" points="60,300.4229,220,300.4229,232,312.4229,220,324.4229,60,324.4229,48,312.4229,60,300.4229" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="83" x="144" y="334.6333">Shorter -&gt; Fail</text><ellipse cx="65.5" cy="311.3252" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="151" x="69" y="316.231">Temp1 &lt; Temp6 + Temp2</text><polygon fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" points="140,402.7939,152,414.7939,140,426.7939,128,414.7939,140,402.7939" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="130" x="75" y="446.7939"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110" x="85" y="467.9326">dest = dest &lt;&lt; 1</text><rect fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="78" x="101" y="570.564"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="58" x="111" y="591.7026">dest |= 1</text><polygon fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" points="32,522.1616,248,522.1616,260,534.1616,248,546.1616,32,546.1616,20,534.1616,32,522.1616" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="233" x="144" y="556.3721">Shorter, this is a 1 -&gt; Set lowest bit to 1</text><ellipse cx="37.5" cy="533.064" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="207" x="41" y="537.9697">Temp1 &lt; Temp6 + Temp2 + Temp2</text><polygon fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" points="140,624.5327,152,636.5327,140,648.5327,128,636.5327,140,624.5327" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="82" x="99" y="689.9316"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="62" x="109" y="711.0703">Temp1++</text><rect fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="128" x="76" y="765.2993"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="108" x="86" y="786.438">Temp6 = *Temp1</text><rect fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="129" x="75.5" y="867.6704"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="109" x="85.5" y="888.8091">GOTO decode_fail</text><polygon fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" points="60,819.2681,220,819.2681,232,831.2681,220,843.2681,60,843.2681,48,831.2681,60,819.2681" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="83" x="144" y="853.4785">Shorter -&gt; Fail</text><ellipse cx="65.5" cy="830.1704" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="151" x="69" y="835.0762">Temp1 &lt; Temp7 + Temp2</text><polygon fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" points="140,921.6392,152,933.6392,140,945.6392,128,933.6392,140,921.6392" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="130" x="75" y="965.6392"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110" x="85" y="986.7778">dest = dest &lt;&lt; 1</text><rect fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="78" x="101" y="1089.4092"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="58" x="111" y="1110.5479">dest |= 1</text><polygon fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" points="32,1041.0068,248,1041.0068,260,1053.0068,248,1065.0068,32,1065.0068,20,1053.0068,32,1041.0068" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="233" x="144" y="1075.2173">Shorter, this is a 1 -&gt; Set lowest bit to 1</text><ellipse cx="37.5" cy="1051.9092" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="207" x="41" y="1056.8149">Temp1 &lt; Temp7 + Temp2 + Temp2</text><polygon fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" points="140,1143.3779,152,1155.3779,140,1167.3779,128,1155.3779,140,1143.3779" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f1ki1bf89feu6g)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="82" x="99" y="1208.7769"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="62" x="109" y="1229.9155">Temp1++</text><ellipse cx="140" cy="1273.7456" fill="#FFFFFF" filter="url(#f1ki1bf89feu6g)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="140" cy="1273.7456" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="30" y2="225.0552"/><polygon fill="#A80036" points="136,215.0552,140,225.0552,144,215.0552,140,219.0552" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="163" x="144" y="51.3047">MACRO: Decode DSHOT 2 bit</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="276" x="152" y="64.1094">Used to decode two dshot bit at once in a frame</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="410" x="152" y="76.9141">RX buffer contains time elapsed between two consecutive falling edges.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="374" x="152" y="89.7188">That is the reason why previous bit length is always substracted.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="37" x="144" y="102.5234">Datas:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="157" x="148" y="115.3281">- dest - Restination register</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="359" x="148" y="128.1328">- decode_fail - Jump destination in case decoding is not correct</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="200" x="148" y="140.9375">- Temp1 - Rx timings buffer pointer</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="205" x="148" y="153.7422">- Temp2 - Dshot pulse width criteria</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="376" x="148" y="166.5469">- Temp6 - First bit's previous timestamp (stores for next two bits)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="247" x="148" y="179.3516">- Temp7 - Second bit's previous timestamp</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="148" y="192.1563"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="195" x="144" y="204.9609">Store next bit previous timestamp</text><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="324.4229" y2="348.8252"/><polygon fill="#A80036" points="136,338.8252,140,348.8252,144,338.8252,140,342.8252" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="232" x2="244" y1="312.4229" y2="312.4229"/><polygon fill="#A80036" points="240,355.8096,244,365.8096,248,355.8096,244,359.8096" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="244" x2="244" y1="312.4229" y2="414.7939"/><line style="stroke:#A80036;stroke-width:1.5;" x1="244" x2="152" y1="414.7939" y2="414.7939"/><polygon fill="#A80036" points="162,410.7939,152,414.7939,162,418.7939,158,414.7939" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="382.7939" y2="402.7939"/><polygon fill="#A80036" points="136,392.7939,140,402.7939,144,392.7939,140,396.7939" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="259.0239" y2="300.4229"/><polygon fill="#A80036" points="136,290.4229,140,300.4229,144,290.4229,140,294.4229" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="231" x="144" y="280.3286">Check bit length is longer than minimum</text><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="426.7939" y2="446.7939"/><polygon fill="#A80036" points="136,436.7939,140,446.7939,144,436.7939,140,440.7939" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="546.1616" y2="570.564"/><polygon fill="#A80036" points="136,560.564,140,570.564,144,560.564,140,564.564" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="260" x2="272" y1="534.1616" y2="534.1616"/><polygon fill="#A80036" points="268,577.5483,272,587.5483,276,577.5483,272,581.5483" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272" x2="272" y1="534.1616" y2="636.5327"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272" x2="152" y1="636.5327" y2="636.5327"/><polygon fill="#A80036" points="162,632.5327,152,636.5327,162,640.5327,158,636.5327" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="604.5327" y2="624.5327"/><polygon fill="#A80036" points="136,614.5327,140,624.5327,144,614.5327,140,618.5327" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="480.7627" y2="522.1616"/><polygon fill="#A80036" points="136,512.1616,140,522.1616,144,512.1616,140,516.1616" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="477" x="144" y="502.0674">Check if time between two consecutive falling edges is smaller than the one for a 0</text><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="648.5327" y2="689.9316"/><polygon fill="#A80036" points="136,679.9316,140,689.9316,144,679.9316,140,683.9316" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="146" x="144" y="669.8374">Increase rx buffer pointer</text><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="723.9004" y2="765.2993"/><polygon fill="#A80036" points="136,755.2993,140,765.2993,144,755.2993,140,759.2993" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="195" x="144" y="745.2051">Store next bit previous timestamp</text><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="843.2681" y2="867.6704"/><polygon fill="#A80036" points="136,857.6704,140,867.6704,144,857.6704,140,861.6704" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="232" x2="244" y1="831.2681" y2="831.2681"/><polygon fill="#A80036" points="240,874.6548,244,884.6548,248,874.6548,244,878.6548" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="244" x2="244" y1="831.2681" y2="933.6392"/><line style="stroke:#A80036;stroke-width:1.5;" x1="244" x2="152" y1="933.6392" y2="933.6392"/><polygon fill="#A80036" points="162,929.6392,152,933.6392,162,937.6392,158,933.6392" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="901.6392" y2="921.6392"/><polygon fill="#A80036" points="136,911.6392,140,921.6392,144,911.6392,140,915.6392" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="799.2681" y2="819.2681"/><polygon fill="#A80036" points="136,809.2681,140,819.2681,144,809.2681,140,813.2681" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="945.6392" y2="965.6392"/><polygon fill="#A80036" points="136,955.6392,140,965.6392,144,955.6392,140,959.6392" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="1065.0068" y2="1089.4092"/><polygon fill="#A80036" points="136,1079.4092,140,1089.4092,144,1079.4092,140,1083.4092" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="260" x2="272" y1="1053.0068" y2="1053.0068"/><polygon fill="#A80036" points="268,1096.3936,272,1106.3936,276,1096.3936,272,1100.3936" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272" x2="272" y1="1053.0068" y2="1155.3779"/><line style="stroke:#A80036;stroke-width:1.5;" x1="272" x2="152" y1="1155.3779" y2="1155.3779"/><polygon fill="#A80036" points="162,1151.3779,152,1155.3779,162,1159.3779,158,1155.3779" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="1123.3779" y2="1143.3779"/><polygon fill="#A80036" points="136,1133.3779,140,1143.3779,144,1133.3779,140,1137.3779" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="999.6079" y2="1041.0068"/><polygon fill="#A80036" points="136,1031.0068,140,1041.0068,144,1031.0068,140,1035.0068" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="477" x="144" y="1020.9126">Check if time between two consecutive falling edges is smaller than the one for a 0</text><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="1167.3779" y2="1208.7769"/><polygon fill="#A80036" points="136,1198.7769,140,1208.7769,144,1198.7769,140,1202.7769" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="146" x="144" y="1188.6826">Increase rx buffer pointer</text><line style="stroke:#A80036;stroke-width:1.5;" x1="140" x2="140" y1="1242.7456" y2="1262.7456"/><polygon fill="#A80036" points="136,1252.7456,140,1262.7456,144,1252.7456,140,1256.7456" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[1ad289d6699eb0c53f30499f6105712a]
@startuml 
start
->MACRO: Decode DSHOT 2 bit
  Used to decode two dshot bit at once in a frame
  RX buffer contains time elapsed between two consecutive falling edges.
  That is the reason why previous bit length is always substracted.
Datas:
 - dest - Restination register
 - decode_fail - Jump destination in case decoding is not correct
 - Temp1 - Rx timings buffer pointer
 - Temp2 - Dshot pulse width criteria
 - Temp6 - First bit's previous timestamp (stores for next two bits)
 - Temp7 - Second bit's previous timestamp
 
Store next bit previous timestamp;
:Temp7 = *Temp1;
->Check bit length is longer than minimum;
if (*Temp1 < Temp6 + Temp2) then
  ->Shorter -> Fail;
  :GOTO decode_fail;
endif
:dest = dest << 1;
->Check if time between two consecutive falling edges is smaller than the one for a 0;
if (*Temp1 < Temp6 + Temp2 + Temp2) then
  ->Shorter, this is a 1 -> Set lowest bit to 1;
  :dest |= 1;
endif

->Increase rx buffer pointer;
:Temp1++;

->Store next bit previous timestamp;
:Temp6 = *Temp1;
if (*Temp1 < Temp7 + Temp2) then
  ->Shorter -> Fail;
  :GOTO decode_fail;
endif
:dest = dest << 1;
->Check if time between two consecutive falling edges is smaller than the one for a 0;
if (*Temp1 < Temp7 + Temp2 + Temp2) then
  ->Shorter, this is a 1 -> Set lowest bit to 1;
  :dest |= 1;
endif

->Increase rx buffer pointer;
:Temp1++;
stop
@enduml

PlantUML version 1.2021.5(Sun Apr 25 13:20:28 CEST 2021)
(EPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: es
Country: ES
--></g></svg>
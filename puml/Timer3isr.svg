<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="815px" preserveAspectRatio="none" style="width:739px;height:815px;" version="1.1" viewBox="0 0 739 815" width="739px" zoomAndPan="magnify"><defs><filter height="300%" id="fpy4zzlennu60" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="96" cy="20" fill="#000000" filter="url(#fpy4zzlennu60)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#fpy4zzlennu60)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="72" x="60" y="237.8599"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="52" x="70" y="258.9985">clr IE_EA</text><rect fill="#FEFECE" filter="url(#fpy4zzlennu60)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="104" x="44" y="313.2275"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="54" y="334.3662">EIE1 &amp;= 0x7F</text><rect fill="#FEFECE" filter="url(#fpy4zzlennu60)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="135" x="28.5" y="388.5952"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="115" x="38.5" y="409.7339">TMR3CN0 &amp;= 0x7F</text><rect fill="#FEFECE" filter="url(#fpy4zzlennu60)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="120" x="36" y="463.9629"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="100" x="46" y="485.1016">TMR3RLL = 0xFA</text><rect fill="#FEFECE" filter="url(#fpy4zzlennu60)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="122" x="35" y="517.9316"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="102" x="45" y="539.0703">TMR3RLH = 0xFF</text><rect fill="#FEFECE" filter="url(#fpy4zzlennu60)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="170" x="11" y="593.2993"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="150" x="21" y="614.438">clr Flag_Timer3_Pending</text><rect fill="#FEFECE" filter="url(#fpy4zzlennu60)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="77" x="57.5" y="668.667"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="57" x="67.5" y="689.8057">set IE_EA</text><rect fill="#FEFECE" filter="url(#fpy4zzlennu60)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="41" x="75.5" y="722.6357"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="21" x="85.5" y="743.7744">reti</text><ellipse cx="96" cy="787.6045" fill="#FFFFFF" filter="url(#fpy4zzlennu60)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="96" cy="787.6045" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="96" x2="96" y1="30" y2="237.8599"/><polygon fill="#A80036" points="92,227.8599,96,237.8599,100,227.8599,96,231.8599" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="137" x="100" y="51.3047">Timer3 interrupt routine</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="177" x="108" y="64.1094">Used for commutation timming</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="37" x="100" y="76.9141">Datas:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="283" x="104" y="89.7188">- Timer2_X - Counter that increments every 32ms</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="389" x="104" y="102.5234">- Flag_32ms_Elapsed - Flag triggered when 32ms elapses in timer 2</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="602" x="104" y="115.3281">- Rcp_Timeout_Cntd - RC Pulse Timeout counter is set to 10 each time a rc pulse is processed in timer 1,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="359" x="112" y="128.1328">after 320ms without receiving rc pulses in timer 1 it is set to 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="623" x="104" y="140.9375">- Flag_Rcp_Stop - It is set when rc pulse read in timer 1 is 0 or when Rcp_Timeout_Cntd is timed out (320ms)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="502" x="104" y="153.7422">- Rcp_Stop_Cnt - Counts the number of 32ms cycles rc pulse is 0 (Flag_Rcp_Stop == 1).</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="538" x="112" y="166.5469">Needed to enter run mode during 320ms (value 10) and exit run mode during 100ms (value 3)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="112" y="179.3516"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="112" y="192.1563"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="119" x="100" y="204.9609">Disable all interrupts</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="104" y="217.7656"/><line style="stroke:#A80036;stroke-width:1.5;" x1="96" x2="96" y1="271.8286" y2="313.2275"/><polygon fill="#A80036" points="92,303.2275,96,313.2275,100,303.2275,96,307.2275" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="146" x="100" y="293.1333">Disable Timer3 interrupts</text><line style="stroke:#A80036;stroke-width:1.5;" x1="96" x2="96" y1="347.1963" y2="388.5952"/><polygon fill="#A80036" points="92,378.5952,96,388.5952,100,378.5952,96,382.5952" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="152" x="100" y="368.501">Clear Timer3 interrupt flag</text><line style="stroke:#A80036;stroke-width:1.5;" x1="96" x2="96" y1="422.564" y2="463.9629"/><polygon fill="#A80036" points="92,453.9629,96,463.9629,100,453.9629,96,457.9629" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="254" x="100" y="443.8687">Short delay to avoid re-loading regular delay</text><line style="stroke:#A80036;stroke-width:1.5;" x1="96" x2="96" y1="497.9316" y2="517.9316"/><polygon fill="#A80036" points="92,507.9316,96,517.9316,100,507.9316,96,511.9316" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="96" x2="96" y1="551.9004" y2="593.2993"/><polygon fill="#A80036" points="92,583.2993,96,593.2993,100,583.2993,96,587.2993" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="161" x="100" y="573.2051">Flag that timer has wrapped</text><line style="stroke:#A80036;stroke-width:1.5;" x1="96" x2="96" y1="627.2681" y2="668.667"/><polygon fill="#A80036" points="92,658.667,96,668.667,100,658.667,96,662.667" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="115" x="100" y="648.5728">Enable all interrupts</text><line style="stroke:#A80036;stroke-width:1.5;" x1="96" x2="96" y1="702.6357" y2="722.6357"/><polygon fill="#A80036" points="92,712.6357,96,722.6357,100,712.6357,96,716.6357" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="96" x2="96" y1="756.6045" y2="776.6045"/><polygon fill="#A80036" points="92,766.6045,96,776.6045,100,766.6045,96,770.6045" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[69c4252bbe23b3f875d1bfdb28904071]
@startuml 
start
->Timer3 interrupt routine
  Used for commutation timming
Datas:
 - Timer2_X - Counter that increments every 32ms
 - Flag_32ms_Elapsed - Flag triggered when 32ms elapses in timer 2
 - Rcp_Timeout_Cntd - RC Pulse Timeout counter is set to 10 each time a rc pulse is processed in timer 1,
   after 320ms without receiving rc pulses in timer 1 it is set to 0
 - Flag_Rcp_Stop - It is set when rc pulse read in timer 1 is 0 or when Rcp_Timeout_Cntd is timed out (320ms)
 - Rcp_Stop_Cnt - Counts the number of 32ms cycles rc pulse is 0 (Flag_Rcp_Stop == 1).
   Needed to enter run mode during 320ms (value 10) and exit run mode during 100ms (value 3)
   
   
Disable all interrupts
 ;
:clr IE_EA;
->Disable Timer3 interrupts;
:EIE1 &= 0x7F;
->Clear Timer3 interrupt flag;
:TMR3CN0 &= 0x7F;
->Short delay to avoid re-loading regular delay;
:TMR3RLL = 0xFA;
:TMR3RLH = 0xFF;
->Flag that timer has wrapped;
:clr Flag_Timer3_Pending;
->Enable all interrupts;
:set IE_EA;
:reti;
stop
@enduml

PlantUML version 1.2021.5(Sun Apr 25 13:20:28 CEST 2021)
(EPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: es
Country: ES
--></g></svg>
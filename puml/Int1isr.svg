<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="727px" preserveAspectRatio="none" style="width:585px;height:727px;" version="1.1" viewBox="0 0 585 727" width="585px" zoomAndPan="magnify"><defs><filter height="300%" id="ftzkd07t7bv3z" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="118.5" cy="20" fill="#000000" filter="url(#ftzkd07t7bv3z)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#ftzkd07t7bv3z)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="86" x="75.5" y="186.6411"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="66" x="85.5" y="207.7798">IE_EX1 = 0</text><rect fill="#FEFECE" filter="url(#ftzkd07t7bv3z)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="108" x="64.5" y="262.0088"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="88" x="74.5" y="283.1475">TCON_TR1 = 1</text><rect fill="#FEFECE" filter="url(#ftzkd07t7bv3z)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="133" x="52" y="375.7905"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="62" y="396.9292">TMR2CN0_TR2 = 0</text><rect fill="#FEFECE" filter="url(#ftzkd07t7bv3z)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="209" x="14" y="451.1582"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="189" x="24" y="472.2969">DShot_Frame_Start_L = TMR2L</text><rect fill="#FEFECE" filter="url(#ftzkd07t7bv3z)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="215" x="11" y="505.127"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="195" x="21" y="526.2656">DShot_Frame_Start_H = TMR2H</text><rect fill="#FEFECE" filter="url(#ftzkd07t7bv3z)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="133" x="52" y="580.4946"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="62" y="601.6333">TMR2CN0_TR2 = 1</text><rect fill="#FEFECE" filter="url(#ftzkd07t7bv3z)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="41" x="98" y="634.4634"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="21" x="108" y="655.6021">reti</text><ellipse cx="118.5" cy="699.4321" fill="#FFFFFF" filter="url(#ftzkd07t7bv3z)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="118.5" cy="699.4321" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="118.5" x2="118.5" y1="30" y2="186.6411"/><polygon fill="#A80036" points="114.5,176.6411,118.5,186.6411,122.5,176.6411,118.5,180.6411" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="122" x="122.5" y="51.3047">Int1 interrupt routine.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="122.5" y="64.1094">Used for RC pulse timing</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="126.5" y="76.9141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="37" x="122.5" y="89.7188">Datas:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="128" x="126.5" y="102.5234">- Uses register bank 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="401" x="126.5" y="115.3281">- Temp1 - Rx buffer pointer, that contains times between falling edges</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="375" x="126.5" y="128.1328">- TL0 - Timer 0 low byte. Contains time between two falling edges</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="402" x="126.5" y="140.9375">- TL1 - Timer 1 low byte. To be loaded with DShot_Timer_Preset value.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="126.5" y="153.7422"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="133" x="122.5" y="166.5469">-&gt;Disable Int1 interrupt</text><line style="stroke:#A80036;stroke-width:1.5;" x1="118.5" x2="118.5" y1="220.6099" y2="262.0088"/><polygon fill="#A80036" points="114.5,252.0088,118.5,262.0088,122.5,252.0088,118.5,256.0088" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="73" x="122.5" y="241.9146">Start timer 1</text><line style="stroke:#A80036;stroke-width:1.5;" x1="118.5" x2="118.5" y1="295.9775" y2="375.7905"/><polygon fill="#A80036" points="114.5,365.7905,118.5,375.7905,122.5,365.7905,118.5,369.7905" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="451" x="122.5" y="317.2822">Note: Interrupts are not explicitly disabled, assuming higher priority interrupts:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="205" x="122.5" y="330.0869">- Timer0 to be disabled at this point</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="234" x="122.5" y="342.8916">- Int0 to not trigger for valid DShot signal</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="87" x="122.5" y="355.6963">Disable timer 2</text><line style="stroke:#A80036;stroke-width:1.5;" x1="118.5" x2="118.5" y1="409.7593" y2="451.1582"/><polygon fill="#A80036" points="114.5,441.1582,118.5,451.1582,122.5,441.1582,118.5,445.1582" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="110" x="122.5" y="431.064">Store timer 2 value</text><line style="stroke:#A80036;stroke-width:1.5;" x1="118.5" x2="118.5" y1="485.127" y2="505.127"/><polygon fill="#A80036" points="114.5,495.127,118.5,505.127,122.5,495.127,118.5,499.127" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="118.5" x2="118.5" y1="539.0957" y2="580.4946"/><polygon fill="#A80036" points="114.5,570.4946,118.5,580.4946,122.5,570.4946,118.5,574.4946" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="83" x="122.5" y="560.4004">Enable timer 2</text><line style="stroke:#A80036;stroke-width:1.5;" x1="118.5" x2="118.5" y1="614.4634" y2="634.4634"/><polygon fill="#A80036" points="114.5,624.4634,118.5,634.4634,122.5,624.4634,118.5,628.4634" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="118.5" x2="118.5" y1="668.4321" y2="688.4321"/><polygon fill="#A80036" points="114.5,678.4321,118.5,688.4321,122.5,678.4321,118.5,682.4321" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[4f4ef16932502dff3962a94f723a6bc2]
@startuml 
start
->Int1 interrupt routine.
Used for RC pulse timing
 
Datas:
 - Uses register bank 1
 - Temp1 - Rx buffer pointer, that contains times between falling edges
 - TL0 - Timer 0 low byte. Contains time between two falling edges
 - TL1 - Timer 1 low byte. To be loaded with DShot_Timer_Preset value. 

->Disable Int1 interrupt;
:IE_EX1 = 0;
->Start timer 1;
:TCON_TR1 = 1;
->Note: Interrupts are not explicitly disabled, assuming higher priority interrupts:
- Timer0 to be disabled at this point
- Int0 to not trigger for valid DShot signal
Disable timer 2;
:TMR2CN0_TR2 = 0;
->Store timer 2 value;
:DShot_Frame_Start_L = TMR2L; 
:DShot_Frame_Start_H = TMR2H;
->Enable timer 2;
:TMR2CN0_TR2 = 1;
:reti;
stop
@enduml

PlantUML version 1.2021.5(Sun Apr 25 13:20:28 CEST 2021)
(EPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: es
Country: ES
--></g></svg>
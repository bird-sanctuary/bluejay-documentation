<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="816px" preserveAspectRatio="none" style="width:529px;height:816px;" version="1.1" viewBox="0 0 529 816" width="529px" zoomAndPan="magnify"><defs><filter height="300%" id="frxqhdvijqyaq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="103" cy="20" fill="#000000" filter="url(#frxqhdvijqyaq)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#frxqhdvijqyaq)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="79" x="63.5" y="161.0317"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="59" x="73.5" y="182.1704">push ACC</text><rect fill="#FEFECE" filter="url(#frxqhdvijqyaq)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="67" x="69.5" y="236.3994"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="47" x="79.5" y="257.5381">A = TL0</text><rect fill="#FEFECE" filter="url(#frxqhdvijqyaq)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="184" x="11" y="311.7671"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="164" x="21" y="332.9058">TL1 = DShot_Timer_Preset</text><rect fill="#FEFECE" filter="url(#frxqhdvijqyaq)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="82" x="62" y="399.9395"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="62" x="72" y="421.0781">push PSW</text><rect fill="#FEFECE" filter="url(#frxqhdvijqyaq)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="95" x="55.5" y="453.9082"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="75" x="65.5" y="475.0469">PSW = 0x08</text><rect fill="#FEFECE" filter="url(#frxqhdvijqyaq)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="99" x="53.5" y="507.877"/><ellipse cx="69" cy="524.3457" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="74.5" y="529.0156">Temp1 = A</text><rect fill="#FEFECE" filter="url(#frxqhdvijqyaq)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="82" x="62" y="561.8457"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="62" x="72" y="582.9844">Temp1++</text><rect fill="#FEFECE" filter="url(#frxqhdvijqyaq)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="75" x="65.5" y="615.8145"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="55" x="75.5" y="636.9531">pop PSW</text><rect fill="#FEFECE" filter="url(#frxqhdvijqyaq)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="72" x="67" y="669.7832"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="52" x="77" y="690.9219">pop ACC</text><rect fill="#FEFECE" filter="url(#frxqhdvijqyaq)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="41" x="82.5" y="723.752"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="21" x="92.5" y="744.8906">reti</text><ellipse cx="103" cy="788.7207" fill="#FFFFFF" filter="url(#frxqhdvijqyaq)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="103" cy="788.7207" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="103" x2="103" y1="30" y2="161.0317"/><polygon fill="#A80036" points="99,151.0317,103,161.0317,107,151.0317,103,155.0317" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="353" x="107" y="51.3047">Int0 interrupt routine. Triggered when a falling edge happens.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="111" y="64.1094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="37" x="107" y="76.9141">Datas:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="128" x="111" y="89.7188">- Uses register bank 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="401" x="111" y="102.5234">- Temp1 - Rx buffer pointer, that contains times between falling edges</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="375" x="111" y="115.3281">- TL0 - Timer 0 low byte. Contains time between two falling edges</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="402" x="111" y="128.1328">- TL1 - Timer 1 low byte. To be loaded with DShot_Timer_Preset value.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="111" y="140.9375"/><line style="stroke:#A80036;stroke-width:1.5;" x1="103" x2="103" y1="195.0005" y2="236.3994"/><polygon fill="#A80036" points="99,226.3994,103,236.3994,107,226.3994,103,230.3994" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="124" x="107" y="216.3052">Read timer 0 low byte</text><line style="stroke:#A80036;stroke-width:1.5;" x1="103" x2="103" y1="270.3682" y2="311.7671"/><polygon fill="#A80036" points="99,301.7671,103,311.7671,107,301.7671,103,305.7671" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="288" x="107" y="291.6729">Set timer 1 low byte to reset / synchronize timer 1</text><line style="stroke:#A80036;stroke-width:1.5;" x1="103" x2="103" y1="345.7358" y2="399.9395"/><polygon fill="#A80036" points="99,389.9395,103,399.9395,107,389.9395,103,393.9395" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="204" x="107" y="367.0405">Store timer 0 edge time in rx buffer</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="275" x="107" y="379.8452">Temp1 in register bank 1 points to pwm timings</text><line style="stroke:#A80036;stroke-width:1.5;" x1="103" x2="103" y1="433.9082" y2="453.9082"/><polygon fill="#A80036" points="99,443.9082,103,453.9082,107,443.9082,103,447.9082" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="103" x2="103" y1="487.877" y2="507.877"/><polygon fill="#A80036" points="99,497.877,103,507.877,107,497.877,103,501.877" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="103" x2="103" y1="541.8457" y2="561.8457"/><polygon fill="#A80036" points="99,551.8457,103,561.8457,107,551.8457,103,555.8457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="103" x2="103" y1="595.8145" y2="615.8145"/><polygon fill="#A80036" points="99,605.8145,103,615.8145,107,605.8145,103,609.8145" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="103" x2="103" y1="649.7832" y2="669.7832"/><polygon fill="#A80036" points="99,659.7832,103,669.7832,107,659.7832,103,663.7832" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="103" x2="103" y1="703.752" y2="723.752"/><polygon fill="#A80036" points="99,713.752,103,723.752,107,713.752,103,717.752" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="103" x2="103" y1="757.7207" y2="777.7207"/><polygon fill="#A80036" points="99,767.7207,103,777.7207,107,767.7207,103,771.7207" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[e83259de0cd507f57f2263d955dca9d6]
@startuml 
start
->Int0 interrupt routine. Triggered when a falling edge happens. 

Datas:
 - Uses register bank 1
 - Temp1 - Rx buffer pointer, that contains times between falling edges
 - TL0 - Timer 0 low byte. Contains time between two falling edges
 - TL1 - Timer 1 low byte. To be loaded with DShot_Timer_Preset value. 
 ;
:push ACC;
->Read timer 0 low byte;
:A = TL0;
->Set timer 1 low byte to reset / synchronize timer 1;
:TL1 = DShot_Timer_Preset;
->Store timer 0 edge time in rx buffer
Temp1 in register bank 1 points to pwm timings;
:push PSW;
:PSW = 0x08;
:*Temp1 = A;
:Temp1++;
:pop PSW;
:pop ACC;
:reti;
stop
@enduml

PlantUML version 1.2021.5(Sun Apr 25 13:20:28 CEST 2021)
(EPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: es
Country: ES
--></g></svg>
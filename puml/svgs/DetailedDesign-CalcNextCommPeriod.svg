<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="14062px" preserveAspectRatio="none" style="width:3120px;height:14062px;background:#FFFFFF;" version="1.1" viewBox="0 0 3120 14062" width="3120px" zoomAndPan="magnify"><defs/><g><ellipse cx="1604.1875" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="79" x="1564.6875" y="161.0317"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="59" x="1574.6875" y="182.1704">IE_EA = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="133" x="1537.6875" y="215.0005"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="1547.6875" y="236.1392">TMR2CN0_TR2 = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="1544.6875" y="268.9692"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="99" x="1554.6875" y="290.1079">Temp1 = TMR2L</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="1543.1875" y="322.938"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="102" x="1553.1875" y="344.0767">Temp2 = TMR2H</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="135" x="1536.6875" y="376.9067"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="115" x="1546.6875" y="398.0454">Temp3 = Timer2_X</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="1563.1875" y="500.6768"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="62" x="1573.1875" y="521.8154">Temp3++</text><polygon fill="#F1F1F1" points="1544.1875,452.2744,1664.1875,452.2744,1676.1875,464.2744,1664.1875,476.2744,1544.1875,476.2744,1532.1875,464.2744,1544.1875,452.2744" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="313" x="1608.1875" y="486.4849">yes -&gt; If it is pending, then timer has already wrapped</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="120" x="1544.1875" y="468.0825">TMR2CN0_TF2H == 1</text><polygon fill="#F1F1F1" points="1604.1875,554.6455,1616.1875,566.6455,1604.1875,578.6455,1592.1875,566.6455,1604.1875,554.6455" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="79" x="1564.6875" y="620.0444"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="59" x="1574.6875" y="641.1831">IE_EA = 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="133" x="1537.6875" y="674.0132"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="1547.6875" y="695.1519">TMR2CN0_TR2 = 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1549.6875" y="776.3843"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1559.6875" y="797.5229">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1489.6875" y="830.353"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1499.6875" y="851.4917">Temp3 = CARRY_BIT::Temp3 &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1489.6875" y="899.3218"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1499.6875" y="920.4604">Temp2 = CARRY_BIT::Temp2 &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1489.6875" y="953.2905"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1499.6875" y="974.4292">Temp1 = CARRY_BIT::Temp1 &gt;&gt; 1</text><polygon fill="#F1F1F1" points="1552.1875,727.9819,1656.1875,727.9819,1668.1875,739.9819,1656.1875,751.9819,1552.1875,751.9819,1540.1875,739.9819,1552.1875,727.9819" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="131" x="1608.1875" y="762.1924">yes -&gt; divide time by 2</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="1552.1875" y="743.79">MCU_48MHZ == 1</text><polygon fill="#F1F1F1" points="1604.1875,1007.2593,1616.1875,1019.2593,1604.1875,1031.2593,1592.1875,1019.2593,1604.1875,1007.2593" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="1531.6875,1051.2593,1676.6875,1051.2593,1688.6875,1063.2593,1676.6875,1075.2593,1531.6875,1075.2593,1519.6875,1063.2593,1531.6875,1051.2593" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="1531.6875" y="1067.0674">Flag_Startup_Phase == 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="225" x="1294.6875" y="1060.665">yes -&gt; Calculate this commutation time</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="219" x="1688.6875" y="1060.665">no -&gt; Calculate this commutation time</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="569.375" y="1085.2593"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="579.375" y="1106.3979">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="579.875" y="1139.228"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="589.875" y="1160.3667">A = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="149" x="549.375" y="1193.1968"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="129" x="559.375" y="1214.3354">A = A - Prev_Comm_L</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="542.375" y="1268.5645"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="143" x="552.375" y="1289.7031">Prev_Comm_L = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="579.875" y="1343.9321"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="589.875" y="1365.0708">Temp1 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="579.875" y="1410.7056"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="589.875" y="1431.8442">A = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="243" x="502.375" y="1479.6743"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="223" x="512.375" y="1500.813">A = A - (Prev_Comm_H + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="166" x="540.875" y="1555.042"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="146" x="550.875" y="1576.1807">Prev_Comm_H = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="101" x="573.375" y="1665.8154"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81" x="583.375" y="1686.9541">A = A &amp; 0x7F</text><polygon fill="#F1F1F1" points="571.875,1621.8154,675.875,1621.8154,687.875,1633.8154,675.875,1645.8154,571.875,1645.8154,559.875,1633.8154,571.875,1621.8154" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="571.875" y="1637.6235">MCU_48MHZ == 1</text><polygon fill="#F1F1F1" points="623.875,1723.7842,635.875,1735.7842,623.875,1747.7842,611.875,1735.7842,623.875,1723.7842" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="579.875" y="1795.5889"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="589.875" y="1816.7275">Temp2 = A</text><polygon fill="#F1F1F1" points="564.875,1900.894,682.875,1900.894,694.875,1912.894,682.875,1924.894,564.875,1924.894,552.875,1912.894,564.875,1900.894" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="118" x="564.875" y="1916.7021">Flag_High_Rpm == 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="92" x="263.875" y="1871.8857">yes -&gt; high RPM</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="274" x="263.875" y="1884.6904">Fast calculation (Comm_Period4x_H less than 2)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="289" x="263.875" y="1897.4951">Comm_Period4x holds the time of 4 commutations</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="171" x="263.875" y="1910.2998">(calc_next_comm_period_fast)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="102" x="694.875" y="1884.6904">no -&gt; normal RPM</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="290" x="694.875" y="1897.4951">Prepare averaging by dividing Comm_Period4x and</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="334" x="694.875" y="1910.2998">current commutation period (Temp2/1) according to speed</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="61" y="1934.894"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="170" x="71" y="1956.0327">Temp3 = Comm_Period4x_L</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="193" x="59.5" y="1999.8628"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="173" x="69.5" y="2021.0015">Temp4 = Comm_Period4x_H</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="290" x="11" y="2081.6362"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="117" x="21" y="2102.7749">Divide_12Bit_By_16</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="142" x="149" y="2102.7749">Temp4, Temp3, Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="101.5" y="2163.4097"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="111.5" y="2184.5483">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="112" y="2232.3784"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="122" y="2253.5171">A = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="102" y="2301.3472"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="88" x="112" y="2322.4858">A = A - Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="112" y="2370.3159"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="122" y="2391.4546">Temp3 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="112" y="2432.9883"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="122" y="2454.127">A = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="73.5" y="2501.957"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="83.5" y="2523.0957">A = A - (0 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="112" y="2570.9258"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="122" y="2592.0645">Temp4 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="112" y="2652.6992"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="122" y="2673.8379">A = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="111" y="2721.668"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="70" x="121" y="2742.8066">A = A &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="111" y="2790.6367"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="70" x="121" y="2811.7754">A = A &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="101" x="105.5" y="2859.6055"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81" x="115.5" y="2880.7441">A = A &amp; 0x3F</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="99" y="2941.3789"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="94" x="109" y="2962.5176">A = A + Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="171" x="70.5" y="3010.3477"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="151" x="80.5" y="3031.4863">A = A + (0 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="112" y="3079.3164"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="122" y="3100.4551">Temp4 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="61" y="3161.0898"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="170" x="71" y="3182.2285">Comm_Period4x_L = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="193" x="59.5" y="3230.0586"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="173" x="69.5" y="3251.1973">Comm_Period4x_H = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="101.5" y="3311.832"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="111.5" y="3332.9707">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="119" y="3380.8008"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="54" x="129" y="3401.9395">A = A - 2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="86.5" y="3498.1719"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="119" x="96.5" y="3519.3105">Flag_High_Rpm = 0</text><polygon fill="#F1F1F1" points="109.5,3449.7695,202.5,3449.7695,214.5,3461.7695,202.5,3473.7695,109.5,3473.7695,97.5,3461.7695,109.5,3449.7695" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="160" y="3483.98">Yes - Clear high rpm bit</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="109.5" y="3465.5776">CARRY_BIT == 1</text><polygon fill="#F1F1F1" points="156,3556.543,168,3568.543,156,3580.543,144,3568.543,156,3556.543" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="112" y="3628.3477"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="122" y="3649.4863">A = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="112" y="3722.9258"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="122" y="3744.0645">Temp7 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="112" y="3800.52"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="122" y="3821.6587">Temp4 = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="112" y="3869.4888"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="122" y="3890.6274">A = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="101" x="105.5" y="3964.0669"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81" x="115.5" y="3985.2056">A = A &amp; 0x0F</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="108" x="102" y="4033.0356"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="88" x="112" y="4054.1743">A = A | Temp7</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="101.5" y="4114.8091"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="111.5" y="4135.9478">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="119" y="4183.7778"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="54" x="129" y="4204.9165">A = A - 2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="112" y="4252.7466"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="122" y="4273.8853">Temp3 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="112" y="4389.3247"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="122" y="4410.4634">Temp3 = 1</text><polygon fill="#F1F1F1" points="109.5,4334.52,202.5,4334.52,214.5,4346.52,202.5,4358.52,109.5,4358.52,97.5,4346.52,109.5,4334.52" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="190" x="160" y="4368.7305">yes -&gt; Set minimum waiting time</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="208" x="160" y="4381.5352">(Timers cannot wait for a delay of 0)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="109.5" y="4350.3281">CARRY_BIT == 1</text><polygon fill="#F1F1F1" points="156,4454.0981,168,4466.0981,156,4478.0981,144,4466.0981,156,4454.0981" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="996.75" y="1934.894"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="170" x="1006.75" y="1956.0327">Temp3 = Comm_Period4x_L</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="193" x="995.25" y="1999.8628"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="173" x="1005.25" y="2021.0015">Temp4 = Comm_Period4x_H</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1037.25" y="2068.8315"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1047.25" y="2089.9702">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1047.75" y="2137.8003"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1057.75" y="2158.939">A = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="1054.75" y="2206.769"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="54" x="1064.75" y="2227.9077">A = A - 4</text><polygon fill="#F1F1F1" points="1045.25,2341.3706,1138.25,2341.3706,1150.25,2353.3706,1138.25,2365.3706,1045.25,2365.3706,1033.25,2353.3706,1045.25,2341.3706" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="1045.25" y="2357.1787">CARRY_BIT == 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="217" x="699.25" y="2312.3623">yes -&gt; Use averaging for high speeds</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="334" x="699.25" y="2325.167">Update Comm_Period4x from 1/4 new commutation period</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="239" x="699.25" y="2337.9717">Divide Temp4/3 by 16 and store in Temp5</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="156" x="699.25" y="2350.7764">(calc_next_comm_div_16_4)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="203" x="1150.25" y="2350.7764">no -&gt; Check Comm_Period4x_H &lt; 8</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="290" x="588" y="2375.3706"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="117" x="598" y="2396.5093">Divide_12Bit_By_16</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="142" x="726" y="2396.5093">Temp4, Temp3, Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="689" y="2438.043"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="699" y="2459.1816">Temp6 = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="308" x="579" y="2519.8164"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="71" x="589" y="2540.9551">Divide_By_4</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="192" x="685" y="2540.9551">Temp2, Temp1, Temp2, Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="1413.5" y="2375.3706"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="54" x="1423.5" y="2396.5093">A = A - 4</text><polygon fill="#F1F1F1" points="1404,2503.6758,1497,2503.6758,1509,2515.6758,1497,2527.6758,1404,2527.6758,1392,2515.6758,1404,2503.6758" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="1404" y="2519.4839">CARRY_BIT == 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="213" x="1034" y="2474.6675">Yes -&gt; Use averaging for low speeds</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="334" x="1058" y="2487.4722">Update Comm_Period4x from 1/2 new commutation period</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="232" x="1034" y="2500.2769">Divide Temp4/3 by 8 and store in Temp5</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="1034" y="2513.0815">(calc_next_comm_div_8_2)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="250" x="1509" y="2513.0815">No -&gt; Use averaging for even lower speeds</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="290" x="1010" y="2537.6758"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="109" x="1020" y="2558.8145">Divide_11Bit_By_8</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="142" x="1148" y="2558.8145">Temp4, Temp3, Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1111" y="2606.6445"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1121" y="2627.7832">Temp6 = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1100.5" y="2688.418"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1110.5" y="2709.5566">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1040.5" y="2757.3867"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1050.5" y="2778.5254">Temp2 = CARRY_BIT::Temp2 &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1040.5" y="2826.3555"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1050.5" y="2847.4941">Temp1 = CARRY_BIT::Temp1 &gt;&gt; 1</text><polygon fill="#F1F1F1" points="1666,2564.8945,1826,2564.8945,1838,2576.8945,1826,2588.8945,1666,2588.8945,1654,2576.8945,1666,2564.8945" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="160" x="1666" y="2580.7026">Flag_Initial_Run_Phase == 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="280" x="1320" y="2535.8862">Yes -&gt; Do not average very fast during initial run</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="334" x="1320" y="2548.6909">Update Comm_Period4x from 1/2 new commutation period</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="243" x="1320" y="2561.4956">Divide Temp4/3 by 8 and store in Temp6/5</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="181" x="1320" y="2574.3003">(calc_next_comm_div_8_2_slow)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="1838" y="2561.4956">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="1838" y="2574.3003">(calc_next_comm_div_4_1)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="308" x="1428" y="2598.8945"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="71" x="1438" y="2620.0332">Divide_By_8</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="192" x="1534" y="2620.0332">Temp4, Temp3, Temp6, Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1527.5" y="2680.668"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1537.5" y="2701.8066">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1467.5" y="2749.6367"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1477.5" y="2770.7754">Temp2 = CARRY_BIT::Temp2 &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1467.5" y="2818.6055"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1477.5" y="2839.7441">Temp1 = CARRY_BIT::Temp1 &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="308" x="1756" y="2598.8945"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="78" x="1766" y="2620.0332">TDivide_By_4</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="192" x="1862" y="2620.0332">Temp4, Temp3, Temp6, Temp5</text><polygon fill="#F1F1F1" points="1746,2858.5742,1758,2870.5742,1746,2882.5742,1734,2870.5742,1746,2858.5742" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="1450.5,2888.5742,1462.5,2900.5742,1450.5,2912.5742,1438.5,2900.5742,1450.5,2888.5742" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="1091.75,2918.5742,1103.75,2930.5742,1091.75,2942.5742,1079.75,2930.5742,1091.75,2918.5742" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="1039.25" y="3054.4023"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="85" x="1049.25" y="3075.541">CARRI_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1047.75" y="3136.1758"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1057.75" y="3157.3145">A = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="992.25" y="3205.1445"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="1002.25" y="3226.2832">A = A - (Temp5 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1047.75" y="3274.1133"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1057.75" y="3295.252">Temp3 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1047.75" y="3355.8867"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1057.75" y="3377.0254">A = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="992.25" y="3424.8555"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="1002.25" y="3445.9941">A = A - (Temp4 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1047.75" y="3493.8242"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1057.75" y="3514.9629">Temp4 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1047.75" y="3575.5977"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1057.75" y="3596.7363">A = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="1034.75" y="3644.5664"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="94" x="1044.75" y="3665.7051">A = A + Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="1013.75" y="3713.5352"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="1023.75" y="3734.6738">Comm_Period4x_L = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1047.75" y="3778.3247"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1057.75" y="3799.4634">A = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="195" x="994.25" y="3847.2935"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="175" x="1004.25" y="3868.4321">A = A + Temp2 + CARRY_BIT</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="159" x="1012.25" y="3916.2622"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139" x="1022.25" y="3937.4009">Comm_Period4x_H = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="176" x="1003.75" y="4046.438"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="1013.75" y="4067.5767">Comm_Period4x_L = 0xFF</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="179" x="1002.25" y="4115.4067"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="159" x="1012.25" y="4136.5454">Comm_Period4x_H = 0xFF</text><polygon fill="#F1F1F1" points="1045.25,3998.0356,1138.25,3998.0356,1150.25,4010.0356,1138.25,4022.0356,1045.25,4022.0356,1033.25,4010.0356,1045.25,3998.0356" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="388" x="1095.75" y="4032.2461">Yes -&gt; Set commutation period registers to very slow timing (0xffff)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="1045.25" y="4013.8438">CARRY_BIT == 1</text><polygon fill="#F1F1F1" points="1091.75,4173.7778,1103.75,4185.7778,1091.75,4197.7778,1079.75,4185.7778,1091.75,4173.7778" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1037.25" y="4258.3872"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1047.25" y="4279.5259">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="159" x="1012.25" y="4327.356"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139" x="1022.25" y="4348.4946">A = Comm_Period4x_H</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="1054.75" y="4396.3247"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="54" x="1064.75" y="4417.4634">A = A - 2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="1022.25" y="4526.5005"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="119" x="1032.25" y="4547.6392">Flag_High_Rpm = 1</text><polygon fill="#F1F1F1" points="1045.25,4478.0981,1138.25,4478.0981,1150.25,4490.0981,1138.25,4502.0981,1045.25,4502.0981,1033.25,4490.0981,1045.25,4478.0981" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="1095.75" y="4512.3086">yes -&gt; Set high rpm flag</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="1045.25" y="4493.9063">CARRY_BIT == 1</text><polygon fill="#F1F1F1" points="1091.75,4581.1099,1103.75,4593.1099,1091.75,4605.1099,1079.75,4593.1099,1091.75,4581.1099" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="447" x="868.25" y="4755.3521"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="79" x="878.25" y="4776.4907">Divide_By_16</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="331" x="974.25" y="4776.4907">Comm_Period4x_H, Comm_Period4x_L, Temp4, Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1037.25" y="4837.1255"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1047.25" y="4858.2642">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1047.75" y="4906.0942"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1057.75" y="4927.2329">A = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="1009.25" y="4975.063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="1019.25" y="4996.2017">A = A - (2 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1047.75" y="5044.0317"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1057.75" y="5065.1704">Temp3 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1047.75" y="5113.0005"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1057.75" y="5134.1392">A = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="1009.25" y="5181.9692"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="1019.25" y="5203.1079">A = A - (0 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1047.75" y="5250.938"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1057.75" y="5272.0767">Temp4 = A</text><polygon fill="#F1F1F1" points="1045.25,5345.5161,1138.25,5345.5161,1150.25,5357.5161,1138.25,5369.5161,1045.25,5369.5161,1033.25,5357.5161,1045.25,5345.5161" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="1045.25" y="5361.3242">CARRY_BIT == 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="402" x="631.25" y="5354.9219">yes -&gt; Set minimum waiting time (Timers cannot wait for a delay of 0)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="979.25" y="5379.5161"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="989.25" y="5400.6548">Temp3 = 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="979.25" y="5448.4849"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="989.25" y="5469.6235">Temp4 = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1116.25" y="5427.9185"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1126.25" y="5449.0571">A = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1116.25" y="5558.0942"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1126.25" y="5579.2329">Temp3 = 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1116.25" y="5627.063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1126.25" y="5648.2017">Temp4 = 0</text><polygon fill="#F1F1F1" points="1140.25,5509.6919,1180.25,5509.6919,1192.25,5521.6919,1180.25,5533.6919,1140.25,5533.6919,1128.25,5521.6919,1140.25,5509.6919" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="402" x="1164.25" y="5543.9023">yes -&gt; Set minimum waiting time (Timers cannot wait for a delay of 0)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="40" x="1140.25" y="5525.5">A == 0</text><polygon fill="#F1F1F1" points="1160.25,5685.4341,1172.25,5697.4341,1160.25,5709.4341,1148.25,5697.4341,1160.25,5685.4341" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="1140.25,5379.5161,1180.25,5379.5161,1192.25,5391.5161,1180.25,5403.5161,1140.25,5403.5161,1128.25,5391.5161,1140.25,5379.5161" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="1164.25" y="5413.7266">yes -&gt; Check Temp3 is 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="40" x="1140.25" y="5395.3242">A == 0</text><polygon fill="#F1F1F1" points="1160.25,5733.8364,1172.25,5745.8364,1160.25,5757.8364,1148.25,5745.8364,1160.25,5733.8364" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="1091.75,5763.8364,1103.75,5775.8364,1091.75,5787.8364,1079.75,5775.8364,1091.75,5763.8364" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="623.875,5793.8364,635.875,5805.8364,623.875,5817.8364,611.875,5805.8364,623.875,5793.8364" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="2525" y="1085.2593"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="99" x="2535" y="1106.3979">Temp4 = TMR2L</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="2523.5" y="1139.228"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="102" x="2533.5" y="1160.3667">Temp5 = TMR2H</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="135" x="2517" y="1193.1968"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="115" x="2527" y="1214.3354">Temp6 = Timer2_X</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="2503" y="1268.5645"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="143" x="2513" y="1289.7031">Prev_Comm_L = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="166" x="2501.5" y="1331.1274"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="146" x="2511.5" y="1352.2661">Prev_Comm_H = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="164" x="2502.5" y="1397.9009"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144" x="2512.5" y="1419.0396">Prev_Comm_X = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="2530" y="1479.6743"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="2540" y="1500.813">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2540.5" y="1542.2373"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2550.5" y="1563.376">A = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="2485" y="1609.0107"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="2495" y="1630.1494">A = A - (Temp4 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2540.5" y="1673.9795"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2550.5" y="1695.1182">A = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="2485" y="1742.9482"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="2495" y="1764.0869">A = A - (Temp5 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2540.5" y="1811.917"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2550.5" y="1833.0557">A = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="2485" y="1877.1987"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="2495" y="1898.3374">A = A - (Temp6 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="101" x="2534" y="1990.1675"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81" x="2544" y="2011.3062">A = A &amp; 0x7F</text><polygon fill="#F1F1F1" points="2532.5,1946.1675,2636.5,1946.1675,2648.5,1958.1675,2636.5,1970.1675,2532.5,1970.1675,2520.5,1958.1675,2532.5,1946.1675" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="2532.5" y="1961.9756">MCU_48MHZ == 1</text><polygon fill="#F1F1F1" points="2584.5,2048.1362,2596.5,2060.1362,2584.5,2072.1362,2572.5,2060.1362,2584.5,2048.1362" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="2567.5,2121.5503,2601.5,2121.5503,2613.5,2133.5503,2601.5,2145.5503,2567.5,2145.5503,2555.5,2133.5503,2567.5,2121.5503" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="2567.5" y="2137.3584">A != 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="189" x="2341.5" y="2118.1514">yes -&gt; Extended byte is not zero,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="214" x="2341.5" y="2130.9561">so commutation time is above 0xFFFF</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="161" x="2613.5" y="2118.1514">no -&gt; Extended byte = 0, so</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="221" x="2613.5" y="2130.9561">commutation time fits within two bytes</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="176" x="2364.75" y="2155.5503"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="2374.75" y="2176.689">Comm_Period4x_L = 0xFF</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="179" x="2363.25" y="2224.519"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="159" x="2373.25" y="2245.6577">Comm_Period4x_H = 0xFF</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="2618.25" y="2155.5503"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="176" x="2628.25" y="2176.689">Temp7 = Prev_Prev_Comm_L</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="2616.75" y="2224.519"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="2626.75" y="2245.6577">Temp8 = Prev_Prev_Comm_H</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="2618.25" y="2306.2925"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="176" x="2628.25" y="2327.4312">Prev_Prev_Comm_L = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="2616.75" y="2375.2612"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="2626.75" y="2396.3999">Prev_Prev_Comm_H = Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="2661.75" y="2476.3477"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="2671.75" y="2497.4863">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2672.25" y="2545.3164"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2682.25" y="2566.4551">A = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="2616.75" y="2614.2852"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="2626.75" y="2635.4238">A = A - (Temp7 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2672.25" y="2683.2539"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2682.25" y="2704.3926">Temp1 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2672.25" y="2752.2227"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2682.25" y="2773.3613">A = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="2616.75" y="2821.1914"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="2626.75" y="2842.3301">A = A - (Temp8 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2672.25" y="2890.1602"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2682.25" y="2911.2988">Temp2 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="2621.25" y="2984.7383"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="170" x="2631.25" y="3005.877">Temp3 = Comm_Period4x_L</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="193" x="2619.75" y="3053.707"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="173" x="2629.75" y="3074.8457">Temp4 = Comm_Period4x_H</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="308" x="2562.25" y="3135.4805"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="78" x="2572.25" y="3156.6191">TDivide_By_4</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="192" x="2668.25" y="3156.6191">Temp4, Temp3, Temp6, Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="2663.75" y="3281.2773"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="85" x="2673.75" y="3302.416">CARRI_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2672.25" y="3363.0508"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2682.25" y="3384.1895">A = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="2616.75" y="3432.0195"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="2626.75" y="3453.1582">A = A - (Temp5 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2672.25" y="3500.9883"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2682.25" y="3522.127">Temp3 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2672.25" y="3582.7617"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2682.25" y="3603.9004">A = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="2616.75" y="3651.7305"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="2626.75" y="3672.8691">A = A - (Temp4 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2672.25" y="3720.6992"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2682.25" y="3741.8379">Temp4 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2672.25" y="3798.2935"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2682.25" y="3819.4321">A = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="2659.25" y="3867.2622"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="94" x="2669.25" y="3888.4009">A = A + Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="2638.25" y="3936.231"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="2648.25" y="3957.3696">Comm_Period4x_L = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2672.25" y="4005.1997"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2682.25" y="4026.3384">A = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="195" x="2618.75" y="4074.1685"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="175" x="2628.75" y="4095.3071">A = A + Temp2 + CARRY_BIT</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="159" x="2636.75" y="4143.1372"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139" x="2646.75" y="4164.2759">Comm_Period4x_H = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="176" x="2628.25" y="4273.313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="2638.25" y="4294.4517">Comm_Period4x_L = 0xFF</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="179" x="2626.75" y="4342.2817"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="159" x="2636.75" y="4363.4204">Comm_Period4x_H = 0xFF</text><polygon fill="#F1F1F1" points="2669.75,4224.9106,2762.75,4224.9106,2774.75,4236.9106,2762.75,4248.9106,2669.75,4248.9106,2657.75,4236.9106,2669.75,4224.9106" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="388" x="2720.25" y="4259.1211">Yes -&gt; Set commutation period registers to very slow timing (0xffff)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="2669.75" y="4240.7188">CARRY_BIT == 1</text><polygon fill="#F1F1F1" points="2716.25,4400.6528,2728.25,4412.6528,2716.25,4424.6528,2704.25,4412.6528,2716.25,4400.6528" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="2584.5,4430.6528,2596.5,4442.6528,2584.5,4454.6528,2572.5,4442.6528,2584.5,4430.6528" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="2530" y="4515.2622"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="2540" y="4536.4009">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="159" x="2505" y="4580.4692"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139" x="2515" y="4601.6079">A = Comm_Period4x_H</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="2547.5" y="4649.438"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="54" x="2557.5" y="4670.5767">A = A - 2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="2515" y="4779.6138"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="119" x="2525" y="4800.7524">Flag_High_Rpm = 1</text><polygon fill="#F1F1F1" points="2538,4731.2114,2631,4731.2114,2643,4743.2114,2631,4755.2114,2538,4755.2114,2526,4743.2114,2538,4731.2114" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="140" x="2588.5" y="4765.4219">yes -&gt; Set high rpm flag</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="2538" y="4747.0195">CARRY_BIT == 1</text><polygon fill="#F1F1F1" points="2584.5,4837.9849,2596.5,4849.9849,2584.5,4861.9849,2572.5,4849.9849,2584.5,4837.9849" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="447" x="2361" y="5012.2271"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="79" x="2371" y="5033.3657">Divide_By_16</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="331" x="2467" y="5033.3657">Comm_Period4x_H, Comm_Period4x_L, Temp4, Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="2530" y="5094.0005"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="2540" y="5115.1392">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2540.5" y="5162.9692"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2550.5" y="5184.1079">A = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="2502" y="5231.938"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="2512" y="5253.0767">A = A - (2 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2540.5" y="5300.9067"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2550.5" y="5322.0454">Temp3 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2540.5" y="5369.8755"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2550.5" y="5391.0142">A = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="2502" y="5438.8442"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="2512" y="5459.9829">A = A - (0 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2540.5" y="5507.813"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2550.5" y="5528.9517">Temp4 = A</text><polygon fill="#F1F1F1" points="2538,5602.3911,2631,5602.3911,2643,5614.3911,2631,5626.3911,2538,5626.3911,2526,5614.3911,2538,5602.3911" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="2538" y="5618.1992">CARRY_BIT == 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="402" x="2124" y="5611.7969">yes -&gt; Set minimum waiting time (Timers cannot wait for a delay of 0)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2472" y="5636.3911"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2482" y="5657.5298">Temp3 = 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2472" y="5705.3599"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2482" y="5726.4985">Temp4 = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2609" y="5684.7935"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2619" y="5705.9321">A = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2609" y="5814.9692"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2619" y="5836.1079">Temp3 = 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2609" y="5883.938"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2619" y="5905.0767">Temp4 = 0</text><polygon fill="#F1F1F1" points="2633,5766.5669,2673,5766.5669,2685,5778.5669,2673,5790.5669,2633,5790.5669,2621,5778.5669,2633,5766.5669" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="402" x="2657" y="5800.7773">yes -&gt; Set minimum waiting time (Timers cannot wait for a delay of 0)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="40" x="2633" y="5782.375">A == 0</text><polygon fill="#F1F1F1" points="2653,5937.9067,2665,5949.9067,2653,5961.9067,2641,5949.9067,2653,5937.9067" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="2633,5636.3911,2673,5636.3911,2685,5648.3911,2673,5660.3911,2633,5660.3911,2621,5648.3911,2633,5636.3911" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="2657" y="5670.6016">yes -&gt; Check Temp3 is 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="40" x="2633" y="5652.1992">A == 0</text><polygon fill="#F1F1F1" points="2653,5981.9067,2665,5993.9067,2653,6005.9067,2641,5993.9067,2653,5981.9067" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="2584.5,6011.9067,2596.5,6023.9067,2584.5,6035.9067,2572.5,6023.9067,2584.5,6011.9067" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="1604.1875,6041.9067,1616.1875,6053.9067,1604.1875,6065.9067,1592.1875,6053.9067,1604.1875,6041.9067" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="121" x="1543.6875" y="6184.1338"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="101" x="1553.6875" y="6205.2725">Wait_For_Timer3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="213" x="1497.6875" y="6374.7437"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="193" x="1507.6875" y="6395.8823">TMR3RLL = Wt_ZC_Tout_Start_L</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="219" x="1494.6875" y="6428.7124"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="199" x="1504.6875" y="6449.8511">TMR3RLH = Wt_ZC_Tout_Start_H</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="177" x="1515.6875" y="6482.6812"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="157" x="1525.6875" y="6503.8198">Flag_Timer3_Pending = 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1537.1875" y="6536.6499"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="1547.1875" y="6557.7886">EIE1 = EIE1 | 0x80</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="1500.6875" y="6637.627"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="187" x="1510.6875" y="6658.7656">Temp1 = &amp;Pgm_Comm_Timing</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="1557.1875" y="6691.5957"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="74" x="1567.1875" y="6712.7344">A = *Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1560.1875" y="6766.9634"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1570.1875" y="6788.1021">Temp8 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1549.6875" y="6820.9321"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1559.6875" y="6842.0708">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="54" x="1577.1875" y="6874.9009"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="34" x="1587.1875" y="6896.0396">A = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="1504.6875" y="6950.2686"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="1514.6875" y="6971.4072">A = A - (Temp3 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1560.1875" y="7004.2373"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1570.1875" y="7025.376">Temp1 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="54" x="1577.1875" y="7058.2061"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="34" x="1587.1875" y="7079.3447">A = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="1504.6875" y="7112.1748"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="1514.6875" y="7133.3135">A = A - (Temp4 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1560.1875" y="7166.1436"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1570.1875" y="7187.2822">Temp2 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1549.6875" y="7264.1123"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1559.6875" y="7285.251">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1489.6875" y="7339.48"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1499.6875" y="7360.6187">Temp1 = Temp1::CARRY_BIT &lt;&lt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1489.6875" y="7393.4487"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1499.6875" y="7414.5874">Temp2 = Temp2::CARRY_BIT &lt;&lt; 1</text><polygon fill="#F1F1F1" points="1552.1875,7220.1123,1656.1875,7220.1123,1668.1875,7232.1123,1656.1875,7244.1123,1552.1875,7244.1123,1540.1875,7232.1123,1552.1875,7220.1123" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="1552.1875" y="7235.9204">MCU_48MHZ == 1</text><polygon fill="#F1F1F1" points="1604.1875,7447.4175,1616.1875,7459.4175,1604.1875,7471.4175,1592.1875,7459.4175,1604.1875,7447.4175" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="1545.1875,7539.2305,1663.1875,7539.2305,1675.1875,7551.2305,1663.1875,7563.2305,1545.1875,7563.2305,1533.1875,7551.2305,1545.1875,7539.2305" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="118" x="1545.1875" y="7555.0386">Flag_High_Rpm == 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="37" x="1321.1875" y="7510.2222">yes -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="154" x="1321.1875" y="7523.0269">(calc_new_wait_times_fast)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="212" x="1321.1875" y="7535.8315">Calculate new wait times fast routine</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="69" x="1321.1875" y="7548.6362">Copy values</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="257" x="1675.1875" y="7548.6362">no -&gt; Load programmed commutation timing</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="912.1875" y="7573.2305"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="922.1875" y="7594.3691">A = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="912.1875" y="7642.1992"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="922.1875" y="7663.3379">Temp3 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="901.6875" y="7723.9727"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="911.6875" y="7745.1113">CARRY_BIT = 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="161" x="875.6875" y="7805.7461"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="885.6875" y="7826.8848">A = CARRY_BIT::A &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="912.1875" y="7874.7148"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="922.1875" y="7895.8535">Temp5 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="204" x="854.1875" y="7956.4883"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184" x="864.1875" y="7977.627">Wt_Zc_Scan_Start_L = Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="201" x="855.6875" y="8038.2617"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="181" x="865.6875" y="8059.4004">Wt_Zc_Tout_Start_L = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="901.6875" y="8107.2305"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="911.6875" y="8128.3691">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="912.1875" y="8189.0039"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="922.1875" y="8210.1426">A = Temp8</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="856.6875" y="8270.7773"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="866.6875" y="8291.916">A = A - (Temp3 + CARRY_BIT)</text><polygon fill="#F1F1F1" points="936.1875,8354.1602,976.1875,8354.1602,988.1875,8366.1602,976.1875,8378.1602,936.1875,8378.1602,924.1875,8366.1602,936.1875,8354.1602" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="40" x="936.1875" y="8369.9683">A == 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="163" x="560.1875" y="8337.9565">(store_times_decrease_fast)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="72" x="560.1875" y="8350.7612">Yes - branch</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="364" x="560.1875" y="8363.5659">Now commutation time (~60deg) divided by 4 (~15deg nominal)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="988.1875" y="8363.5659">no</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="189" x="492.9375" y="8388.1602"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169" x="502.9375" y="8409.2988">Wt_Comm_Start_L = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="173" x="500.9375" y="8469.9336"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="510.9375" y="8491.0723">Wt_Adv_Start_L = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1280.9375" y="8388.1602"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1290.9375" y="8409.2988">A = Temp8</text><polygon fill="#F1F1F1" points="1299.4375,8471.543,1350.4375,8471.543,1362.4375,8483.543,1350.4375,8495.543,1299.4375,8495.543,1287.4375,8483.543,1299.4375,8471.543" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="51" x="1299.4375" y="8487.3511">A.0 == 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="176" x="1111.4375" y="8468.144">(adjust_timing_two_steps_fast)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="176" x="1111.4375" y="8480.9487">Add 15deg and store in Temp1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="215" x="1362.4375" y="8480.9487">no -&gt; Add 7.5deg and store in Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1153.4375" y="8505.543"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1163.4375" y="8526.6816">A = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="1140.4375" y="8574.5117"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="94" x="1150.4375" y="8595.6504">A = A + Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="1157.4375" y="8643.4805"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60" x="1167.4375" y="8664.6191">A = A + 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1153.4375" y="8712.4492"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1163.4375" y="8733.5879">Temp1 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="142" x="1126.4375" y="8794.2227"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="122" x="1136.4375" y="8815.3613">Temp3 = Temp3 - 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1408.4375" y="8505.543"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1418.4375" y="8526.6816">A = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="1395.4375" y="8574.5117"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="94" x="1405.4375" y="8595.6504">A = A + Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1408.4375" y="8643.4805"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1418.4375" y="8664.6191">Temp1 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1408.4375" y="8725.2539"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1418.4375" y="8746.3926">A = Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1408.4375" y="8794.2227"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1418.4375" y="8815.3613">Temp3 = A</text><polygon fill="#F1F1F1" points="1324.9375,8834.1914,1336.9375,8846.1914,1324.9375,8858.1914,1312.9375,8846.1914,1324.9375,8834.1914" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1270.4375" y="8905.9961"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1280.4375" y="8927.1348">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1280.9375" y="8973.4888"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1290.9375" y="8994.6274">A = Temp8</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="1242.4375" y="9055.2622"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="1252.4375" y="9076.4009">A = A - (3 + CARRY_BIT)</text><polygon fill="#F1F1F1" points="1278.4375,9121.8096,1371.4375,9121.8096,1383.4375,9133.8096,1371.4375,9145.8096,1278.4375,9145.8096,1266.4375,9133.8096,1278.4375,9121.8096" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="1278.4375" y="9137.6177">CARRY_BIT == 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="204" x="898.4375" y="9118.4106">yes -&gt; (store_times_decrease_fast)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="364" x="902.4375" y="9131.2153">Now commutation time (~60deg) divided by 4 (~15deg nominal)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="194" x="1383.4375" y="9118.4106">no -&gt; (store_times_increase_fast)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="364" x="1387.4375" y="9131.2153">Now commutation time (~60deg) divided by 4 (~15deg nominal)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="189" x="1027.6875" y="9155.8096"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169" x="1037.6875" y="9176.9482">Wt_Comm_Start_L = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="173" x="1035.6875" y="9237.583"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="1045.6875" y="9258.7217">Wt_Adv_Start_L = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="189" x="1433.1875" y="9155.8096"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169" x="1443.1875" y="9176.9482">Wt_Comm_Start_L = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="173" x="1441.1875" y="9237.583"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="1451.1875" y="9258.7217">Wt_Adv_Start_L = Temp1</text><polygon fill="#F1F1F1" points="1324.9375,9277.5518,1336.9375,9289.5518,1324.9375,9301.5518,1312.9375,9289.5518,1324.9375,9277.5518" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="956.1875,9307.5518,968.1875,9319.5518,956.1875,9331.5518,944.1875,9319.5518,956.1875,9307.5518" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="2179.6875,7587.6445,2324.6875,7587.6445,2336.6875,7599.6445,2324.6875,7611.6445,2179.6875,7611.6445,2167.6875,7599.6445,2179.6875,7587.6445" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="2179.6875" y="7603.4526">Flag_Startup_Phase == 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="1858.6875" y="7571.4409">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="125" x="1858.6875" y="7584.2456">(adjust_comm_timing)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="309" x="1858.6875" y="7597.0503">Adjust commutation timing according to demag metric</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="237" x="2336.6875" y="7597.0503">no -&gt; Set dedicated timing during startup</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="2022.1875" y="7621.6445"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="2032.1875" y="7642.7832">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="198" x="1977.6875" y="7703.418"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="178" x="1987.6875" y="7724.5566">A = Demag_Detected_Metric</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="181" x="1986.1875" y="7772.3867"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="161" x="1996.1875" y="7793.5254">A = A - (130 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="148" x="2002.6875" y="7889.7578"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="128" x="2012.6875" y="7910.8965">Temp8 = Temp8 + 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="173" x="1990.1875" y="7971.5313"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="2000.1875" y="7992.6699">A = A - (30 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="148" x="2002.6875" y="8088.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="128" x="2012.6875" y="8109.6387">Temp8 = Temp8 + 1</text><polygon fill="#F1F1F1" points="2030.1875,8040.5,2123.1875,8040.5,2135.1875,8052.5,2123.1875,8064.5,2030.1875,8064.5,2018.1875,8052.5,2030.1875,8040.5" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="2030.1875" y="8056.3081">CARRY_BIT == 0</text><polygon fill="#F1F1F1" points="2076.6875,8146.4688,2088.6875,8158.4688,2076.6875,8170.4688,2064.6875,8158.4688,2076.6875,8146.4688" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="2022.1875" y="8218.2734"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="2032.1875" y="8239.4121">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2032.6875" y="8287.2422"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2042.6875" y="8308.3809">A = Temp8</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="1994.1875" y="8356.2109"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="2004.1875" y="8377.3496">A = A - (6 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2032.6875" y="8473.1797"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2042.6875" y="8494.3184">Temp8 = 5</text><polygon fill="#F1F1F1" points="2030.1875,8425.1797,2123.1875,8425.1797,2135.1875,8437.1797,2123.1875,8449.1797,2030.1875,8449.1797,2018.1875,8437.1797,2030.1875,8425.1797" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="2030.1875" y="8440.9878">CARRY_BIT == 0</text><polygon fill="#F1F1F1" points="2076.6875,8531.1484,2088.6875,8543.1484,2076.6875,8555.1484,2064.6875,8543.1484,2076.6875,8531.1484" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="2030.1875,7841.3555,2123.1875,7841.3555,2135.1875,7853.3555,2123.1875,7865.3555,2030.1875,7865.3555,2018.1875,7853.3555,2030.1875,7841.3555" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="267" x="2080.6875" y="7875.5659">yes -&gt; Increase timing (if metric 130 or above)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="2030.1875" y="7857.1636">CARRY_BIT == 0</text><polygon fill="#F1F1F1" points="2076.6875,8579.5508,2088.6875,8591.5508,2076.6875,8603.5508,2064.6875,8591.5508,2076.6875,8579.5508" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2383.6875" y="7621.6445"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2393.6875" y="7642.7832">Temp8 = 3</text><polygon fill="#F1F1F1" points="2252.1875,8609.5508,2264.1875,8621.5508,2252.1875,8633.5508,2240.1875,8621.5508,2252.1875,8609.5508" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2208.1875" y="8694.1602"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2218.1875" y="8715.2988">A = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2208.1875" y="8763.1289"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2218.1875" y="8784.2676">Temp3 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2208.1875" y="8832.0977"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2218.1875" y="8853.2363">A = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2208.1875" y="8901.0664"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2218.1875" y="8922.2051">Temp4 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="2197.6875" y="8994.1685"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="2207.6875" y="9015.3071">CARRY_BIT = 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2208.1875" y="9063.1372"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2218.1875" y="9084.2759">A = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="161" x="2171.6875" y="9128.0752"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="2181.6875" y="9149.2139">A = CARRY_BIT::A &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2208.1875" y="9197.0439"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2218.1875" y="9218.1826">Temp6 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2208.1875" y="9266.0127"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2218.1875" y="9287.1514">A = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="161" x="2171.6875" y="9334.9814"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="2181.6875" y="9356.1201">A = CARRY_BIT::A &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2208.1875" y="9388.9502"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2218.1875" y="9410.0889">Temp5 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="204" x="2150.1875" y="9464.3179"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184" x="2160.1875" y="9485.4565">Wt_Zc_Scan_Start_L = Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="2148.6875" y="9518.2866"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="187" x="2158.6875" y="9539.4253">Wt_Zc_Scan_Start_H = Temp6</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="201" x="2151.6875" y="9593.6543"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="181" x="2161.6875" y="9614.793">Wt_Zc_Tout_Start_L = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="204" x="2150.1875" y="9647.623"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="184" x="2160.1875" y="9668.7617">Wt_Zc_Tout_Start_H = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="2197.6875" y="9748.6001"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="2207.6875" y="9769.7388">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2208.1875" y="9802.5688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2218.1875" y="9823.7075">A = Temp8</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="2169.6875" y="9856.5376"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="2179.6875" y="9877.6763">A = A - (3 + CARRY_BIT)</text><polygon fill="#F1F1F1" points="2232.1875,9940.8193,2272.1875,9940.8193,2284.1875,9952.8193,2272.1875,9964.8193,2232.1875,9964.8193,2220.1875,9952.8193,2232.1875,9940.8193" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="40" x="2232.1875" y="9956.6274">A == 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="2033.1875" y="9911.811">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="135" x="2033.1875" y="9924.6157">(store_times_decrease)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="2033.1875" y="9937.4204">Now commutation time (~60deg)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="173" x="2033.1875" y="9950.2251">divided by 4 (~15deg nominal)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="184" x="2284.1875" y="9950.2251">no -&gt; If an odd number - branch</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="189" x="1924.0625" y="9974.8193"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169" x="1934.0625" y="9995.958">Wt_Comm_Start_L = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="192" x="1922.5625" y="10031.8823"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="172" x="1932.5625" y="10053.021">Wt_Comm_Start_H = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="173" x="1932.0625" y="10126.4604"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="1942.0625" y="10147.5991">Wt_Adv_Start_L = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="176" x="1930.5625" y="10195.4292"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="1940.5625" y="10216.5679">Wt_Adv_Start_H = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="167" x="1935.0625" y="10364.019"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="147" x="1945.0625" y="10385.1577">Wt_Comm_Start_L = -16</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="162" x="1937.5625" y="10432.9878"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="142" x="1947.5625" y="10454.1265">Wt_Comm_Start_H = -1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="182" x="1927.5625" y="10501.9565"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="162" x="1937.5625" y="10523.0952">Wt_Zc_Scan_Start_L = -16</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="177" x="1930.0625" y="10570.9253"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="157" x="1940.0625" y="10592.064">Wt_Zc_Scan_Start_H = -1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="179" x="1929.0625" y="10639.894"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="159" x="1939.0625" y="10661.0327">Wt_Zc_Tout_Start_L = -16</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="174" x="1931.5625" y="10708.8628"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="154" x="1941.5625" y="10730.0015">Wt_Zc_Tout_Start_H = -1</text><polygon fill="#F1F1F1" points="1946.0625,10315.6167,2091.0625,10315.6167,2103.0625,10327.6167,2091.0625,10339.6167,1946.0625,10339.6167,1934.0625,10327.6167,1946.0625,10315.6167" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="2022.5625" y="10349.8271">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="1946.0625" y="10331.4248">Flag_Startup_Phase == 1</text><polygon fill="#F1F1F1" points="2018.5625,10767.2339,2030.5625,10779.2339,2018.5625,10791.2339,2006.5625,10779.2339,2018.5625,10767.2339" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2441.8125" y="9974.8193"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2451.8125" y="9995.958">A = Temp8</text><polygon fill="#F1F1F1" points="2460.3125,10071.9058,2511.3125,10071.9058,2523.3125,10083.9058,2511.3125,10095.9058,2460.3125,10095.9058,2448.3125,10083.9058,2460.3125,10071.9058" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="51" x="2460.3125" y="10087.7139">A.0 == 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="37" x="2211.3125" y="10030.0928">yes -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="148" x="2211.3125" y="10042.8975">(adjust_timing_two_steps)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="210" x="2211.3125" y="10055.7021">Commutation timing setting is 1 or 5</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="237" x="2211.3125" y="10068.5068">Store 30deg in Temp1/2 (15deg + 15deg)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="219" x="2211.3125" y="10081.3115">Add 1 to final result (Temp1/2 * 2 + 1)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="245" x="2523.3125" y="10068.5068">no -&gt; Commutation timing setting is 2 or 4</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="252" x="2523.3125" y="10081.3115">Store 22.5deg in Temp1/2 (15deg + 7.5deg)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2266.0625" y="10105.9058"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2276.0625" y="10127.0444">A = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="2255.5625" y="10174.8745"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="2265.5625" y="10196.0132">CARRY_BIT = 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="205" x="2207.5625" y="10243.8433"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="185" x="2217.5625" y="10264.9819">A = A + (Temp1 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2266.0625" y="10312.812"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2276.0625" y="10333.9507">Temp1 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2266.0625" y="10381.7808"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2276.0625" y="10402.9194">A = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="205" x="2207.5625" y="10450.7495"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="185" x="2217.5625" y="10471.8882">A = A + (Temp2 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2266.0625" y="10519.7183"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2276.0625" y="10540.8569">Temp2 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="92" x="2264.0625" y="10601.4917"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="72" x="2274.0625" y="10622.6304">Temp3 = -1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="92" x="2264.0625" y="10670.4604"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="72" x="2274.0625" y="10691.5991">Temp4 = -1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2617.5625" y="10105.9058"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2627.5625" y="10127.0444">A = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="2604.5625" y="10174.8745"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="94" x="2614.5625" y="10196.0132">A = A + Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2617.5625" y="10243.8433"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2627.5625" y="10264.9819">Temp1 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2617.5625" y="10312.812"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2627.5625" y="10333.9507">A = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="205" x="2559.0625" y="10381.7808"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="185" x="2569.0625" y="10402.9194">A = A + (Temp6 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2617.5625" y="10450.7495"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2627.5625" y="10471.8882">Temp2 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2617.5625" y="10519.7183"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2627.5625" y="10540.8569">A = Temp5</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2617.5625" y="10588.687"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2627.5625" y="10609.8257">Temp3 = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2617.5625" y="10657.6558"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2627.5625" y="10678.7944">A = Temp6</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2617.5625" y="10726.6245"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2627.5625" y="10747.7632">Temp4 = A</text><polygon fill="#F1F1F1" points="2485.8125,10766.5933,2497.8125,10778.5933,2485.8125,10790.5933,2473.8125,10778.5933,2485.8125,10766.5933" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="2431.3125" y="10845.4375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="2441.3125" y="10866.5762">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="2441.8125" y="10899.4063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="2451.8125" y="10920.5449">A = Temp8</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="165" x="2403.3125" y="10953.375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="2413.3125" y="10974.5137">A = A - (3 + CARRY_BIT)</text><polygon fill="#F1F1F1" points="2439.3125,11037.6567,2532.3125,11037.6567,2544.3125,11049.6567,2532.3125,11061.6567,2439.3125,11061.6567,2427.3125,11049.6567,2439.3125,11037.6567" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="2439.3125" y="11053.4648">CARRY_BIT == 1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="37" x="2240.3125" y="11008.6484">yes -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="135" x="2240.3125" y="11021.4531">(store_times_decrease)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="2240.3125" y="11034.2578">Now commutation time (~60deg)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="173" x="2240.3125" y="11047.0625">divided by 4 (~15deg nominal)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="31" x="2544.3125" y="11008.6484">no -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="131" x="2544.3125" y="11021.4531">(store_times_increase)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="2544.3125" y="11034.2578">Now commutation time (~60deg)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="173" x="2544.3125" y="11047.0625">divided by 4 (~15deg nominal)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="189" x="2253.8125" y="11071.6567"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169" x="2263.8125" y="11092.7954">Wt_Comm_Start_L = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="192" x="2252.3125" y="11125.6255"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="172" x="2262.3125" y="11146.7642">Wt_Comm_Start_H = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="173" x="2261.8125" y="11213.7979"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="2271.8125" y="11234.9365">Wt_Adv_Start_L = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="176" x="2260.3125" y="11267.7666"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="2270.3125" y="11288.9053">Wt_Adv_Start_H = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="167" x="2264.8125" y="11429.9507"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="147" x="2274.8125" y="11451.0894">Wt_Comm_Start_L = -16</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="162" x="2267.3125" y="11483.9194"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="142" x="2277.3125" y="11505.0581">Wt_Comm_Start_H = -1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="182" x="2257.3125" y="11537.8882"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="162" x="2267.3125" y="11559.0269">Wt_Zc_Scan_Start_L = -16</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="177" x="2259.8125" y="11606.8569"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="157" x="2269.8125" y="11627.9956">Wt_Zc_Scan_Start_H = -1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="179" x="2258.8125" y="11660.8257"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="159" x="2268.8125" y="11681.9644">Wt_Zc_Tout_Start_L = -16</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="174" x="2261.3125" y="11714.7944"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="154" x="2271.3125" y="11735.9331">Wt_Zc_Tout_Start_H = -1</text><polygon fill="#F1F1F1" points="2275.8125,11381.5483,2420.8125,11381.5483,2432.8125,11393.5483,2420.8125,11405.5483,2275.8125,11405.5483,2263.8125,11393.5483,2275.8125,11381.5483" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="20" x="2352.3125" y="11415.7588">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="2275.8125" y="11397.3564">Flag_Startup_Phase == 1</text><polygon fill="#F1F1F1" points="2348.3125,11768.7632,2360.3125,11780.7632,2348.3125,11792.7632,2336.3125,11780.7632,2348.3125,11768.7632" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="189" x="2528.8125" y="11071.6567"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169" x="2538.8125" y="11092.7954">Wt_Comm_Start_L = Temp3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="192" x="2527.3125" y="11125.6255"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="172" x="2537.3125" y="11146.7642">Wt_Comm_Start_H = Temp4</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="173" x="2536.8125" y="11213.7979"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153" x="2546.8125" y="11234.9365">Wt_Adv_Start_L = Temp1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="176" x="2535.3125" y="11267.7666"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="156" x="2545.3125" y="11288.9053">Wt_Adv_Start_H = Temp2</text><polygon fill="#F1F1F1" points="2485.8125,11798.7632,2497.8125,11810.7632,2485.8125,11822.7632,2473.8125,11810.7632,2485.8125,11798.7632" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="2252.1875,11828.7632,2264.1875,11840.7632,2252.1875,11852.7632,2240.1875,11840.7632,2252.1875,11828.7632" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="1604.1875,11858.7632,1616.1875,11870.7632,1604.1875,11882.7632,1592.1875,11870.7632,1604.1875,11858.7632" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="121" x="1543.6875" y="11962.5762"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="101" x="1553.6875" y="11983.7148">Wait_For_Timer3</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="206" x="1501.1875" y="12063.5532"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="186" x="1511.1875" y="12084.6919">Startup_Zc_Timeout_Cntd = 2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="177" x="1515.6875" y="12117.522"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="157" x="1525.6875" y="12138.6606">Flag_Timer3_Pending = 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1537.1875" y="12192.8896"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="1547.1875" y="12214.0283">EIE1 = EIE1 | 0x80</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="1509.1875" y="12295.2607"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="170" x="1519.1875" y="12316.3994">Temp1 = Comm_Period4x_L</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="193" x="1507.6875" y="12349.2295"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="173" x="1517.6875" y="12370.3682">Temp2 = Comm_Period4x_H</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1549.6875" y="12403.1982"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1559.6875" y="12424.3369">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1489.6875" y="12457.167"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1499.6875" y="12478.3057">Temp2 = CARRY_BIT::Temp2 &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1489.6875" y="12511.1357"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1499.6875" y="12532.2744">Temp1 = CARRY_BIT::Temp1 &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1549.6875" y="12609.1045"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1559.6875" y="12630.2432">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1489.6875" y="12663.0732"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1499.6875" y="12684.2119">Temp2 = CARRY_BIT::Temp2 &gt;&gt; 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1489.6875" y="12717.042"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1499.6875" y="12738.1807">Temp1 = CARRY_BIT::Temp1 &gt;&gt; 1</text><polygon fill="#F1F1F1" points="1552.1875,12565.1045,1656.1875,12565.1045,1668.1875,12577.1045,1656.1875,12589.1045,1552.1875,12589.1045,1540.1875,12577.1045,1552.1875,12565.1045" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="1552.1875" y="12580.9126">MCU_48MHZ == 0</text><polygon fill="#F1F1F1" points="1604.1875,12771.0107,1616.1875,12783.0107,1604.1875,12795.0107,1592.1875,12783.0107,1604.1875,12771.0107" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1560.1875" y="12863.4131"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1570.1875" y="12884.5518">A = Temp2</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1560.1875" y="12917.3818"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1570.1875" y="12938.5205">A = A + 40</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1560.1875" y="12971.3506"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1570.1875" y="12992.4893">Temp2 = A</text><polygon fill="#F1F1F1" points="1531.6875,12815.0107,1676.6875,12815.0107,1688.6875,12827.0107,1676.6875,12839.0107,1531.6875,12839.0107,1519.6875,12827.0107,1531.6875,12815.0107" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="288" x="1608.1875" y="12849.2212">Increase timeout somewhat to avoid false wind up</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="1531.6875" y="12830.8188">Flag_Startup_Phase == 1</text><polygon fill="#F1F1F1" points="1604.1875,13025.3193,1616.1875,13037.3193,1604.1875,13049.3193,1592.1875,13037.3193,1604.1875,13025.3193" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="79" x="1564.6875" y="13090.7183"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="59" x="1574.6875" y="13111.8569">IE_EA = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="1534.6875" y="13144.687"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="119" x="1544.6875" y="13165.8257">EIE1 = EIE1 &amp; 0x7F</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="1552.1875" y="13220.0547"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="1562.1875" y="13241.1934">TMR3CN0 = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1549.6875" y="13295.4224"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1559.6875" y="13316.561">CARRY_BIT = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="54" x="1577.1875" y="13349.3911"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="34" x="1587.1875" y="13370.5298">A = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="1504.6875" y="13403.3599"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="1514.6875" y="13424.4985">A = A - (Temp1 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="85" x="1561.6875" y="13457.3286"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="65" x="1571.6875" y="13478.4673">TMR3L = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="54" x="1577.1875" y="13511.2974"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="34" x="1587.1875" y="13532.436">A = 0</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="1504.6875" y="13565.2661"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="179" x="1514.6875" y="13586.4048">A = A - (Temp2 + CARRY_BIT)</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="1560.1875" y="13619.2349"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="1570.1875" y="13640.3735">TMR3H = A</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="1541.1875" y="13694.6025"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="106" x="1551.1875" y="13715.7412">TMR3CN0 = 0x04</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="177" x="1515.6875" y="13748.5713"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="157" x="1525.6875" y="13769.71">Flag_Timer3_Pending = 1</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="134" x="1537.1875" y="13823.939"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="1547.1875" y="13845.0776">EIE1 = EIE1 | 0x80</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="79" x="1564.6875" y="13877.9077"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="59" x="1574.6875" y="13899.0464">IE_EA = 1</text><polygon fill="#F1F1F1" points="1524.1875,12246.8584,1684.1875,12246.8584,1696.1875,12258.8584,1684.1875,12270.8584,1524.1875,12270.8584,1512.1875,12258.8584,1524.1875,12246.8584" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="217" x="1608.1875" y="12281.0688">yes -&gt; Set long timeout when starting</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="160" x="1524.1875" y="12262.6665">Flag_Initial_Run_Phase == 1</text><polygon fill="#F1F1F1" points="1604.1875,13931.8765,1616.1875,13943.8765,1604.1875,13955.8765,1592.1875,13943.8765,1604.1875,13931.8765" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="38" x="1585.1875" y="13975.8765"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="18" x="1595.1875" y="13997.0151">ret</text><ellipse cx="1604.1875" cy="14040.8452" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;fill:none;"/><ellipse cx="1604.1875" cy="14040.8452" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="30" y2="161.0317"/><polygon fill="#181818" points="1600.1875,151.0317,1604.1875,161.0317,1608.1875,151.0317,1604.1875,155.0317" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="198" x="1608.1875" y="51.3047">Calculate next commutation period</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="4" x="1608.1875" y="64.1094"></text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="304" x="1608.1875" y="76.9141">Measure the duration of current commutation period,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="325" x="1608.1875" y="89.7188">and update Comm_Period4x by averaging a fraction of it.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="4" x="1608.1875" y="102.5234"></text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="248" x="1608.1875" y="115.3281">Called immediately after each commutation</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="4" x="1608.1875" y="128.1328"></text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="336" x="1608.1875" y="140.9375">Stop global &amp; timer 2 interrupts &amp; Read commutation time</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="195.0005" y2="215.0005"/><polygon fill="#181818" points="1600.1875,205.0005,1604.1875,215.0005,1608.1875,205.0005,1604.1875,209.0005" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="248.9692" y2="268.9692"/><polygon fill="#181818" points="1600.1875,258.9692,1604.1875,268.9692,1608.1875,258.9692,1604.1875,262.9692" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="302.938" y2="322.938"/><polygon fill="#181818" points="1600.1875,312.938,1604.1875,322.938,1608.1875,312.938,1604.1875,316.938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="356.9067" y2="376.9067"/><polygon fill="#181818" points="1600.1875,366.9067,1604.1875,376.9067,1608.1875,366.9067,1604.1875,370.9067" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="476.2744" y2="500.6768"/><polygon fill="#181818" points="1600.1875,490.6768,1604.1875,500.6768,1608.1875,490.6768,1604.1875,494.6768" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1676.1875" x2="1688.1875" y1="464.2744" y2="464.2744"/><polygon fill="#181818" points="1684.1875,507.6611,1688.1875,517.6611,1692.1875,507.6611,1688.1875,511.6611" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1688.1875" x2="1688.1875" y1="464.2744" y2="566.6455"/><line style="stroke:#181818;stroke-width:1.0;" x1="1688.1875" x2="1616.1875" y1="566.6455" y2="566.6455"/><polygon fill="#181818" points="1626.1875,562.6455,1616.1875,566.6455,1626.1875,570.6455,1622.1875,566.6455" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="534.6455" y2="554.6455"/><polygon fill="#181818" points="1600.1875,544.6455,1604.1875,554.6455,1608.1875,544.6455,1604.1875,548.6455" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="410.8755" y2="452.2744"/><polygon fill="#181818" points="1600.1875,442.2744,1604.1875,452.2744,1608.1875,442.2744,1604.1875,446.2744" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="161" x="1608.1875" y="432.1802">Check if interrupt is pending</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="578.6455" y2="620.0444"/><polygon fill="#181818" points="1600.1875,610.0444,1604.1875,620.0444,1608.1875,610.0444,1604.1875,614.0444" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="230" x="1608.1875" y="599.9502">Enable global &amp; timer 2 interrupts again</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="654.0132" y2="674.0132"/><polygon fill="#181818" points="1600.1875,664.0132,1604.1875,674.0132,1608.1875,664.0132,1604.1875,668.0132" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="810.353" y2="830.353"/><polygon fill="#181818" points="1600.1875,820.353,1604.1875,830.353,1608.1875,820.353,1604.1875,824.353" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="864.3218" y2="899.3218"/><polygon fill="#181818" points="1600.1875,889.3218,1604.1875,899.3218,1608.1875,889.3218,1604.1875,893.3218" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="933.2905" y2="953.2905"/><polygon fill="#181818" points="1600.1875,943.2905,1604.1875,953.2905,1608.1875,943.2905,1604.1875,947.2905" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="751.9819" y2="776.3843"/><polygon fill="#181818" points="1600.1875,766.3843,1604.1875,776.3843,1608.1875,766.3843,1604.1875,770.3843" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1668.1875" x2="1728.6875" y1="739.9819" y2="739.9819"/><polygon fill="#181818" points="1724.6875,871.8218,1728.6875,881.8218,1732.6875,871.8218,1728.6875,875.8218" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1728.6875" x2="1728.6875" y1="739.9819" y2="1019.2593"/><line style="stroke:#181818;stroke-width:1.0;" x1="1728.6875" x2="1616.1875" y1="1019.2593" y2="1019.2593"/><polygon fill="#181818" points="1626.1875,1015.2593,1616.1875,1019.2593,1626.1875,1023.2593,1622.1875,1019.2593" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="987.2593" y2="1007.2593"/><polygon fill="#181818" points="1600.1875,997.2593,1604.1875,1007.2593,1608.1875,997.2593,1604.1875,1001.2593" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="707.9819" y2="727.9819"/><polygon fill="#181818" points="1600.1875,717.9819,1604.1875,727.9819,1608.1875,717.9819,1604.1875,721.9819" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1119.228" y2="1139.228"/><polygon fill="#181818" points="619.875,1129.228,623.875,1139.228,627.875,1129.228,623.875,1133.228" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1173.1968" y2="1193.1968"/><polygon fill="#181818" points="619.875,1183.1968,623.875,1193.1968,627.875,1183.1968,623.875,1187.1968" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1227.1655" y2="1268.5645"/><polygon fill="#181818" points="619.875,1258.5645,623.875,1268.5645,627.875,1258.5645,623.875,1262.5645" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="242" x="627.875" y="1248.4702">Save timestamp as previous commutation</text><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1302.5332" y2="1343.9321"/><polygon fill="#181818" points="619.875,1333.9321,623.875,1343.9321,627.875,1333.9321,623.875,1337.9321" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="272" x="627.875" y="1323.8379">Temp1 = Temp1 - (Prev_Comm_L + CARRY_BIT)</text><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1377.9009" y2="1410.7056"/><polygon fill="#181818" points="619.875,1400.7056,623.875,1410.7056,627.875,1400.7056,623.875,1404.7056" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1444.6743" y2="1479.6743"/><polygon fill="#181818" points="619.875,1469.6743,623.875,1479.6743,627.875,1469.6743,623.875,1473.6743" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1513.6431" y2="1555.042"/><polygon fill="#181818" points="619.875,1545.042,623.875,1555.042,627.875,1545.042,623.875,1549.042" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="242" x="627.875" y="1534.9478">Save timestamp as previous commutation</text><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1645.8154" y2="1665.8154"/><polygon fill="#181818" points="619.875,1655.8154,623.875,1665.8154,627.875,1655.8154,623.875,1659.8154" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="687.875" x2="699.875" y1="1633.8154" y2="1633.8154"/><polygon fill="#181818" points="695.875,1672.7998,699.875,1682.7998,703.875,1672.7998,699.875,1676.7998" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="699.875" x2="699.875" y1="1633.8154" y2="1735.7842"/><line style="stroke:#181818;stroke-width:1.0;" x1="699.875" x2="635.875" y1="1735.7842" y2="1735.7842"/><polygon fill="#181818" points="645.875,1731.7842,635.875,1735.7842,645.875,1739.7842,641.875,1735.7842" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1699.7842" y2="1723.7842"/><polygon fill="#181818" points="619.875,1713.7842,623.875,1723.7842,627.875,1713.7842,623.875,1717.7842" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1589.0107" y2="1621.8154"/><polygon fill="#181818" points="619.875,1611.8154,623.875,1621.8154,627.875,1611.8154,623.875,1615.8154" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1747.7842" y2="1795.5889"/><polygon fill="#181818" points="619.875,1785.5889,623.875,1795.5889,627.875,1785.5889,623.875,1789.5889" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="274" x="627.875" y="1775.4946">Temp2 = Temp2 - (Prev_Comm_H + CARRY_BIT)</text><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="1968.8628" y2="1999.8628"/><polygon fill="#181818" points="152,1989.8628,156,1999.8628,160,1989.8628,156,1993.8628" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2033.8315" y2="2081.6362"/><polygon fill="#181818" points="152,2071.6362,156,2081.6362,160,2071.6362,156,2075.6362" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="185" x="160" y="2061.542">Divide by 16 and store in Temp5</text><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2115.605" y2="2163.4097"/><polygon fill="#181818" points="152,2153.4097,156,2163.4097,160,2153.4097,156,2157.4097" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="106" x="160" y="2143.3154">Subtract a fraction</text><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2197.3784" y2="2232.3784"/><polygon fill="#181818" points="152,2222.3784,156,2232.3784,160,2222.3784,156,2226.3784" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2266.3472" y2="2301.3472"/><polygon fill="#181818" points="152,2291.3472,156,2301.3472,160,2291.3472,156,2295.3472" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2335.3159" y2="2370.3159"/><polygon fill="#181818" points="152,2360.3159,156,2370.3159,160,2360.3159,156,2364.3159" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2404.2847" y2="2432.9883"/><polygon fill="#181818" points="152,2422.9883,156,2432.9883,160,2422.9883,156,2426.9883" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2466.957" y2="2501.957"/><polygon fill="#181818" points="152,2491.957,156,2501.957,160,2491.957,156,2495.957" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2535.9258" y2="2570.9258"/><polygon fill="#181818" points="152,2560.9258,156,2570.9258,160,2560.9258,156,2564.9258" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2604.8945" y2="2652.6992"/><polygon fill="#181818" points="152,2642.6992,156,2652.6992,160,2642.6992,156,2646.6992" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="389" x="160" y="2632.605">Note: Temp2 is assumed to be zero (approx. Comm_Period4x_H / 4)</text><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2686.668" y2="2721.668"/><polygon fill="#181818" points="152,2711.668,156,2721.668,160,2711.668,156,2715.668" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2755.6367" y2="2790.6367"/><polygon fill="#181818" points="152,2780.6367,156,2790.6367,160,2780.6367,156,2784.6367" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2824.6055" y2="2859.6055"/><polygon fill="#181818" points="152,2849.6055,156,2859.6055,160,2849.6055,156,2853.6055" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2893.5742" y2="2941.3789"/><polygon fill="#181818" points="152,2931.3789,156,2941.3789,160,2931.3789,156,2935.3789" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="160" y="2921.2847">Add the divided new time</text><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="2975.3477" y2="3010.3477"/><polygon fill="#181818" points="152,3000.3477,156,3010.3477,160,3000.3477,156,3004.3477" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3044.3164" y2="3079.3164"/><polygon fill="#181818" points="152,3069.3164,156,3079.3164,160,3069.3164,156,3073.3164" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3113.2852" y2="3161.0898"/><polygon fill="#181818" points="152,3151.0898,156,3161.0898,160,3151.0898,156,3155.0898" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="127" x="160" y="3140.9956">Store Comm_Period4x</text><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3195.0586" y2="3230.0586"/><polygon fill="#181818" points="152,3220.0586,156,3230.0586,160,3220.0586,156,3224.0586" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3264.0273" y2="3311.832"/><polygon fill="#181818" points="152,3301.832,156,3311.832,160,3301.832,156,3305.832" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="306" x="160" y="3291.7378">Is Comm_Period4x_H 2 or more? (below ~160k erpm)</text><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3345.8008" y2="3380.8008"/><polygon fill="#181818" points="152,3370.8008,156,3380.8008,160,3370.8008,156,3374.8008" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3473.7695" y2="3498.1719"/><polygon fill="#181818" points="152,3488.1719,156,3498.1719,160,3488.1719,156,3492.1719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="214.5" x2="235.5" y1="3461.7695" y2="3461.7695"/><polygon fill="#181818" points="231.5,3505.1563,235.5,3515.1563,239.5,3505.1563,235.5,3509.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="235.5" x2="235.5" y1="3461.7695" y2="3568.543"/><line style="stroke:#181818;stroke-width:1.0;" x1="235.5" x2="168" y1="3568.543" y2="3568.543"/><polygon fill="#181818" points="178,3564.543,168,3568.543,178,3572.543,174,3568.543" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3532.1406" y2="3556.543"/><polygon fill="#181818" points="152,3546.543,156,3556.543,160,3546.543,156,3550.543" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3414.7695" y2="3449.7695"/><polygon fill="#181818" points="152,3439.7695,156,3449.7695,160,3439.7695,156,3443.7695" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3580.543" y2="3628.3477"/><polygon fill="#181818" points="152,3618.3477,156,3628.3477,160,3618.3477,156,3622.3477" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="292" x="160" y="3608.2534">Divide Comm_Period4x by 16 and store in Temp4/3</text><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3662.3164" y2="3722.9258"/><polygon fill="#181818" points="152,3712.9258,156,3722.9258,160,3712.9258,156,3716.9258" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="167" x="160" y="3690.0269">Exchange lo/hi 4bits (nibbles)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="46" x="160" y="3702.8315">:SWAP A</text><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3756.8945" y2="3800.52"/><polygon fill="#181818" points="152,3790.52,156,3800.52,160,3790.52,156,3794.52" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="159" x="160" y="3780.4258">Clear waiting time high byte</text><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3834.4888" y2="3869.4888"/><polygon fill="#181818" points="152,3859.4888,156,3869.4888,160,3859.4888,156,3863.4888" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3903.4575" y2="3964.0669"/><polygon fill="#181818" points="152,3954.0669,156,3964.0669,160,3954.0669,156,3958.0669" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="167" x="160" y="3931.168">Exchange lo/hi 4bits (nibbles)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="46" x="160" y="3943.9727">:SWAP A</text><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="3998.0356" y2="4033.0356"/><polygon fill="#181818" points="152,4023.0356,156,4033.0356,160,4023.0356,156,4027.0356" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="4067.0044" y2="4114.8091"/><polygon fill="#181818" points="152,4104.8091,156,4114.8091,160,4104.8091,156,4108.8091" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="160" y="4094.7148">Timing reduction</text><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="4148.7778" y2="4183.7778"/><polygon fill="#181818" points="152,4173.7778,156,4183.7778,160,4173.7778,156,4177.7778" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="4217.7466" y2="4252.7466"/><polygon fill="#181818" points="152,4242.7466,156,4252.7466,160,4242.7466,156,4246.7466" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="4358.52" y2="4389.3247"/><polygon fill="#181818" points="152,4379.3247,156,4389.3247,160,4379.3247,156,4383.3247" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="214.5" x2="226.5" y1="4346.52" y2="4346.52"/><polygon fill="#181818" points="222.5,4396.3091,226.5,4406.3091,230.5,4396.3091,226.5,4400.3091" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="226.5" x2="226.5" y1="4346.52" y2="4466.0981"/><line style="stroke:#181818;stroke-width:1.0;" x1="226.5" x2="168" y1="4466.0981" y2="4466.0981"/><polygon fill="#181818" points="178,4462.0981,168,4466.0981,178,4470.0981,174,4466.0981" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="4423.2935" y2="4454.0981"/><polygon fill="#181818" points="152,4444.0981,156,4454.0981,160,4444.0981,156,4448.0981" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="4286.7153" y2="4334.52"/><polygon fill="#181818" points="152,4324.52,156,4334.52,160,4324.52,156,4328.52" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="69" x="160" y="4314.4258">Check A &lt; 2</text><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="1968.8628" y2="1999.8628"/><polygon fill="#181818" points="1087.75,1989.8628,1091.75,1999.8628,1095.75,1989.8628,1091.75,1993.8628" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="2033.8315" y2="2068.8315"/><polygon fill="#181818" points="1087.75,2058.8315,1091.75,2068.8315,1095.75,2058.8315,1091.75,2062.8315" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="2102.8003" y2="2137.8003"/><polygon fill="#181818" points="1087.75,2127.8003,1091.75,2137.8003,1095.75,2127.8003,1091.75,2131.8003" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="2171.769" y2="2206.769"/><polygon fill="#181818" points="1087.75,2196.769,1091.75,2206.769,1095.75,2196.769,1091.75,2200.769" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="733" x2="733" y1="2409.3394" y2="2438.043"/><polygon fill="#181818" points="729,2428.043,733,2438.043,737,2428.043,733,2432.043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="733" x2="733" y1="2472.0117" y2="2519.8164"/><polygon fill="#181818" points="729,2509.8164,733,2519.8164,737,2509.8164,733,2513.8164" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="243" x="737" y="2499.7222">Divide Temp2/1 by 4 and store in Temp2/1</text><line style="stroke:#181818;stroke-width:1.0;" x1="1155" x2="1155" y1="2571.6445" y2="2606.6445"/><polygon fill="#181818" points="1151,2596.6445,1155,2606.6445,1159,2596.6445,1155,2600.6445" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1155" x2="1155" y1="2640.6133" y2="2688.418"/><polygon fill="#181818" points="1151,2678.418,1155,2688.418,1159,2678.418,1155,2682.418" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="62" x="1159" y="2668.3237">Divide by 2</text><line style="stroke:#181818;stroke-width:1.0;" x1="1155" x2="1155" y1="2722.3867" y2="2757.3867"/><polygon fill="#181818" points="1151,2747.3867,1155,2757.3867,1159,2747.3867,1155,2751.3867" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1155" x2="1155" y1="2791.3555" y2="2826.3555"/><polygon fill="#181818" points="1151,2816.3555,1155,2826.3555,1159,2816.3555,1155,2820.3555" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1582" x2="1582" y1="2632.8633" y2="2680.668"/><polygon fill="#181818" points="1578,2670.668,1582,2680.668,1586,2670.668,1582,2674.668" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="62" x="1586" y="2660.5737">Divide by 2</text><line style="stroke:#181818;stroke-width:1.0;" x1="1582" x2="1582" y1="2714.6367" y2="2749.6367"/><polygon fill="#181818" points="1578,2739.6367,1582,2749.6367,1586,2739.6367,1582,2743.6367" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1582" x2="1582" y1="2783.6055" y2="2818.6055"/><polygon fill="#181818" points="1578,2808.6055,1582,2818.6055,1586,2808.6055,1582,2812.6055" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1654" x2="1582" y1="2576.8945" y2="2576.8945"/><line style="stroke:#181818;stroke-width:1.0;" x1="1582" x2="1582" y1="2576.8945" y2="2598.8945"/><polygon fill="#181818" points="1578,2588.8945,1582,2598.8945,1586,2588.8945,1582,2592.8945" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1838" x2="1910" y1="2576.8945" y2="2576.8945"/><line style="stroke:#181818;stroke-width:1.0;" x1="1910" x2="1910" y1="2576.8945" y2="2598.8945"/><polygon fill="#181818" points="1906,2588.8945,1910,2598.8945,1914,2588.8945,1910,2592.8945" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1582" x2="1582" y1="2852.5742" y2="2870.5742"/><line style="stroke:#181818;stroke-width:1.0;" x1="1582" x2="1734" y1="2870.5742" y2="2870.5742"/><polygon fill="#181818" points="1724,2866.5742,1734,2870.5742,1724,2874.5742,1728,2870.5742" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1910" x2="1910" y1="2632.8633" y2="2870.5742"/><line style="stroke:#181818;stroke-width:1.0;" x1="1910" x2="1758" y1="2870.5742" y2="2870.5742"/><polygon fill="#181818" points="1768,2866.5742,1758,2870.5742,1768,2874.5742,1764,2870.5742" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1392" x2="1155" y1="2515.6758" y2="2515.6758"/><line style="stroke:#181818;stroke-width:1.0;" x1="1155" x2="1155" y1="2515.6758" y2="2537.6758"/><polygon fill="#181818" points="1151,2527.6758,1155,2537.6758,1159,2527.6758,1155,2531.6758" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1509" x2="1746" y1="2515.6758" y2="2515.6758"/><line style="stroke:#181818;stroke-width:1.0;" x1="1746" x2="1746" y1="2515.6758" y2="2564.8945"/><polygon fill="#181818" points="1742,2554.8945,1746,2564.8945,1750,2554.8945,1746,2558.8945" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1155" x2="1155" y1="2860.3242" y2="2900.5742"/><line style="stroke:#181818;stroke-width:1.0;" x1="1155" x2="1438.5" y1="2900.5742" y2="2900.5742"/><polygon fill="#181818" points="1428.5,2896.5742,1438.5,2900.5742,1428.5,2904.5742,1432.5,2900.5742" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1746" x2="1746" y1="2882.5742" y2="2900.5742"/><line style="stroke:#181818;stroke-width:1.0;" x1="1746" x2="1462.5" y1="2900.5742" y2="2900.5742"/><polygon fill="#181818" points="1472.5,2896.5742,1462.5,2900.5742,1472.5,2904.5742,1468.5,2900.5742" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1450.5" x2="1450.5" y1="2409.3394" y2="2503.6758"/><polygon fill="#181818" points="1446.5,2493.6758,1450.5,2503.6758,1454.5,2493.6758,1450.5,2497.6758" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="168" x="1454.5" y="2444.3628">Check Comm_Period4x_H &lt; 8</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="1454.5" y="2457.1675">(CARRY_BIT is 1)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="101" x="1454.5" y="2469.9722">above ~40k erpm</text><line style="stroke:#181818;stroke-width:1.0;" x1="1033.25" x2="733" y1="2353.3706" y2="2353.3706"/><line style="stroke:#181818;stroke-width:1.0;" x1="733" x2="733" y1="2353.3706" y2="2375.3706"/><polygon fill="#181818" points="729,2365.3706,733,2375.3706,737,2365.3706,733,2369.3706" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1150.25" x2="1450.5" y1="2353.3706" y2="2353.3706"/><line style="stroke:#181818;stroke-width:1.0;" x1="1450.5" x2="1450.5" y1="2353.3706" y2="2375.3706"/><polygon fill="#181818" points="1446.5,2365.3706,1450.5,2375.3706,1454.5,2365.3706,1450.5,2369.3706" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="733" x2="733" y1="2553.7852" y2="2930.5742"/><line style="stroke:#181818;stroke-width:1.0;" x1="733" x2="1079.75" y1="2930.5742" y2="2930.5742"/><polygon fill="#181818" points="1069.75,2926.5742,1079.75,2930.5742,1069.75,2934.5742,1073.75,2930.5742" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1450.5" x2="1450.5" y1="2912.5742" y2="2930.5742"/><line style="stroke:#181818;stroke-width:1.0;" x1="1450.5" x2="1103.75" y1="2930.5742" y2="2930.5742"/><polygon fill="#181818" points="1113.75,2926.5742,1103.75,2930.5742,1113.75,2934.5742,1109.75,2930.5742" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="2240.7378" y2="2341.3706"/><polygon fill="#181818" points="1087.75,2331.3706,1091.75,2341.3706,1095.75,2331.3706,1091.75,2335.3706" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="168" x="1095.75" y="2282.0576">Check Comm_Period4x_H &lt; 4</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="1095.75" y="2294.8623">(CARRY_BIT is 1)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="101" x="1095.75" y="2307.667">above ~80k erpm</text><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="2942.5742" y2="3054.4023"/><polygon fill="#181818" points="1087.75,3044.4023,1091.75,3054.4023,1095.75,3044.4023,1091.75,3048.4023" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="225" x="1095.75" y="2970.2847">(calc_next_comm_average_and_update)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="105" x="1107.75" y="2983.0894">Comm_Period4x =</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="293" x="1123.75" y="2995.894">Comm_Period4x - (Comm_Period4x / (16, 8 or 4)) +</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="156" x="1123.75" y="3008.6987">(Comm_Period / (4, 2 or 1))</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="279" x="1095.75" y="3021.5034">Temp6/5: Comm_Period4x divided by (16, 8 or 4)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="106" x="1095.75" y="3034.3081">Subtract a fraction</text><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3088.3711" y2="3136.1758"/><polygon fill="#181818" points="1087.75,3126.1758,1091.75,3136.1758,1095.75,3126.1758,1091.75,3130.1758" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="1095.75" y="3116.0815">Comm_Period4x_L</text><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3170.1445" y2="3205.1445"/><polygon fill="#181818" points="1087.75,3195.1445,1091.75,3205.1445,1095.75,3195.1445,1091.75,3199.1445" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3239.1133" y2="3274.1133"/><polygon fill="#181818" points="1087.75,3264.1133,1091.75,3274.1133,1095.75,3264.1133,1091.75,3268.1133" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3308.082" y2="3355.8867"/><polygon fill="#181818" points="1087.75,3345.8867,1091.75,3355.8867,1095.75,3345.8867,1091.75,3349.8867" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="106" x="1095.75" y="3335.7925">Comm_Period4x_H</text><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3389.8555" y2="3424.8555"/><polygon fill="#181818" points="1087.75,3414.8555,1091.75,3424.8555,1095.75,3414.8555,1091.75,3418.8555" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3458.8242" y2="3493.8242"/><polygon fill="#181818" points="1087.75,3483.8242,1091.75,3493.8242,1095.75,3483.8242,1091.75,3487.8242" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3527.793" y2="3575.5977"/><polygon fill="#181818" points="1087.75,3565.5977,1091.75,3575.5977,1095.75,3565.5977,1091.75,3569.5977" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="322" x="1095.75" y="3555.5034">Temp2/1: This commutation period divided by (4, 2 or 1)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3609.5664" y2="3644.5664"/><polygon fill="#181818" points="1087.75,3634.5664,1091.75,3644.5664,1095.75,3634.5664,1091.75,3638.5664" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3678.5352" y2="3713.5352"/><polygon fill="#181818" points="1087.75,3703.5352,1091.75,3713.5352,1095.75,3703.5352,1091.75,3707.5352" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3747.5039" y2="3778.3247"/><polygon fill="#181818" points="1087.75,3768.3247,1091.75,3778.3247,1095.75,3768.3247,1091.75,3772.3247" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3812.2935" y2="3847.2935"/><polygon fill="#181818" points="1087.75,3837.2935,1091.75,3847.2935,1095.75,3837.2935,1091.75,3841.2935" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3881.2622" y2="3916.2622"/><polygon fill="#181818" points="1087.75,3906.2622,1091.75,3916.2622,1095.75,3906.2622,1091.75,3910.2622" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4080.4067" y2="4115.4067"/><polygon fill="#181818" points="1087.75,4105.4067,1091.75,4115.4067,1095.75,4105.4067,1091.75,4109.4067" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4022.0356" y2="4046.438"/><polygon fill="#181818" points="1087.75,4036.438,1091.75,4046.438,1095.75,4036.438,1091.75,4040.438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1150.25" x2="1191.25" y1="4010.0356" y2="4010.0356"/><polygon fill="#181818" points="1187.25,4087.9067,1191.25,4097.9067,1195.25,4087.9067,1191.25,4091.9067" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1191.25" x2="1191.25" y1="4010.0356" y2="4185.7778"/><line style="stroke:#181818;stroke-width:1.0;" x1="1191.25" x2="1103.75" y1="4185.7778" y2="4185.7778"/><polygon fill="#181818" points="1113.75,4181.7778,1103.75,4185.7778,1113.75,4189.7778,1109.75,4185.7778" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4149.3755" y2="4173.7778"/><polygon fill="#181818" points="1087.75,4163.7778,1091.75,4173.7778,1095.75,4163.7778,1091.75,4167.7778" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="3950.231" y2="3998.0356"/><polygon fill="#181818" points="1087.75,3988.0356,1091.75,3998.0356,1095.75,3988.0356,1091.75,3992.0356" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="156" x="1095.75" y="3977.9414">Is period larger than 0xffff?</text><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4197.7778" y2="4258.3872"/><polygon fill="#181818" points="1087.75,4248.3872,1091.75,4258.3872,1095.75,4248.3872,1091.75,4252.3872" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="135" x="1095.75" y="4225.4883">(calc_next_comm_done)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="294" x="1095.75" y="4238.293">Is Comm_Period4x_H below 2? (above ~160k erpm)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4292.356" y2="4327.356"/><polygon fill="#181818" points="1087.75,4317.356,1091.75,4327.356,1095.75,4317.356,1091.75,4321.356" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4361.3247" y2="4396.3247"/><polygon fill="#181818" points="1087.75,4386.3247,1091.75,4396.3247,1095.75,4386.3247,1091.75,4390.3247" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4502.0981" y2="4526.5005"/><polygon fill="#181818" points="1087.75,4516.5005,1091.75,4526.5005,1095.75,4516.5005,1091.75,4520.5005" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1150.25" x2="1171.25" y1="4490.0981" y2="4490.0981"/><polygon fill="#181818" points="1167.25,4533.4849,1171.25,4543.4849,1175.25,4533.4849,1171.25,4537.4849" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1171.25" x2="1171.25" y1="4490.0981" y2="4593.1099"/><line style="stroke:#181818;stroke-width:1.0;" x1="1171.25" x2="1103.75" y1="4593.1099" y2="4593.1099"/><polygon fill="#181818" points="1113.75,4589.1099,1103.75,4593.1099,1113.75,4597.1099,1109.75,4593.1099" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4560.4692" y2="4581.1099"/><polygon fill="#181818" points="1087.75,4571.1099,1091.75,4581.1099,1095.75,4571.1099,1091.75,4575.1099" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4430.2935" y2="4478.0981"/><polygon fill="#181818" points="1087.75,4468.0981,1091.75,4478.0981,1095.75,4468.0981,1091.75,4472.0981" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="387" x="1095.75" y="4458.0039">Is Comm_Period4x_H below 2? (above ~160k erpm, CARRY_BIT is 1)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4605.1099" y2="4755.3521"/><polygon fill="#181818" points="1087.75,4745.3521,1091.75,4755.3521,1095.75,4745.3521,1091.75,4749.3521" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="1095.75" y="4632.8203">(calc_next_comm_15deg)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="128" x="1095.75" y="4645.625">- Commutation period:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="151" x="1111.75" y="4658.4297">360 deg / 6 runs = 60 deg</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="114" x="1111.75" y="4671.2344">60 deg / 4 = 15 deg</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="222" x="1095.75" y="4684.0391">- Load current commutation timing and</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="131" x="1103.75" y="4696.8438">compute 15 deg timing</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="173" x="1095.75" y="4709.6484">- Divide Comm_Period4x by 16</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="172" x="1103.75" y="4722.4531">(Comm_Period1x divided by 4)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="123" x="1103.75" y="4735.2578">and store in Temp4/3</text><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4789.3208" y2="4837.1255"/><polygon fill="#181818" points="1087.75,4827.1255,1091.75,4837.1255,1095.75,4827.1255,1091.75,4831.1255" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="144" x="1095.75" y="4817.0313">Subtract timing reduction</text><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4871.0942" y2="4906.0942"/><polygon fill="#181818" points="1087.75,4896.0942,1091.75,4906.0942,1095.75,4896.0942,1091.75,4900.0942" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="4940.063" y2="4975.063"/><polygon fill="#181818" points="1087.75,4965.063,1091.75,4975.063,1095.75,4965.063,1091.75,4969.063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="5009.0317" y2="5044.0317"/><polygon fill="#181818" points="1087.75,5034.0317,1091.75,5044.0317,1095.75,5034.0317,1091.75,5038.0317" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="5078.0005" y2="5113.0005"/><polygon fill="#181818" points="1087.75,5103.0005,1091.75,5113.0005,1095.75,5103.0005,1091.75,5107.0005" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="5146.9692" y2="5181.9692"/><polygon fill="#181818" points="1087.75,5171.9692,1091.75,5181.9692,1095.75,5171.9692,1091.75,5175.9692" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="5215.938" y2="5250.938"/><polygon fill="#181818" points="1087.75,5240.938,1091.75,5250.938,1095.75,5240.938,1091.75,5244.938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1023.25" x2="1023.25" y1="5413.4849" y2="5448.4849"/><polygon fill="#181818" points="1019.25,5438.4849,1023.25,5448.4849,1027.25,5438.4849,1023.25,5442.4849" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1160.25" x2="1160.25" y1="5592.063" y2="5627.063"/><polygon fill="#181818" points="1156.25,5617.063,1160.25,5627.063,1164.25,5617.063,1160.25,5621.063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1160.25" x2="1160.25" y1="5533.6919" y2="5558.0942"/><polygon fill="#181818" points="1156.25,5548.0942,1160.25,5558.0942,1164.25,5548.0942,1160.25,5552.0942" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1192.25" x2="1214.25" y1="5521.6919" y2="5521.6919"/><polygon fill="#181818" points="1210.25,5599.563,1214.25,5609.563,1218.25,5599.563,1214.25,5603.563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1214.25" x2="1214.25" y1="5521.6919" y2="5697.4341"/><line style="stroke:#181818;stroke-width:1.0;" x1="1214.25" x2="1172.25" y1="5697.4341" y2="5697.4341"/><polygon fill="#181818" points="1182.25,5693.4341,1172.25,5697.4341,1182.25,5701.4341,1178.25,5697.4341" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1160.25" x2="1160.25" y1="5661.0317" y2="5685.4341"/><polygon fill="#181818" points="1156.25,5675.4341,1160.25,5685.4341,1164.25,5675.4341,1160.25,5679.4341" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1160.25" x2="1160.25" y1="5461.8872" y2="5509.6919"/><polygon fill="#181818" points="1156.25,5499.6919,1160.25,5509.6919,1164.25,5499.6919,1160.25,5503.6919" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="1164.25" y="5489.5977">Check Temp4::Temp3 is 0</text><line style="stroke:#181818;stroke-width:1.0;" x1="1160.25" x2="1160.25" y1="5403.5161" y2="5427.9185"/><polygon fill="#181818" points="1156.25,5417.9185,1160.25,5427.9185,1164.25,5417.9185,1160.25,5421.9185" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1192.25" x2="1323.25" y1="5391.5161" y2="5391.5161"/><polygon fill="#181818" points="1319.25,5558.6763,1323.25,5568.6763,1327.25,5558.6763,1323.25,5562.6763" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1323.25" x2="1323.25" y1="5391.5161" y2="5745.8364"/><line style="stroke:#181818;stroke-width:1.0;" x1="1323.25" x2="1172.25" y1="5745.8364" y2="5745.8364"/><polygon fill="#181818" points="1182.25,5741.8364,1172.25,5745.8364,1182.25,5749.8364,1178.25,5745.8364" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1160.25" x2="1160.25" y1="5709.4341" y2="5733.8364"/><polygon fill="#181818" points="1156.25,5723.8364,1160.25,5733.8364,1164.25,5723.8364,1160.25,5727.8364" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1033.25" x2="1023.25" y1="5357.5161" y2="5357.5161"/><line style="stroke:#181818;stroke-width:1.0;" x1="1023.25" x2="1023.25" y1="5357.5161" y2="5379.5161"/><polygon fill="#181818" points="1019.25,5369.5161,1023.25,5379.5161,1027.25,5369.5161,1023.25,5373.5161" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1150.25" x2="1160.25" y1="5357.5161" y2="5357.5161"/><line style="stroke:#181818;stroke-width:1.0;" x1="1160.25" x2="1160.25" y1="5357.5161" y2="5379.5161"/><polygon fill="#181818" points="1156.25,5369.5161,1160.25,5379.5161,1164.25,5369.5161,1160.25,5373.5161" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1023.25" x2="1023.25" y1="5482.4536" y2="5775.8364"/><line style="stroke:#181818;stroke-width:1.0;" x1="1023.25" x2="1079.75" y1="5775.8364" y2="5775.8364"/><polygon fill="#181818" points="1069.75,5771.8364,1079.75,5775.8364,1069.75,5779.8364,1073.75,5775.8364" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1160.25" x2="1160.25" y1="5757.8364" y2="5775.8364"/><line style="stroke:#181818;stroke-width:1.0;" x1="1160.25" x2="1103.75" y1="5775.8364" y2="5775.8364"/><polygon fill="#181818" points="1113.75,5771.8364,1103.75,5775.8364,1113.75,5779.8364,1109.75,5775.8364" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="5284.9067" y2="5345.5161"/><polygon fill="#181818" points="1087.75,5335.5161,1091.75,5345.5161,1095.75,5335.5161,1091.75,5339.5161" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="183" x="1095.75" y="5312.6172">Check that result is still positive</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="118" x="1103.75" y="5325.4219">(Temp4::Temp3 &lt; 0)</text><line style="stroke:#181818;stroke-width:1.0;" x1="552.875" x2="156" y1="1912.894" y2="1912.894"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="1912.894" y2="1934.894"/><polygon fill="#181818" points="152,1924.894,156,1934.894,160,1924.894,156,1928.894" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="694.875" x2="1091.75" y1="1912.894" y2="1912.894"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="1912.894" y2="1934.894"/><polygon fill="#181818" points="1087.75,1924.894,1091.75,1934.894,1095.75,1924.894,1091.75,1928.894" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="4478.0981" y2="5805.8364"/><line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="611.875" y1="5805.8364" y2="5805.8364"/><polygon fill="#181818" points="601.875,5801.8364,611.875,5805.8364,601.875,5809.8364,605.875,5805.8364" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="1091.75" y1="5787.8364" y2="5805.8364"/><line style="stroke:#181818;stroke-width:1.0;" x1="1091.75" x2="635.875" y1="5805.8364" y2="5805.8364"/><polygon fill="#181818" points="645.875,5801.8364,635.875,5805.8364,645.875,5809.8364,641.875,5805.8364" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1829.5576" y2="1900.894"/><polygon fill="#181818" points="619.875,1890.894,623.875,1900.894,627.875,1890.894,623.875,1894.894" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="627.875" y="1867.1904">Check high or normal rpm</text><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1119.228" y2="1139.228"/><polygon fill="#181818" points="2580.5,1129.228,2584.5,1139.228,2588.5,1129.228,2584.5,1133.228" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1173.1968" y2="1193.1968"/><polygon fill="#181818" points="2580.5,1183.1968,2584.5,1193.1968,2588.5,1183.1968,2584.5,1187.1968" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1227.1655" y2="1268.5645"/><polygon fill="#181818" points="2580.5,1258.5645,2584.5,1268.5645,2588.5,1258.5645,2584.5,1262.5645" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="245" x="2588.5" y="1248.4702">Store timestamp as previous commutation</text><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1302.5332" y2="1331.1274"/><polygon fill="#181818" points="2580.5,1321.1274,2584.5,1331.1274,2588.5,1321.1274,2584.5,1325.1274" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1365.0962" y2="1397.9009"/><polygon fill="#181818" points="2580.5,1387.9009,2584.5,1397.9009,2588.5,1387.9009,2584.5,1391.9009" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1431.8696" y2="1479.6743"/><polygon fill="#181818" points="2580.5,1469.6743,2584.5,1479.6743,2588.5,1469.6743,2584.5,1473.6743" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="208" x="2588.5" y="1459.5801">Calculate the new commutation time</text><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1513.6431" y2="1542.2373"/><polygon fill="#181818" points="2580.5,1532.2373,2584.5,1542.2373,2588.5,1532.2373,2584.5,1536.2373" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1576.2061" y2="1609.0107"/><polygon fill="#181818" points="2580.5,1599.0107,2584.5,1609.0107,2588.5,1599.0107,2584.5,1603.0107" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1642.9795" y2="1673.9795"/><polygon fill="#181818" points="2580.5,1663.9795,2584.5,1673.9795,2588.5,1663.9795,2584.5,1667.9795" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1707.9482" y2="1742.9482"/><polygon fill="#181818" points="2580.5,1732.9482,2584.5,1742.9482,2588.5,1732.9482,2584.5,1736.9482" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1776.917" y2="1811.917"/><polygon fill="#181818" points="2580.5,1801.917,2584.5,1811.917,2588.5,1801.917,2584.5,1805.917" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1845.8857" y2="1877.1987"/><polygon fill="#181818" points="2580.5,1867.1987,2584.5,1877.1987,2588.5,1867.1987,2584.5,1871.1987" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1970.1675" y2="1990.1675"/><polygon fill="#181818" points="2580.5,1980.1675,2584.5,1990.1675,2588.5,1980.1675,2584.5,1984.1675" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2648.5" x2="2660.5" y1="1958.1675" y2="1958.1675"/><polygon fill="#181818" points="2656.5,1997.1519,2660.5,2007.1519,2664.5,1997.1519,2660.5,2001.1519" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2660.5" x2="2660.5" y1="1958.1675" y2="2060.1362"/><line style="stroke:#181818;stroke-width:1.0;" x1="2660.5" x2="2596.5" y1="2060.1362" y2="2060.1362"/><polygon fill="#181818" points="2606.5,2056.1362,2596.5,2060.1362,2606.5,2064.1362,2602.5,2060.1362" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="2024.1362" y2="2048.1362"/><polygon fill="#181818" points="2580.5,2038.1362,2584.5,2048.1362,2588.5,2038.1362,2584.5,2042.1362" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1911.1675" y2="1946.1675"/><polygon fill="#181818" points="2580.5,1936.1675,2584.5,1946.1675,2588.5,1936.1675,2584.5,1940.1675" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2452.75" x2="2452.75" y1="2189.519" y2="2224.519"/><polygon fill="#181818" points="2448.75,2214.519,2452.75,2224.519,2456.75,2214.519,2452.75,2218.519" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="2189.519" y2="2224.519"/><polygon fill="#181818" points="2712.25,2214.519,2716.25,2224.519,2720.25,2214.519,2716.25,2218.519" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="2258.4878" y2="2306.2925"/><polygon fill="#181818" points="2712.25,2296.2925,2716.25,2306.2925,2720.25,2296.2925,2716.25,2300.2925" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="179" x="2720.25" y="2286.1982">Update Prev_Prev_Comm times</text><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="2340.2612" y2="2375.2612"/><polygon fill="#181818" points="2712.25,2365.2612,2716.25,2375.2612,2720.25,2365.2612,2716.25,2369.2612" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="2409.23" y2="2476.3477"/><polygon fill="#181818" points="2712.25,2466.3477,2716.25,2476.3477,2720.25,2466.3477,2716.25,2470.3477" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="208" x="2720.25" y="2430.644">Calculate the new commutation time</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="138" x="2720.25" y="2443.4487">based upon the two last</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="260" x="2720.25" y="2456.2534">commutations (to reduce sensitivity to offset)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="2510.3164" y2="2545.3164"/><polygon fill="#181818" points="2712.25,2535.3164,2716.25,2545.3164,2720.25,2535.3164,2716.25,2539.3164" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="2579.2852" y2="2614.2852"/><polygon fill="#181818" points="2712.25,2604.2852,2716.25,2614.2852,2720.25,2604.2852,2716.25,2608.2852" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="2648.2539" y2="2683.2539"/><polygon fill="#181818" points="2712.25,2673.2539,2716.25,2683.2539,2720.25,2673.2539,2716.25,2677.2539" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="2717.2227" y2="2752.2227"/><polygon fill="#181818" points="2712.25,2742.2227,2716.25,2752.2227,2720.25,2742.2227,2716.25,2746.2227" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="2786.1914" y2="2821.1914"/><polygon fill="#181818" points="2712.25,2811.1914,2716.25,2821.1914,2720.25,2811.1914,2716.25,2815.1914" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="2855.1602" y2="2890.1602"/><polygon fill="#181818" points="2712.25,2880.1602,2716.25,2890.1602,2720.25,2880.1602,2716.25,2884.1602" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="2924.1289" y2="2984.7383"/><polygon fill="#181818" points="2712.25,2974.7383,2716.25,2984.7383,2720.25,2974.7383,2716.25,2978.7383" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="193" x="2720.25" y="2951.8394">Comm_Period4x holds the time of</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="92" x="2720.25" y="2964.644">4 commutations</text><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3018.707" y2="3053.707"/><polygon fill="#181818" points="2712.25,3043.707,2716.25,3053.707,2720.25,3043.707,2716.25,3047.707" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3087.6758" y2="3135.4805"/><polygon fill="#181818" points="2712.25,3125.4805,2716.25,3135.4805,2720.25,3125.4805,2716.25,3129.4805" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="2720.25" y="3115.3862">(calc_next_comm_div_4_1)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3169.4492" y2="3281.2773"/><polygon fill="#181818" points="2712.25,3271.2773,2716.25,3281.2773,2720.25,3271.2773,2716.25,3275.2773" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="225" x="2720.25" y="3197.1597">(calc_next_comm_average_and_update)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="105" x="2732.25" y="3209.9644">Comm_Period4x =</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="293" x="2748.25" y="3222.769">Comm_Period4x - (Comm_Period4x / (16, 8 or 4)) +</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="156" x="2748.25" y="3235.5737">(Comm_Period / (4, 2 or 1))</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="279" x="2720.25" y="3248.3784">Temp6/5: Comm_Period4x divided by (16, 8 or 4)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="106" x="2720.25" y="3261.1831">Subtract a fraction</text><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3315.2461" y2="3363.0508"/><polygon fill="#181818" points="2712.25,3353.0508,2716.25,3363.0508,2720.25,3353.0508,2716.25,3357.0508" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="2720.25" y="3342.9565">Comm_Period4x_L</text><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3397.0195" y2="3432.0195"/><polygon fill="#181818" points="2712.25,3422.0195,2716.25,3432.0195,2720.25,3422.0195,2716.25,3426.0195" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3465.9883" y2="3500.9883"/><polygon fill="#181818" points="2712.25,3490.9883,2716.25,3500.9883,2720.25,3490.9883,2716.25,3494.9883" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3534.957" y2="3582.7617"/><polygon fill="#181818" points="2712.25,3572.7617,2716.25,3582.7617,2720.25,3572.7617,2716.25,3576.7617" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="106" x="2720.25" y="3562.6675">Comm_Period4x_H</text><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3616.7305" y2="3651.7305"/><polygon fill="#181818" points="2712.25,3641.7305,2716.25,3651.7305,2720.25,3641.7305,2716.25,3645.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3685.6992" y2="3720.6992"/><polygon fill="#181818" points="2712.25,3710.6992,2716.25,3720.6992,2720.25,3710.6992,2716.25,3714.6992" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3754.668" y2="3798.2935"/><polygon fill="#181818" points="2712.25,3788.2935,2716.25,3798.2935,2720.25,3788.2935,2716.25,3792.2935" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="322" x="2720.25" y="3778.1992">Temp2/1: This commutation period divided by (4, 2 or 1)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3832.2622" y2="3867.2622"/><polygon fill="#181818" points="2712.25,3857.2622,2716.25,3867.2622,2720.25,3857.2622,2716.25,3861.2622" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3901.231" y2="3936.231"/><polygon fill="#181818" points="2712.25,3926.231,2716.25,3936.231,2720.25,3926.231,2716.25,3930.231" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="3970.1997" y2="4005.1997"/><polygon fill="#181818" points="2712.25,3995.1997,2716.25,4005.1997,2720.25,3995.1997,2716.25,3999.1997" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="4039.1685" y2="4074.1685"/><polygon fill="#181818" points="2712.25,4064.1685,2716.25,4074.1685,2720.25,4064.1685,2716.25,4068.1685" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="4108.1372" y2="4143.1372"/><polygon fill="#181818" points="2712.25,4133.1372,2716.25,4143.1372,2720.25,4133.1372,2716.25,4137.1372" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="4307.2817" y2="4342.2817"/><polygon fill="#181818" points="2712.25,4332.2817,2716.25,4342.2817,2720.25,4332.2817,2716.25,4336.2817" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="4248.9106" y2="4273.313"/><polygon fill="#181818" points="2712.25,4263.313,2716.25,4273.313,2720.25,4263.313,2716.25,4267.313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2774.75" x2="2815.75" y1="4236.9106" y2="4236.9106"/><polygon fill="#181818" points="2811.75,4314.7817,2815.75,4324.7817,2819.75,4314.7817,2815.75,4318.7817" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2815.75" x2="2815.75" y1="4236.9106" y2="4412.6528"/><line style="stroke:#181818;stroke-width:1.0;" x1="2815.75" x2="2728.25" y1="4412.6528" y2="4412.6528"/><polygon fill="#181818" points="2738.25,4408.6528,2728.25,4412.6528,2738.25,4416.6528,2734.25,4412.6528" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="4376.2505" y2="4400.6528"/><polygon fill="#181818" points="2712.25,4390.6528,2716.25,4400.6528,2720.25,4390.6528,2716.25,4394.6528" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="4177.106" y2="4224.9106"/><polygon fill="#181818" points="2712.25,4214.9106,2716.25,4224.9106,2720.25,4214.9106,2716.25,4218.9106" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="156" x="2720.25" y="4204.8164">Is period larger than 0xffff?</text><line style="stroke:#181818;stroke-width:1.0;" x1="2555.5" x2="2452.75" y1="2133.5503" y2="2133.5503"/><line style="stroke:#181818;stroke-width:1.0;" x1="2452.75" x2="2452.75" y1="2133.5503" y2="2155.5503"/><polygon fill="#181818" points="2448.75,2145.5503,2452.75,2155.5503,2456.75,2145.5503,2452.75,2149.5503" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2613.5" x2="2716.25" y1="2133.5503" y2="2133.5503"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="2133.5503" y2="2155.5503"/><polygon fill="#181818" points="2712.25,2145.5503,2716.25,2155.5503,2720.25,2145.5503,2716.25,2149.5503" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2452.75" x2="2452.75" y1="2258.4878" y2="4442.6528"/><line style="stroke:#181818;stroke-width:1.0;" x1="2452.75" x2="2572.5" y1="4442.6528" y2="4442.6528"/><polygon fill="#181818" points="2562.5,4438.6528,2572.5,4442.6528,2562.5,4446.6528,2566.5,4442.6528" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2716.25" y1="4424.6528" y2="4442.6528"/><line style="stroke:#181818;stroke-width:1.0;" x1="2716.25" x2="2596.5" y1="4442.6528" y2="4442.6528"/><polygon fill="#181818" points="2606.5,4438.6528,2596.5,4442.6528,2606.5,4446.6528,2602.5,4442.6528" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="2072.1362" y2="2121.5503"/><polygon fill="#181818" points="2580.5,2111.5503,2584.5,2121.5503,2588.5,2111.5503,2584.5,2115.5503" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="143" x="2588.5" y="2100.6514">Check extended byte is 0</text><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="4454.6528" y2="4515.2622"/><polygon fill="#181818" points="2580.5,4505.2622,2584.5,4515.2622,2588.5,4505.2622,2584.5,4509.2622" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="135" x="2588.5" y="4482.3633">(calc_next_comm_done)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="294" x="2588.5" y="4495.168">Is Comm_Period4x_H below 2? (above ~160k erpm)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="4549.231" y2="4580.4692"/><polygon fill="#181818" points="2580.5,4570.4692,2584.5,4580.4692,2588.5,4570.4692,2584.5,4574.4692" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="4614.438" y2="4649.438"/><polygon fill="#181818" points="2580.5,4639.438,2584.5,4649.438,2588.5,4639.438,2584.5,4643.438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="4755.2114" y2="4779.6138"/><polygon fill="#181818" points="2580.5,4769.6138,2584.5,4779.6138,2588.5,4769.6138,2584.5,4773.6138" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2643" x2="2664" y1="4743.2114" y2="4743.2114"/><polygon fill="#181818" points="2660,4786.5981,2664,4796.5981,2668,4786.5981,2664,4790.5981" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2664" x2="2664" y1="4743.2114" y2="4849.9849"/><line style="stroke:#181818;stroke-width:1.0;" x1="2664" x2="2596.5" y1="4849.9849" y2="4849.9849"/><polygon fill="#181818" points="2606.5,4845.9849,2596.5,4849.9849,2606.5,4853.9849,2602.5,4849.9849" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="4813.5825" y2="4837.9849"/><polygon fill="#181818" points="2580.5,4827.9849,2584.5,4837.9849,2588.5,4827.9849,2584.5,4831.9849" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="4683.4067" y2="4731.2114"/><polygon fill="#181818" points="2580.5,4721.2114,2584.5,4731.2114,2588.5,4721.2114,2584.5,4725.2114" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="387" x="2588.5" y="4711.1172">Is Comm_Period4x_H below 2? (above ~160k erpm, CARRY_BIT is 1)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="4861.9849" y2="5012.2271"/><polygon fill="#181818" points="2580.5,5002.2271,2584.5,5012.2271,2588.5,5002.2271,2584.5,5006.2271" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="2588.5" y="4889.6953">(calc_next_comm_15deg)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="128" x="2588.5" y="4902.5">- Commutation period:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="151" x="2604.5" y="4915.3047">360 deg / 6 runs = 60 deg</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="114" x="2604.5" y="4928.1094">60 deg / 4 = 15 deg</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="222" x="2588.5" y="4940.9141">- Load current commutation timing and</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="131" x="2596.5" y="4953.7188">compute 15 deg timing</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="173" x="2588.5" y="4966.5234">- Divide Comm_Period4x by 16</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="172" x="2596.5" y="4979.3281">(Comm_Period1x divided by 4)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="123" x="2596.5" y="4992.1328">and store in Temp4/3</text><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="5046.1958" y2="5094.0005"/><polygon fill="#181818" points="2580.5,5084.0005,2584.5,5094.0005,2588.5,5084.0005,2584.5,5088.0005" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="144" x="2588.5" y="5073.9063">Subtract timing reduction</text><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="5127.9692" y2="5162.9692"/><polygon fill="#181818" points="2580.5,5152.9692,2584.5,5162.9692,2588.5,5152.9692,2584.5,5156.9692" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="5196.938" y2="5231.938"/><polygon fill="#181818" points="2580.5,5221.938,2584.5,5231.938,2588.5,5221.938,2584.5,5225.938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="5265.9067" y2="5300.9067"/><polygon fill="#181818" points="2580.5,5290.9067,2584.5,5300.9067,2588.5,5290.9067,2584.5,5294.9067" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="5334.8755" y2="5369.8755"/><polygon fill="#181818" points="2580.5,5359.8755,2584.5,5369.8755,2588.5,5359.8755,2584.5,5363.8755" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="5403.8442" y2="5438.8442"/><polygon fill="#181818" points="2580.5,5428.8442,2584.5,5438.8442,2588.5,5428.8442,2584.5,5432.8442" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="5472.813" y2="5507.813"/><polygon fill="#181818" points="2580.5,5497.813,2584.5,5507.813,2588.5,5497.813,2584.5,5501.813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2516" x2="2516" y1="5670.3599" y2="5705.3599"/><polygon fill="#181818" points="2512,5695.3599,2516,5705.3599,2520,5695.3599,2516,5699.3599" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2653" x2="2653" y1="5848.938" y2="5883.938"/><polygon fill="#181818" points="2649,5873.938,2653,5883.938,2657,5873.938,2653,5877.938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2653" x2="2653" y1="5790.5669" y2="5814.9692"/><polygon fill="#181818" points="2649,5804.9692,2653,5814.9692,2657,5804.9692,2653,5808.9692" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2685" x2="2707" y1="5778.5669" y2="5778.5669"/><polygon fill="#181818" points="2703,5856.438,2707,5866.438,2711,5856.438,2707,5860.438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2707" x2="2707" y1="5778.5669" y2="5949.9067"/><line style="stroke:#181818;stroke-width:1.0;" x1="2707" x2="2665" y1="5949.9067" y2="5949.9067"/><polygon fill="#181818" points="2675,5945.9067,2665,5949.9067,2675,5953.9067,2671,5949.9067" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2653" x2="2653" y1="5917.9067" y2="5937.9067"/><polygon fill="#181818" points="2649,5927.9067,2653,5937.9067,2657,5927.9067,2653,5931.9067" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2653" x2="2653" y1="5718.7622" y2="5766.5669"/><polygon fill="#181818" points="2649,5756.5669,2653,5766.5669,2657,5756.5669,2653,5760.5669" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="2657" y="5746.4727">Check Temp4::Temp3 is 0</text><line style="stroke:#181818;stroke-width:1.0;" x1="2653" x2="2653" y1="5660.3911" y2="5684.7935"/><polygon fill="#181818" points="2649,5674.7935,2653,5684.7935,2657,5674.7935,2653,5678.7935" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2685" x2="2816" y1="5648.3911" y2="5648.3911"/><polygon fill="#181818" points="2812,5815.5513,2816,5825.5513,2820,5815.5513,2816,5819.5513" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2816" x2="2816" y1="5648.3911" y2="5993.9067"/><line style="stroke:#181818;stroke-width:1.0;" x1="2816" x2="2665" y1="5993.9067" y2="5993.9067"/><polygon fill="#181818" points="2675,5989.9067,2665,5993.9067,2675,5997.9067,2671,5993.9067" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2653" x2="2653" y1="5961.9067" y2="5981.9067"/><polygon fill="#181818" points="2649,5971.9067,2653,5981.9067,2657,5971.9067,2653,5975.9067" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2526" x2="2516" y1="5614.3911" y2="5614.3911"/><line style="stroke:#181818;stroke-width:1.0;" x1="2516" x2="2516" y1="5614.3911" y2="5636.3911"/><polygon fill="#181818" points="2512,5626.3911,2516,5636.3911,2520,5626.3911,2516,5630.3911" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2643" x2="2653" y1="5614.3911" y2="5614.3911"/><line style="stroke:#181818;stroke-width:1.0;" x1="2653" x2="2653" y1="5614.3911" y2="5636.3911"/><polygon fill="#181818" points="2649,5626.3911,2653,5636.3911,2657,5626.3911,2653,5630.3911" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2516" x2="2516" y1="5739.3286" y2="6023.9067"/><line style="stroke:#181818;stroke-width:1.0;" x1="2516" x2="2572.5" y1="6023.9067" y2="6023.9067"/><polygon fill="#181818" points="2562.5,6019.9067,2572.5,6023.9067,2562.5,6027.9067,2566.5,6023.9067" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2653" x2="2653" y1="6005.9067" y2="6023.9067"/><line style="stroke:#181818;stroke-width:1.0;" x1="2653" x2="2596.5" y1="6023.9067" y2="6023.9067"/><polygon fill="#181818" points="2606.5,6019.9067,2596.5,6023.9067,2606.5,6027.9067,2602.5,6023.9067" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="5541.7817" y2="5602.3911"/><polygon fill="#181818" points="2580.5,5592.3911,2584.5,5602.3911,2588.5,5592.3911,2584.5,5596.3911" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="183" x="2588.5" y="5569.4922">Check that result is still positive</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="118" x="2596.5" y="5582.2969">(Temp4::Temp3 &lt; 0)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1519.6875" x2="623.875" y1="1063.2593" y2="1063.2593"/><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="1063.2593" y2="1085.2593"/><polygon fill="#181818" points="619.875,1075.2593,623.875,1085.2593,627.875,1075.2593,623.875,1079.2593" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1688.6875" x2="2584.5" y1="1063.2593" y2="1063.2593"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="1063.2593" y2="1085.2593"/><polygon fill="#181818" points="2580.5,1075.2593,2584.5,1085.2593,2588.5,1075.2593,2584.5,1079.2593" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="623.875" y1="5817.8364" y2="6053.9067"/><line style="stroke:#181818;stroke-width:1.0;" x1="623.875" x2="1592.1875" y1="6053.9067" y2="6053.9067"/><polygon fill="#181818" points="1582.1875,6049.9067,1592.1875,6053.9067,1582.1875,6057.9067,1586.1875,6053.9067" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="2584.5" y1="6035.9067" y2="6053.9067"/><line style="stroke:#181818;stroke-width:1.0;" x1="2584.5" x2="1616.1875" y1="6053.9067" y2="6053.9067"/><polygon fill="#181818" points="1626.1875,6049.9067,1616.1875,6053.9067,1626.1875,6057.9067,1622.1875,6053.9067" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="1031.2593" y2="1051.2593"/><polygon fill="#181818" points="1600.1875,1041.2593,1604.1875,1051.2593,1608.1875,1041.2593,1604.1875,1045.2593" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="6065.9067" y2="6184.1338"/><polygon fill="#181818" points="1600.1875,6174.1338,1604.1875,6184.1338,1608.1875,6174.1338,1604.1875,6178.1338" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="125" x="1608.1875" y="6087.2114">(wait_advance_timing)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="113" x="1608.1875" y="6100.0161">Wait advance timing</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="219" x="1608.1875" y="6112.8208">Waits for the advance timing to elapse</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="268" x="1608.1875" y="6125.6255">NOTE: Be VERY careful if using temp registers.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="194" x="1608.1875" y="6138.4302">They are passed over this routine</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="234" x="1608.1875" y="6151.2349">If it has not already, we wait here for the</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="1608.1875" y="6164.0396">Wt_Adv_Start_ delay to elapse.</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="6218.1025" y2="6374.7437"/><polygon fill="#181818" points="1600.1875,6364.7437,1604.1875,6374.7437,1608.1875,6364.7437,1604.1875,6368.7437" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="244" x="1608.1875" y="6239.4072">At this point Timer3 has (already) wrapped</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="268" x="1608.1875" y="6252.2119">and been reloaded with the Wt_Zc_Scan_Start_</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="1608.1875" y="6265.0166">delay.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="250" x="1608.1875" y="6277.8213">In case this delay has also elapsed, Timer3</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="237" x="1608.1875" y="6290.626">has been reloaded with a short delay any</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="99" x="1608.1875" y="6303.4307">number of times.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="239" x="1608.1875" y="6316.2354">- The interrupt flag is set and the pending</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="231" x="1608.1875" y="6329.04">flag will clear immediately after enabling</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="75" x="1608.1875" y="6341.8447">the interrupt.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="117" x="1608.1875" y="6354.6494">Setup next wait time</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="6408.7124" y2="6428.7124"/><polygon fill="#181818" points="1600.1875,6418.7124,1604.1875,6428.7124,1608.1875,6418.7124,1604.1875,6422.7124" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="6462.6812" y2="6482.6812"/><polygon fill="#181818" points="1600.1875,6472.6812,1604.1875,6482.6812,1608.1875,6472.6812,1604.1875,6476.6812" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="6516.6499" y2="6536.6499"/><polygon fill="#181818" points="1600.1875,6526.6499,1604.1875,6536.6499,1608.1875,6526.6499,1604.1875,6530.6499" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="6570.6187" y2="6637.627"/><polygon fill="#181818" points="1600.1875,6627.627,1604.1875,6637.627,1608.1875,6627.627,1604.1875,6631.627" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="126" x="1608.1875" y="6591.9233">(calc_new_wait_times)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="1608.1875" y="6604.728">Calculate new wait times</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="1608.1875" y="6617.5327">Load commutation timing setting</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="6671.5957" y2="6691.5957"/><polygon fill="#181818" points="1600.1875,6681.5957,1604.1875,6691.5957,1608.1875,6681.5957,1604.1875,6685.5957" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="6725.5645" y2="6766.9634"/><polygon fill="#181818" points="1600.1875,6756.9634,1604.1875,6766.9634,1608.1875,6756.9634,1604.1875,6760.9634" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="88" x="1608.1875" y="6746.8691">Store in Temp8</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="6800.9321" y2="6820.9321"/><polygon fill="#181818" points="1600.1875,6810.9321,1604.1875,6820.9321,1608.1875,6810.9321,1604.1875,6814.9321" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="6854.9009" y2="6874.9009"/><polygon fill="#181818" points="1600.1875,6864.9009,1604.1875,6874.9009,1608.1875,6864.9009,1604.1875,6868.9009" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="6908.8696" y2="6950.2686"/><polygon fill="#181818" points="1600.1875,6940.2686,1604.1875,6950.2686,1608.1875,6940.2686,1604.1875,6944.2686" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="40" x="1608.1875" y="6930.1743">Negate</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="6984.2373" y2="7004.2373"/><polygon fill="#181818" points="1600.1875,6994.2373,1604.1875,7004.2373,1608.1875,6994.2373,1604.1875,6998.2373" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="7038.2061" y2="7058.2061"/><polygon fill="#181818" points="1600.1875,7048.2061,1604.1875,7058.2061,1608.1875,7048.2061,1604.1875,7052.2061" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="7092.1748" y2="7112.1748"/><polygon fill="#181818" points="1600.1875,7102.1748,1604.1875,7112.1748,1608.1875,7102.1748,1604.1875,7106.1748" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="7146.1436" y2="7166.1436"/><polygon fill="#181818" points="1600.1875,7156.1436,1604.1875,7166.1436,1608.1875,7156.1436,1604.1875,7160.1436" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="7298.0811" y2="7339.48"/><polygon fill="#181818" points="1600.1875,7329.48,1604.1875,7339.48,1608.1875,7329.48,1604.1875,7333.48" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="70" x="1608.1875" y="7319.3857">Multiply by 2</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="7373.4487" y2="7393.4487"/><polygon fill="#181818" points="1600.1875,7383.4487,1604.1875,7393.4487,1608.1875,7383.4487,1604.1875,7387.4487" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="7244.1123" y2="7264.1123"/><polygon fill="#181818" points="1600.1875,7254.1123,1604.1875,7264.1123,1608.1875,7254.1123,1604.1875,7258.1123" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1668.1875" x2="1728.6875" y1="7232.1123" y2="7232.1123"/><polygon fill="#181818" points="1724.6875,7340.062,1728.6875,7350.062,1732.6875,7340.062,1728.6875,7344.062" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1728.6875" x2="1728.6875" y1="7232.1123" y2="7459.4175"/><line style="stroke:#181818;stroke-width:1.0;" x1="1728.6875" x2="1616.1875" y1="7459.4175" y2="7459.4175"/><polygon fill="#181818" points="1626.1875,7455.4175,1616.1875,7459.4175,1626.1875,7463.4175,1622.1875,7459.4175" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="7427.4175" y2="7447.4175"/><polygon fill="#181818" points="1600.1875,7437.4175,1604.1875,7447.4175,1608.1875,7437.4175,1604.1875,7441.4175" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="7200.1123" y2="7220.1123"/><polygon fill="#181818" points="1600.1875,7210.1123,1604.1875,7220.1123,1608.1875,7210.1123,1604.1875,7214.1123" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="956.1875" y1="7607.1992" y2="7642.1992"/><polygon fill="#181818" points="952.1875,7632.1992,956.1875,7642.1992,960.1875,7632.1992,956.1875,7636.1992" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="956.1875" y1="7676.168" y2="7723.9727"/><polygon fill="#181818" points="952.1875,7713.9727,956.1875,7723.9727,960.1875,7713.9727,956.1875,7717.9727" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="167" x="960.1875" y="7703.8784">Negative numbers - set carry</text><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="956.1875" y1="7757.9414" y2="7805.7461"/><polygon fill="#181818" points="952.1875,7795.7461,956.1875,7805.7461,960.1875,7795.7461,956.1875,7799.7461" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="62" x="960.1875" y="7785.6519">Divide by 2</text><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="956.1875" y1="7839.7148" y2="7874.7148"/><polygon fill="#181818" points="952.1875,7864.7148,956.1875,7874.7148,960.1875,7864.7148,956.1875,7868.7148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="956.1875" y1="7908.6836" y2="7956.4883"/><polygon fill="#181818" points="952.1875,7946.4883,956.1875,7956.4883,960.1875,7946.4883,956.1875,7950.4883" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="281" x="960.1875" y="7936.394">Use this value for zero cross scan delay (7.5deg)</text><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="956.1875" y1="7990.457" y2="8038.2617"/><polygon fill="#181818" points="952.1875,8028.2617,956.1875,8038.2617,960.1875,8028.2617,956.1875,8032.2617" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="249" x="960.1875" y="8018.1675">Set 15deg time for zero cross scan timeout</text><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="956.1875" y1="8072.2305" y2="8107.2305"/><polygon fill="#181818" points="952.1875,8097.2305,956.1875,8107.2305,960.1875,8097.2305,956.1875,8101.2305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="956.1875" y1="8141.1992" y2="8189.0039"/><polygon fill="#181818" points="952.1875,8179.0039,956.1875,8189.0039,960.1875,8179.0039,956.1875,8183.0039" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="188" x="960.1875" y="8168.9097">(Temp8 has Pgm_Comm_Timing)</text><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="956.1875" y1="8222.9727" y2="8270.7773"/><polygon fill="#181818" points="952.1875,8260.7773,956.1875,8270.7773,960.1875,8260.7773,956.1875,8264.7773" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="99" x="960.1875" y="8250.6831">Is timing normal?</text><line style="stroke:#181818;stroke-width:1.0;" x1="587.4375" x2="587.4375" y1="8422.1289" y2="8469.9336"/><polygon fill="#181818" points="583.4375,8459.9336,587.4375,8469.9336,591.4375,8459.9336,587.4375,8463.9336" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="287" x="591.4375" y="8449.8394">New commutation advance time (~15deg nominal)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1197.4375" x2="1197.4375" y1="8539.5117" y2="8574.5117"/><polygon fill="#181818" points="1193.4375,8564.5117,1197.4375,8574.5117,1201.4375,8564.5117,1197.4375,8568.5117" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1197.4375" x2="1197.4375" y1="8608.4805" y2="8643.4805"/><polygon fill="#181818" points="1193.4375,8633.4805,1197.4375,8643.4805,1201.4375,8633.4805,1197.4375,8637.4805" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1197.4375" x2="1197.4375" y1="8677.4492" y2="8712.4492"/><polygon fill="#181818" points="1193.4375,8702.4492,1197.4375,8712.4492,1201.4375,8702.4492,1197.4375,8706.4492" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1197.4375" x2="1197.4375" y1="8746.418" y2="8794.2227"/><polygon fill="#181818" points="1193.4375,8784.2227,1197.4375,8794.2227,1201.4375,8784.2227,1197.4375,8788.2227" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="1201.4375" y="8774.1284">Store minimum time in Temp3</text><line style="stroke:#181818;stroke-width:1.0;" x1="1452.4375" x2="1452.4375" y1="8539.5117" y2="8574.5117"/><polygon fill="#181818" points="1448.4375,8564.5117,1452.4375,8574.5117,1456.4375,8564.5117,1452.4375,8568.5117" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1452.4375" x2="1452.4375" y1="8608.4805" y2="8643.4805"/><polygon fill="#181818" points="1448.4375,8633.4805,1452.4375,8643.4805,1456.4375,8633.4805,1452.4375,8637.4805" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1452.4375" x2="1452.4375" y1="8677.4492" y2="8725.2539"/><polygon fill="#181818" points="1448.4375,8715.2539,1452.4375,8725.2539,1456.4375,8715.2539,1452.4375,8719.2539" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="131" x="1456.4375" y="8705.1597">Store 7.5deg in Temp3</text><line style="stroke:#181818;stroke-width:1.0;" x1="1452.4375" x2="1452.4375" y1="8759.2227" y2="8794.2227"/><polygon fill="#181818" points="1448.4375,8784.2227,1452.4375,8794.2227,1456.4375,8784.2227,1452.4375,8788.2227" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1287.4375" x2="1197.4375" y1="8483.543" y2="8483.543"/><line style="stroke:#181818;stroke-width:1.0;" x1="1197.4375" x2="1197.4375" y1="8483.543" y2="8505.543"/><polygon fill="#181818" points="1193.4375,8495.543,1197.4375,8505.543,1201.4375,8495.543,1197.4375,8499.543" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1362.4375" x2="1452.4375" y1="8483.543" y2="8483.543"/><line style="stroke:#181818;stroke-width:1.0;" x1="1452.4375" x2="1452.4375" y1="8483.543" y2="8505.543"/><polygon fill="#181818" points="1448.4375,8495.543,1452.4375,8505.543,1456.4375,8495.543,1452.4375,8499.543" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1197.4375" x2="1197.4375" y1="8828.1914" y2="8846.1914"/><line style="stroke:#181818;stroke-width:1.0;" x1="1197.4375" x2="1312.9375" y1="8846.1914" y2="8846.1914"/><polygon fill="#181818" points="1302.9375,8842.1914,1312.9375,8846.1914,1302.9375,8850.1914,1306.9375,8846.1914" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1452.4375" x2="1452.4375" y1="8828.1914" y2="8846.1914"/><line style="stroke:#181818;stroke-width:1.0;" x1="1452.4375" x2="1336.9375" y1="8846.1914" y2="8846.1914"/><polygon fill="#181818" points="1346.9375,8842.1914,1336.9375,8846.1914,1346.9375,8850.1914,1342.9375,8846.1914" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1324.9375" x2="1324.9375" y1="8422.1289" y2="8471.543"/><polygon fill="#181818" points="1320.9375,8461.543,1324.9375,8471.543,1328.9375,8461.543,1324.9375,8465.543" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="149" x="1328.9375" y="8450.644">If an odd number - branch</text><line style="stroke:#181818;stroke-width:1.0;" x1="1324.9375" x2="1324.9375" y1="8858.1914" y2="8905.9961"/><polygon fill="#181818" points="1320.9375,8895.9961,1324.9375,8905.9961,1328.9375,8895.9961,1324.9375,8899.9961" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="178" x="1328.9375" y="8885.9019">(store_times_up_or_down_fast)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1324.9375" x2="1324.9375" y1="8939.9648" y2="8973.4888"/><polygon fill="#181818" points="1320.9375,8963.4888,1324.9375,8973.4888,1328.9375,8963.4888,1324.9375,8967.4888" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1324.9375" x2="1324.9375" y1="9007.4575" y2="9055.2622"/><polygon fill="#181818" points="1320.9375,9045.2622,1324.9375,9055.2622,1328.9375,9045.2622,1324.9375,9049.2622" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="168" x="1328.9375" y="9035.168">Is timing higher than normal?</text><line style="stroke:#181818;stroke-width:1.0;" x1="1122.1875" x2="1122.1875" y1="9189.7783" y2="9237.583"/><polygon fill="#181818" points="1118.1875,9227.583,1122.1875,9237.583,1126.1875,9227.583,1122.1875,9231.583" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="287" x="1126.1875" y="9217.4888">New commutation advance time (~15deg nominal)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1527.6875" x2="1527.6875" y1="9189.7783" y2="9237.583"/><polygon fill="#181818" points="1523.6875,9227.583,1527.6875,9237.583,1531.6875,9227.583,1527.6875,9231.583" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="287" x="1531.6875" y="9217.4888">New commutation advance time (~15deg nominal)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1266.4375" x2="1122.1875" y1="9133.8096" y2="9133.8096"/><line style="stroke:#181818;stroke-width:1.0;" x1="1122.1875" x2="1122.1875" y1="9133.8096" y2="9155.8096"/><polygon fill="#181818" points="1118.1875,9145.8096,1122.1875,9155.8096,1126.1875,9145.8096,1122.1875,9149.8096" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1383.4375" x2="1527.6875" y1="9133.8096" y2="9133.8096"/><line style="stroke:#181818;stroke-width:1.0;" x1="1527.6875" x2="1527.6875" y1="9133.8096" y2="9155.8096"/><polygon fill="#181818" points="1523.6875,9145.8096,1527.6875,9155.8096,1531.6875,9145.8096,1527.6875,9149.8096" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1122.1875" x2="1122.1875" y1="9271.5518" y2="9289.5518"/><line style="stroke:#181818;stroke-width:1.0;" x1="1122.1875" x2="1312.9375" y1="9289.5518" y2="9289.5518"/><polygon fill="#181818" points="1302.9375,9285.5518,1312.9375,9289.5518,1302.9375,9293.5518,1306.9375,9289.5518" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1527.6875" x2="1527.6875" y1="9271.5518" y2="9289.5518"/><line style="stroke:#181818;stroke-width:1.0;" x1="1527.6875" x2="1336.9375" y1="9289.5518" y2="9289.5518"/><polygon fill="#181818" points="1346.9375,9285.5518,1336.9375,9289.5518,1346.9375,9293.5518,1342.9375,9289.5518" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1324.9375" x2="1324.9375" y1="9089.231" y2="9121.8096"/><polygon fill="#181818" points="1320.9375,9111.8096,1324.9375,9121.8096,1328.9375,9111.8096,1324.9375,9115.8096" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="924.1875" x2="587.4375" y1="8366.1602" y2="8366.1602"/><line style="stroke:#181818;stroke-width:1.0;" x1="587.4375" x2="587.4375" y1="8366.1602" y2="8388.1602"/><polygon fill="#181818" points="583.4375,8378.1602,587.4375,8388.1602,591.4375,8378.1602,587.4375,8382.1602" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="988.1875" x2="1324.9375" y1="8366.1602" y2="8366.1602"/><line style="stroke:#181818;stroke-width:1.0;" x1="1324.9375" x2="1324.9375" y1="8366.1602" y2="8388.1602"/><polygon fill="#181818" points="1320.9375,8378.1602,1324.9375,8388.1602,1328.9375,8378.1602,1324.9375,8382.1602" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="587.4375" x2="587.4375" y1="8503.9023" y2="9319.5518"/><line style="stroke:#181818;stroke-width:1.0;" x1="587.4375" x2="944.1875" y1="9319.5518" y2="9319.5518"/><polygon fill="#181818" points="934.1875,9315.5518,944.1875,9319.5518,934.1875,9323.5518,938.1875,9319.5518" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1324.9375" x2="1324.9375" y1="9301.5518" y2="9319.5518"/><line style="stroke:#181818;stroke-width:1.0;" x1="1324.9375" x2="968.1875" y1="9319.5518" y2="9319.5518"/><polygon fill="#181818" points="978.1875,9315.5518,968.1875,9319.5518,978.1875,9323.5518,974.1875,9319.5518" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="956.1875" y1="8304.7461" y2="8354.1602"/><polygon fill="#181818" points="952.1875,8344.1602,956.1875,8354.1602,960.1875,8344.1602,956.1875,8348.1602" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="7655.6133" y2="7703.418"/><polygon fill="#181818" points="2072.6875,7693.418,2076.6875,7703.418,2080.6875,7693.418,2076.6875,7697.418" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="117" x="2080.6875" y="7683.3237">Check demag metric</text><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="7737.3867" y2="7772.3867"/><polygon fill="#181818" points="2072.6875,7762.3867,2076.6875,7772.3867,2080.6875,7762.3867,2076.6875,7766.3867" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="7923.7266" y2="7971.5313"/><polygon fill="#181818" points="2072.6875,7961.5313,2076.6875,7971.5313,2080.6875,7961.5313,2076.6875,7965.5313" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="261" x="2080.6875" y="7951.437">Increase timing again (if metric 160 or above)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="8064.5" y2="8088.5"/><polygon fill="#181818" points="2072.6875,8078.5,2076.6875,8088.5,2080.6875,8078.5,2076.6875,8082.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2135.1875" x2="2160.6875" y1="8052.5" y2="8052.5"/><polygon fill="#181818" points="2156.6875,8095.4844,2160.6875,8105.4844,2164.6875,8095.4844,2160.6875,8099.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2160.6875" x2="2160.6875" y1="8052.5" y2="8158.4688"/><line style="stroke:#181818;stroke-width:1.0;" x1="2160.6875" x2="2088.6875" y1="8158.4688" y2="8158.4688"/><polygon fill="#181818" points="2098.6875,8154.4688,2088.6875,8158.4688,2098.6875,8162.4688,2094.6875,8158.4688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="8122.4688" y2="8146.4688"/><polygon fill="#181818" points="2072.6875,8136.4688,2076.6875,8146.4688,2080.6875,8136.4688,2076.6875,8140.4688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="8005.5" y2="8040.5"/><polygon fill="#181818" points="2072.6875,8030.5,2076.6875,8040.5,2080.6875,8030.5,2076.6875,8034.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="8170.4688" y2="8218.2734"/><polygon fill="#181818" points="2072.6875,8208.2734,2076.6875,8218.2734,2080.6875,8208.2734,2076.6875,8212.2734" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="109" x="2080.6875" y="8198.1792">Limit timing to max</text><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="8252.2422" y2="8287.2422"/><polygon fill="#181818" points="2072.6875,8277.2422,2076.6875,8287.2422,2080.6875,8277.2422,2076.6875,8281.2422" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="8321.2109" y2="8356.2109"/><polygon fill="#181818" points="2072.6875,8346.2109,2076.6875,8356.2109,2080.6875,8346.2109,2076.6875,8350.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="8449.1797" y2="8473.1797"/><polygon fill="#181818" points="2072.6875,8463.1797,2076.6875,8473.1797,2080.6875,8463.1797,2076.6875,8467.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2135.1875" x2="2147.1875" y1="8437.1797" y2="8437.1797"/><polygon fill="#181818" points="2143.1875,8480.1641,2147.1875,8490.1641,2151.1875,8480.1641,2147.1875,8484.1641" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2147.1875" x2="2147.1875" y1="8437.1797" y2="8543.1484"/><line style="stroke:#181818;stroke-width:1.0;" x1="2147.1875" x2="2088.6875" y1="8543.1484" y2="8543.1484"/><polygon fill="#181818" points="2098.6875,8539.1484,2088.6875,8543.1484,2098.6875,8547.1484,2094.6875,8543.1484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="8507.1484" y2="8531.1484"/><polygon fill="#181818" points="2072.6875,8521.1484,2076.6875,8531.1484,2080.6875,8521.1484,2076.6875,8525.1484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="8390.1797" y2="8425.1797"/><polygon fill="#181818" points="2072.6875,8415.1797,2076.6875,8425.1797,2080.6875,8415.1797,2076.6875,8419.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="7865.3555" y2="7889.7578"/><polygon fill="#181818" points="2072.6875,7879.7578,2076.6875,7889.7578,2080.6875,7879.7578,2076.6875,7883.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2135.1875" x2="2351.6875" y1="7853.3555" y2="7853.3555"/><polygon fill="#181818" points="2347.6875,8212.4531,2351.6875,8222.4531,2355.6875,8212.4531,2351.6875,8216.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2351.6875" x2="2351.6875" y1="7853.3555" y2="8591.5508"/><line style="stroke:#181818;stroke-width:1.0;" x1="2351.6875" x2="2088.6875" y1="8591.5508" y2="8591.5508"/><polygon fill="#181818" points="2098.6875,8587.5508,2088.6875,8591.5508,2098.6875,8595.5508,2094.6875,8591.5508" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="8555.1484" y2="8579.5508"/><polygon fill="#181818" points="2072.6875,8569.5508,2076.6875,8579.5508,2080.6875,8569.5508,2076.6875,8573.5508" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="7806.3555" y2="7841.3555"/><polygon fill="#181818" points="2072.6875,7831.3555,2076.6875,7841.3555,2080.6875,7831.3555,2076.6875,7835.3555" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2167.6875" x2="2076.6875" y1="7599.6445" y2="7599.6445"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="7599.6445" y2="7621.6445"/><polygon fill="#181818" points="2072.6875,7611.6445,2076.6875,7621.6445,2080.6875,7611.6445,2076.6875,7615.6445" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2336.6875" x2="2427.6875" y1="7599.6445" y2="7599.6445"/><line style="stroke:#181818;stroke-width:1.0;" x1="2427.6875" x2="2427.6875" y1="7599.6445" y2="7621.6445"/><polygon fill="#181818" points="2423.6875,7611.6445,2427.6875,7621.6445,2431.6875,7611.6445,2427.6875,7615.6445" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2076.6875" y1="8603.5508" y2="8621.5508"/><line style="stroke:#181818;stroke-width:1.0;" x1="2076.6875" x2="2240.1875" y1="8621.5508" y2="8621.5508"/><polygon fill="#181818" points="2230.1875,8617.5508,2240.1875,8621.5508,2230.1875,8625.5508,2234.1875,8621.5508" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2427.6875" x2="2427.6875" y1="7655.6133" y2="8621.5508"/><line style="stroke:#181818;stroke-width:1.0;" x1="2427.6875" x2="2264.1875" y1="8621.5508" y2="8621.5508"/><polygon fill="#181818" points="2274.1875,8617.5508,2264.1875,8621.5508,2274.1875,8625.5508,2270.1875,8621.5508" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="8633.5508" y2="8694.1602"/><polygon fill="#181818" points="2248.1875,8684.1602,2252.1875,8694.1602,2256.1875,8684.1602,2252.1875,8688.1602" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="148" x="2256.1875" y="8661.2612">(load_comm_timing_done)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="69" x="2256.1875" y="8674.0659">Copy values</text><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="8728.1289" y2="8763.1289"/><polygon fill="#181818" points="2248.1875,8753.1289,2252.1875,8763.1289,2256.1875,8753.1289,2252.1875,8757.1289" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="8797.0977" y2="8832.0977"/><polygon fill="#181818" points="2248.1875,8822.0977,2252.1875,8832.0977,2256.1875,8822.0977,2252.1875,8826.0977" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="8866.0664" y2="8901.0664"/><polygon fill="#181818" points="2248.1875,8891.0664,2252.1875,8901.0664,2256.1875,8891.0664,2252.1875,8895.0664" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="8935.0352" y2="8994.1685"/><polygon fill="#181818" points="2248.1875,8984.1685,2252.1875,8994.1685,2256.1875,8984.1685,2252.1875,8988.1685" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="167" x="2256.1875" y="8961.2695">Negative numbers - set carry</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="208" x="2256.1875" y="8974.0742">Store 7.5deg in Temp5/6 (15deg / 2)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9028.1372" y2="9063.1372"/><polygon fill="#181818" points="2248.1875,9053.1372,2252.1875,9063.1372,2256.1875,9053.1372,2252.1875,9057.1372" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9097.106" y2="9128.0752"/><polygon fill="#181818" points="2248.1875,9118.0752,2252.1875,9128.0752,2256.1875,9118.0752,2252.1875,9122.0752" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9162.0439" y2="9197.0439"/><polygon fill="#181818" points="2248.1875,9187.0439,2252.1875,9197.0439,2256.1875,9187.0439,2252.1875,9191.0439" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9231.0127" y2="9266.0127"/><polygon fill="#181818" points="2248.1875,9256.0127,2252.1875,9266.0127,2256.1875,9256.0127,2252.1875,9260.0127" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9299.9814" y2="9334.9814"/><polygon fill="#181818" points="2248.1875,9324.9814,2252.1875,9334.9814,2256.1875,9324.9814,2252.1875,9328.9814" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9368.9502" y2="9388.9502"/><polygon fill="#181818" points="2248.1875,9378.9502,2252.1875,9388.9502,2256.1875,9378.9502,2252.1875,9382.9502" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9422.9189" y2="9464.3179"/><polygon fill="#181818" points="2248.1875,9454.3179,2252.1875,9464.3179,2256.1875,9454.3179,2252.1875,9458.3179" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="240" x="2256.1875" y="9444.2236">Set 7.5deg time for zero cross scan delay</text><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9498.2866" y2="9518.2866"/><polygon fill="#181818" points="2248.1875,9508.2866,2252.1875,9518.2866,2256.1875,9508.2866,2252.1875,9512.2866" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9552.2554" y2="9593.6543"/><polygon fill="#181818" points="2248.1875,9583.6543,2252.1875,9593.6543,2256.1875,9583.6543,2252.1875,9587.6543" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="249" x="2256.1875" y="9573.5601">Set 15deg time for zero cross scan timeout</text><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9627.623" y2="9647.623"/><polygon fill="#181818" points="2248.1875,9637.623,2252.1875,9647.623,2256.1875,9637.623,2252.1875,9641.623" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9681.5918" y2="9748.6001"/><polygon fill="#181818" points="2248.1875,9738.6001,2252.1875,9748.6001,2256.1875,9738.6001,2252.1875,9742.6001" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="188" x="2256.1875" y="9702.8965">(Temp8 has Pgm_Comm_Timing)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="99" x="2264.1875" y="9715.7012">Is timing normal?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="72" x="2264.1875" y="9728.5059">Yes - branch</text><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9782.5688" y2="9802.5688"/><polygon fill="#181818" points="2248.1875,9792.5688,2252.1875,9802.5688,2256.1875,9792.5688,2252.1875,9796.5688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9836.5376" y2="9856.5376"/><polygon fill="#181818" points="2248.1875,9846.5376,2252.1875,9856.5376,2256.1875,9846.5376,2252.1875,9850.5376" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="10008.7881" y2="10031.8823"/><polygon fill="#181818" points="2014.5625,10021.8823,2018.5625,10031.8823,2022.5625,10021.8823,2018.5625,10025.8823" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="10065.8511" y2="10126.4604"/><polygon fill="#181818" points="2014.5625,10116.4604,2018.5625,10126.4604,2022.5625,10116.4604,2018.5625,10120.4604" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="2022.5625" y="10093.5615">New commutation advance</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="130" x="2022.5625" y="10106.3662">time (~15deg nominal)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="10160.4292" y2="10195.4292"/><polygon fill="#181818" points="2014.5625,10185.4292,2018.5625,10195.4292,2022.5625,10185.4292,2018.5625,10189.4292" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="10397.9878" y2="10432.9878"/><polygon fill="#181818" points="2014.5625,10422.9878,2018.5625,10432.9878,2022.5625,10422.9878,2018.5625,10426.9878" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="10466.9565" y2="10501.9565"/><polygon fill="#181818" points="2014.5625,10491.9565,2018.5625,10501.9565,2022.5625,10491.9565,2018.5625,10495.9565" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="10535.9253" y2="10570.9253"/><polygon fill="#181818" points="2014.5625,10560.9253,2018.5625,10570.9253,2022.5625,10560.9253,2018.5625,10564.9253" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="10604.894" y2="10639.894"/><polygon fill="#181818" points="2014.5625,10629.894,2018.5625,10639.894,2022.5625,10629.894,2018.5625,10633.894" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="10673.8628" y2="10708.8628"/><polygon fill="#181818" points="2014.5625,10698.8628,2018.5625,10708.8628,2022.5625,10698.8628,2018.5625,10702.8628" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="10339.6167" y2="10364.019"/><polygon fill="#181818" points="2014.5625,10354.019,2018.5625,10364.019,2022.5625,10354.019,2018.5625,10358.019" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2103.0625" x2="2119.5625" y1="10327.6167" y2="10327.6167"/><polygon fill="#181818" points="2115.5625,10543.4253,2119.5625,10553.4253,2123.5625,10543.4253,2119.5625,10547.4253" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2119.5625" x2="2119.5625" y1="10327.6167" y2="10779.2339"/><line style="stroke:#181818;stroke-width:1.0;" x1="2119.5625" x2="2030.5625" y1="10779.2339" y2="10779.2339"/><polygon fill="#181818" points="2040.5625,10775.2339,2030.5625,10779.2339,2040.5625,10783.2339,2036.5625,10779.2339" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="10742.8315" y2="10767.2339"/><polygon fill="#181818" points="2014.5625,10757.2339,2018.5625,10767.2339,2022.5625,10757.2339,2018.5625,10761.2339" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="10229.3979" y2="10315.6167"/><polygon fill="#181818" points="2014.5625,10305.6167,2018.5625,10315.6167,2022.5625,10305.6167,2018.5625,10309.6167" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="2022.5625" y="10257.1084">Set very short delays for</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="155" x="2022.5625" y="10269.9131">all but advance time during</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="146" x="2022.5625" y="10282.7178">startup, in order to widen</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="144" x="2022.5625" y="10295.5225">zero cross capture range</text><line style="stroke:#181818;stroke-width:1.0;" x1="2310.0625" x2="2310.0625" y1="10139.8745" y2="10174.8745"/><polygon fill="#181818" points="2306.0625,10164.8745,2310.0625,10174.8745,2314.0625,10164.8745,2310.0625,10168.8745" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2310.0625" x2="2310.0625" y1="10208.8433" y2="10243.8433"/><polygon fill="#181818" points="2306.0625,10233.8433,2310.0625,10243.8433,2314.0625,10233.8433,2310.0625,10237.8433" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2310.0625" x2="2310.0625" y1="10277.812" y2="10312.812"/><polygon fill="#181818" points="2306.0625,10302.812,2310.0625,10312.812,2314.0625,10302.812,2310.0625,10306.812" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2310.0625" x2="2310.0625" y1="10346.7808" y2="10381.7808"/><polygon fill="#181818" points="2306.0625,10371.7808,2310.0625,10381.7808,2314.0625,10371.7808,2310.0625,10375.7808" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2310.0625" x2="2310.0625" y1="10415.7495" y2="10450.7495"/><polygon fill="#181818" points="2306.0625,10440.7495,2310.0625,10450.7495,2314.0625,10440.7495,2310.0625,10444.7495" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2310.0625" x2="2310.0625" y1="10484.7183" y2="10519.7183"/><polygon fill="#181818" points="2306.0625,10509.7183,2310.0625,10519.7183,2314.0625,10509.7183,2310.0625,10513.7183" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2310.0625" x2="2310.0625" y1="10553.687" y2="10601.4917"/><polygon fill="#181818" points="2306.0625,10591.4917,2310.0625,10601.4917,2314.0625,10591.4917,2310.0625,10595.4917" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="225" x="2314.0625" y="10581.3975">Store minimum time (0deg) in Temp3/4</text><line style="stroke:#181818;stroke-width:1.0;" x1="2310.0625" x2="2310.0625" y1="10635.4604" y2="10670.4604"/><polygon fill="#181818" points="2306.0625,10660.4604,2310.0625,10670.4604,2314.0625,10660.4604,2310.0625,10664.4604" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2661.5625" x2="2661.5625" y1="10139.8745" y2="10174.8745"/><polygon fill="#181818" points="2657.5625,10164.8745,2661.5625,10174.8745,2665.5625,10164.8745,2661.5625,10168.8745" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2661.5625" x2="2661.5625" y1="10208.8433" y2="10243.8433"/><polygon fill="#181818" points="2657.5625,10233.8433,2661.5625,10243.8433,2665.5625,10233.8433,2661.5625,10237.8433" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2661.5625" x2="2661.5625" y1="10277.812" y2="10312.812"/><polygon fill="#181818" points="2657.5625,10302.812,2661.5625,10312.812,2665.5625,10302.812,2661.5625,10306.812" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2661.5625" x2="2661.5625" y1="10346.7808" y2="10381.7808"/><polygon fill="#181818" points="2657.5625,10371.7808,2661.5625,10381.7808,2665.5625,10371.7808,2661.5625,10375.7808" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2661.5625" x2="2661.5625" y1="10415.7495" y2="10450.7495"/><polygon fill="#181818" points="2657.5625,10440.7495,2661.5625,10450.7495,2665.5625,10440.7495,2661.5625,10444.7495" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2661.5625" x2="2661.5625" y1="10484.7183" y2="10519.7183"/><polygon fill="#181818" points="2657.5625,10509.7183,2661.5625,10519.7183,2665.5625,10509.7183,2661.5625,10513.7183" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2661.5625" x2="2661.5625" y1="10553.687" y2="10588.687"/><polygon fill="#181818" points="2657.5625,10578.687,2661.5625,10588.687,2665.5625,10578.687,2661.5625,10582.687" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2661.5625" x2="2661.5625" y1="10622.6558" y2="10657.6558"/><polygon fill="#181818" points="2657.5625,10647.6558,2661.5625,10657.6558,2665.5625,10647.6558,2661.5625,10651.6558" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2661.5625" x2="2661.5625" y1="10691.6245" y2="10726.6245"/><polygon fill="#181818" points="2657.5625,10716.6245,2661.5625,10726.6245,2665.5625,10716.6245,2661.5625,10720.6245" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2448.3125" x2="2310.0625" y1="10083.9058" y2="10083.9058"/><line style="stroke:#181818;stroke-width:1.0;" x1="2310.0625" x2="2310.0625" y1="10083.9058" y2="10105.9058"/><polygon fill="#181818" points="2306.0625,10095.9058,2310.0625,10105.9058,2314.0625,10095.9058,2310.0625,10099.9058" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2523.3125" x2="2661.5625" y1="10083.9058" y2="10083.9058"/><line style="stroke:#181818;stroke-width:1.0;" x1="2661.5625" x2="2661.5625" y1="10083.9058" y2="10105.9058"/><polygon fill="#181818" points="2657.5625,10095.9058,2661.5625,10105.9058,2665.5625,10095.9058,2661.5625,10099.9058" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2310.0625" x2="2310.0625" y1="10704.4292" y2="10778.5933"/><line style="stroke:#181818;stroke-width:1.0;" x1="2310.0625" x2="2473.8125" y1="10778.5933" y2="10778.5933"/><polygon fill="#181818" points="2463.8125,10774.5933,2473.8125,10778.5933,2463.8125,10782.5933,2467.8125,10778.5933" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2661.5625" x2="2661.5625" y1="10760.5933" y2="10778.5933"/><line style="stroke:#181818;stroke-width:1.0;" x1="2661.5625" x2="2497.8125" y1="10778.5933" y2="10778.5933"/><polygon fill="#181818" points="2507.8125,10774.5933,2497.8125,10778.5933,2507.8125,10782.5933,2503.8125,10778.5933" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2485.8125" x2="2485.8125" y1="10008.7881" y2="10071.9058"/><polygon fill="#181818" points="2481.8125,10061.9058,2485.8125,10071.9058,2489.8125,10061.9058,2485.8125,10065.9058" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2485.8125" x2="2485.8125" y1="10790.5933" y2="10845.4375"/><polygon fill="#181818" points="2481.8125,10835.4375,2485.8125,10845.4375,2489.8125,10835.4375,2485.8125,10839.4375" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150" x="2489.8125" y="10812.5386">(store_times_up_or_down)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="168" x="2489.8125" y="10825.3433">Is timing higher than normal?</text><line style="stroke:#181818;stroke-width:1.0;" x1="2485.8125" x2="2485.8125" y1="10879.4063" y2="10899.4063"/><polygon fill="#181818" points="2481.8125,10889.4063,2485.8125,10899.4063,2489.8125,10889.4063,2485.8125,10893.4063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2485.8125" x2="2485.8125" y1="10933.375" y2="10953.375"/><polygon fill="#181818" points="2481.8125,10943.375,2485.8125,10953.375,2489.8125,10943.375,2485.8125,10947.375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11105.6255" y2="11125.6255"/><polygon fill="#181818" points="2344.3125,11115.6255,2348.3125,11125.6255,2352.3125,11115.6255,2348.3125,11119.6255" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11159.5942" y2="11213.7979"/><polygon fill="#181818" points="2344.3125,11203.7979,2348.3125,11213.7979,2352.3125,11203.7979,2348.3125,11207.7979" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="2352.3125" y="11180.8989">New commutation advance</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="130" x="2352.3125" y="11193.7036">time (~15deg nominal)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11247.7666" y2="11267.7666"/><polygon fill="#181818" points="2344.3125,11257.7666,2348.3125,11267.7666,2352.3125,11257.7666,2348.3125,11261.7666" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11463.9194" y2="11483.9194"/><polygon fill="#181818" points="2344.3125,11473.9194,2348.3125,11483.9194,2352.3125,11473.9194,2348.3125,11477.9194" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11517.8882" y2="11537.8882"/><polygon fill="#181818" points="2344.3125,11527.8882,2348.3125,11537.8882,2352.3125,11527.8882,2348.3125,11531.8882" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11571.8569" y2="11606.8569"/><polygon fill="#181818" points="2344.3125,11596.8569,2348.3125,11606.8569,2352.3125,11596.8569,2348.3125,11600.8569" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11640.8257" y2="11660.8257"/><polygon fill="#181818" points="2344.3125,11650.8257,2348.3125,11660.8257,2352.3125,11650.8257,2348.3125,11654.8257" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11694.7944" y2="11714.7944"/><polygon fill="#181818" points="2344.3125,11704.7944,2348.3125,11714.7944,2352.3125,11704.7944,2348.3125,11708.7944" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11405.5483" y2="11429.9507"/><polygon fill="#181818" points="2344.3125,11419.9507,2348.3125,11429.9507,2352.3125,11419.9507,2348.3125,11423.9507" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2432.8125" x2="2449.3125" y1="11393.5483" y2="11393.5483"/><polygon fill="#181818" points="2445.3125,11579.3569,2449.3125,11589.3569,2453.3125,11579.3569,2449.3125,11583.3569" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2449.3125" x2="2449.3125" y1="11393.5483" y2="11780.7632"/><line style="stroke:#181818;stroke-width:1.0;" x1="2449.3125" x2="2360.3125" y1="11780.7632" y2="11780.7632"/><polygon fill="#181818" points="2370.3125,11776.7632,2360.3125,11780.7632,2370.3125,11784.7632,2366.3125,11780.7632" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11748.7632" y2="11768.7632"/><polygon fill="#181818" points="2344.3125,11758.7632,2348.3125,11768.7632,2352.3125,11758.7632,2348.3125,11762.7632" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11301.7354" y2="11381.5483"/><polygon fill="#181818" points="2344.3125,11371.5483,2348.3125,11381.5483,2352.3125,11371.5483,2348.3125,11375.5483" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="2352.3125" y="11323.04">Set very short delays for</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="155" x="2352.3125" y="11335.8447">all but advance time during</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="146" x="2352.3125" y="11348.6494">startup, in order to widen</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="144" x="2352.3125" y="11361.4541">zero cross capture range</text><line style="stroke:#181818;stroke-width:1.0;" x1="2623.3125" x2="2623.3125" y1="11105.6255" y2="11125.6255"/><polygon fill="#181818" points="2619.3125,11115.6255,2623.3125,11125.6255,2627.3125,11115.6255,2623.3125,11119.6255" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2623.3125" x2="2623.3125" y1="11159.5942" y2="11213.7979"/><polygon fill="#181818" points="2619.3125,11203.7979,2623.3125,11213.7979,2627.3125,11203.7979,2623.3125,11207.7979" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="182" x="2627.3125" y="11180.8989">New commutation advance time</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="101" x="2627.3125" y="11193.7036">(~15deg nominal)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2623.3125" x2="2623.3125" y1="11247.7666" y2="11267.7666"/><polygon fill="#181818" points="2619.3125,11257.7666,2623.3125,11267.7666,2627.3125,11257.7666,2623.3125,11261.7666" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2427.3125" x2="2348.3125" y1="11049.6567" y2="11049.6567"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11049.6567" y2="11071.6567"/><polygon fill="#181818" points="2344.3125,11061.6567,2348.3125,11071.6567,2352.3125,11061.6567,2348.3125,11065.6567" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2544.3125" x2="2623.3125" y1="11049.6567" y2="11049.6567"/><line style="stroke:#181818;stroke-width:1.0;" x1="2623.3125" x2="2623.3125" y1="11049.6567" y2="11071.6567"/><polygon fill="#181818" points="2619.3125,11061.6567,2623.3125,11071.6567,2627.3125,11061.6567,2623.3125,11065.6567" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2348.3125" y1="11792.7632" y2="11810.7632"/><line style="stroke:#181818;stroke-width:1.0;" x1="2348.3125" x2="2473.8125" y1="11810.7632" y2="11810.7632"/><polygon fill="#181818" points="2463.8125,11806.7632,2473.8125,11810.7632,2463.8125,11814.7632,2467.8125,11810.7632" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2623.3125" x2="2623.3125" y1="11301.7354" y2="11810.7632"/><line style="stroke:#181818;stroke-width:1.0;" x1="2623.3125" x2="2497.8125" y1="11810.7632" y2="11810.7632"/><polygon fill="#181818" points="2507.8125,11806.7632,2497.8125,11810.7632,2507.8125,11814.7632,2503.8125,11810.7632" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2485.8125" x2="2485.8125" y1="10987.3438" y2="11037.6567"/><polygon fill="#181818" points="2481.8125,11027.6567,2485.8125,11037.6567,2489.8125,11027.6567,2485.8125,11031.6567" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2220.1875" x2="2018.5625" y1="9952.8193" y2="9952.8193"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="9952.8193" y2="9974.8193"/><polygon fill="#181818" points="2014.5625,9964.8193,2018.5625,9974.8193,2022.5625,9964.8193,2018.5625,9968.8193" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2284.1875" x2="2485.8125" y1="9952.8193" y2="9952.8193"/><line style="stroke:#181818;stroke-width:1.0;" x1="2485.8125" x2="2485.8125" y1="9952.8193" y2="9974.8193"/><polygon fill="#181818" points="2481.8125,9964.8193,2485.8125,9974.8193,2489.8125,9964.8193,2485.8125,9968.8193" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2018.5625" y1="10791.2339" y2="11840.7632"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5625" x2="2240.1875" y1="11840.7632" y2="11840.7632"/><polygon fill="#181818" points="2230.1875,11836.7632,2240.1875,11840.7632,2230.1875,11844.7632,2234.1875,11840.7632" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2485.8125" x2="2485.8125" y1="11822.7632" y2="11840.7632"/><line style="stroke:#181818;stroke-width:1.0;" x1="2485.8125" x2="2264.1875" y1="11840.7632" y2="11840.7632"/><polygon fill="#181818" points="2274.1875,11836.7632,2264.1875,11840.7632,2274.1875,11844.7632,2270.1875,11840.7632" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="9890.5063" y2="9940.8193"/><polygon fill="#181818" points="2248.1875,9930.8193,2252.1875,9940.8193,2256.1875,9930.8193,2252.1875,9934.8193" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1533.1875" x2="956.1875" y1="7551.2305" y2="7551.2305"/><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="956.1875" y1="7551.2305" y2="7573.2305"/><polygon fill="#181818" points="952.1875,7563.2305,956.1875,7573.2305,960.1875,7563.2305,956.1875,7567.2305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1675.1875" x2="2252.1875" y1="7551.2305" y2="7551.2305"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="7551.2305" y2="7587.6445"/><polygon fill="#181818" points="2248.1875,7577.6445,2252.1875,7587.6445,2256.1875,7577.6445,2252.1875,7581.6445" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="956.1875" y1="9331.5518" y2="11870.7632"/><line style="stroke:#181818;stroke-width:1.0;" x1="956.1875" x2="1592.1875" y1="11870.7632" y2="11870.7632"/><polygon fill="#181818" points="1582.1875,11866.7632,1592.1875,11870.7632,1582.1875,11874.7632,1586.1875,11870.7632" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="2252.1875" y1="11852.7632" y2="11870.7632"/><line style="stroke:#181818;stroke-width:1.0;" x1="2252.1875" x2="1616.1875" y1="11870.7632" y2="11870.7632"/><polygon fill="#181818" points="1626.1875,11866.7632,1616.1875,11870.7632,1626.1875,11874.7632,1622.1875,11870.7632" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="7471.4175" y2="7539.2305"/><polygon fill="#181818" points="1600.1875,7529.2305,1604.1875,7539.2305,1608.1875,7529.2305,1604.1875,7533.2305" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="186" x="1608.1875" y="7492.7222">Temp2/1 = 15deg Timer2 period</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="106" x="1608.1875" y="7505.5269">Branch if high rpm</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="11882.7632" y2="11962.5762"/><polygon fill="#181818" points="1600.1875,11952.5762,1604.1875,11962.5762,1608.1875,11952.5762,1604.1875,11956.5762" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="124" x="1608.1875" y="11904.0679">(wait_before_zc_scan)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="159" x="1608.1875" y="11916.8726">Wait before zero cross scan</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="280" x="1608.1875" y="11929.6772">Waits for the zero cross scan wait time to elapse</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="441" x="1608.1875" y="11942.4819">If it has not already, we wait here for the Wt_Zc_Scan_Start_ delay to elapse.</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="11996.5449" y2="12063.5532"/><polygon fill="#181818" points="1600.1875,12053.5532,1604.1875,12063.5532,1608.1875,12053.5532,1604.1875,12057.5532" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="553" x="1608.1875" y="12017.8496">At this point Timer3 has (already) wrapped and been reloaded with the Wt_ZC_Tout_Start_ delay.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="594" x="1608.1875" y="12030.6543">In case this delay has also elapsed, Timer3 has been reloaded with a short delay any number of times.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="553" x="1608.1875" y="12043.459">- The interrupt flag is set and the pending flag will clear immediately after enabling the interrupt.</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12097.522" y2="12117.522"/><polygon fill="#181818" points="1600.1875,12107.522,1604.1875,12117.522,1608.1875,12107.522,1604.1875,12111.522" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12151.4907" y2="12192.8896"/><polygon fill="#181818" points="1600.1875,12182.8896,1604.1875,12192.8896,1608.1875,12182.8896,1604.1875,12186.8896" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="1608.1875" y="12172.7954">Enable Timer3 interrupts</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12329.2295" y2="12349.2295"/><polygon fill="#181818" points="1600.1875,12339.2295,1604.1875,12349.2295,1608.1875,12339.2295,1604.1875,12343.2295" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12383.1982" y2="12403.1982"/><polygon fill="#181818" points="1600.1875,12393.1982,1604.1875,12403.1982,1608.1875,12393.1982,1604.1875,12397.1982" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12437.167" y2="12457.167"/><polygon fill="#181818" points="1600.1875,12447.167,1604.1875,12457.167,1608.1875,12447.167,1604.1875,12451.167" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12491.1357" y2="12511.1357"/><polygon fill="#181818" points="1600.1875,12501.1357,1604.1875,12511.1357,1608.1875,12501.1357,1604.1875,12505.1357" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12643.0732" y2="12663.0732"/><polygon fill="#181818" points="1600.1875,12653.0732,1604.1875,12663.0732,1608.1875,12653.0732,1604.1875,12657.0732" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12697.042" y2="12717.042"/><polygon fill="#181818" points="1600.1875,12707.042,1604.1875,12717.042,1608.1875,12707.042,1604.1875,12711.042" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12589.1045" y2="12609.1045"/><polygon fill="#181818" points="1600.1875,12599.1045,1604.1875,12609.1045,1608.1875,12599.1045,1604.1875,12603.1045" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1668.1875" x2="1728.6875" y1="12577.1045" y2="12577.1045"/><polygon fill="#181818" points="1724.6875,12670.0576,1728.6875,12680.0576,1732.6875,12670.0576,1728.6875,12674.0576" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1728.6875" x2="1728.6875" y1="12577.1045" y2="12783.0107"/><line style="stroke:#181818;stroke-width:1.0;" x1="1728.6875" x2="1616.1875" y1="12783.0107" y2="12783.0107"/><polygon fill="#181818" points="1626.1875,12779.0107,1616.1875,12783.0107,1626.1875,12787.0107,1622.1875,12783.0107" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12751.0107" y2="12771.0107"/><polygon fill="#181818" points="1600.1875,12761.0107,1604.1875,12771.0107,1608.1875,12761.0107,1604.1875,12765.0107" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12545.1045" y2="12565.1045"/><polygon fill="#181818" points="1600.1875,12555.1045,1604.1875,12565.1045,1608.1875,12555.1045,1604.1875,12559.1045" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12897.3818" y2="12917.3818"/><polygon fill="#181818" points="1600.1875,12907.3818,1604.1875,12917.3818,1608.1875,12907.3818,1604.1875,12911.3818" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12951.3506" y2="12971.3506"/><polygon fill="#181818" points="1600.1875,12961.3506,1604.1875,12971.3506,1608.1875,12961.3506,1604.1875,12965.3506" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12839.0107" y2="12863.4131"/><polygon fill="#181818" points="1600.1875,12853.4131,1604.1875,12863.4131,1608.1875,12853.4131,1604.1875,12857.4131" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1688.6875" x2="1700.6875" y1="12827.0107" y2="12827.0107"/><polygon fill="#181818" points="1696.6875,12924.3662,1700.6875,12934.3662,1704.6875,12924.3662,1700.6875,12928.3662" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1700.6875" x2="1700.6875" y1="12827.0107" y2="13037.3193"/><line style="stroke:#181818;stroke-width:1.0;" x1="1700.6875" x2="1616.1875" y1="13037.3193" y2="13037.3193"/><polygon fill="#181818" points="1626.1875,13033.3193,1616.1875,13037.3193,1626.1875,13041.3193,1622.1875,13037.3193" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13005.3193" y2="13025.3193"/><polygon fill="#181818" points="1600.1875,13015.3193,1604.1875,13025.3193,1608.1875,13015.3193,1604.1875,13019.3193" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12795.0107" y2="12815.0107"/><polygon fill="#181818" points="1600.1875,12805.0107,1604.1875,12815.0107,1608.1875,12805.0107,1604.1875,12809.0107" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13049.3193" y2="13090.7183"/><polygon fill="#181818" points="1600.1875,13080.7183,1604.1875,13090.7183,1608.1875,13080.7183,1604.1875,13084.7183" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="146" x="1608.1875" y="13070.624">Disable Timer3 interrupts</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13124.687" y2="13144.687"/><polygon fill="#181818" points="1600.1875,13134.687,1604.1875,13144.687,1608.1875,13134.687,1604.1875,13138.687" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13178.6558" y2="13220.0547"/><polygon fill="#181818" points="1600.1875,13210.0547,1604.1875,13220.0547,1608.1875,13210.0547,1604.1875,13214.0547" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="241" x="1608.1875" y="13199.9604">Timer3 disabled and interrupt flag cleared</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13254.0234" y2="13295.4224"/><polygon fill="#181818" points="1600.1875,13285.4224,1604.1875,13295.4224,1608.1875,13285.4224,1604.1875,13289.4224" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="1608.1875" y="13275.3281">Set timeout</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13329.3911" y2="13349.3911"/><polygon fill="#181818" points="1600.1875,13339.3911,1604.1875,13349.3911,1608.1875,13339.3911,1604.1875,13343.3911" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13383.3599" y2="13403.3599"/><polygon fill="#181818" points="1600.1875,13393.3599,1604.1875,13403.3599,1608.1875,13393.3599,1604.1875,13397.3599" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13437.3286" y2="13457.3286"/><polygon fill="#181818" points="1600.1875,13447.3286,1604.1875,13457.3286,1608.1875,13447.3286,1604.1875,13451.3286" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13491.2974" y2="13511.2974"/><polygon fill="#181818" points="1600.1875,13501.2974,1604.1875,13511.2974,1608.1875,13501.2974,1604.1875,13505.2974" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13545.2661" y2="13565.2661"/><polygon fill="#181818" points="1600.1875,13555.2661,1604.1875,13565.2661,1608.1875,13555.2661,1604.1875,13559.2661" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13599.2349" y2="13619.2349"/><polygon fill="#181818" points="1600.1875,13609.2349,1604.1875,13619.2349,1608.1875,13609.2349,1604.1875,13613.2349" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13653.2036" y2="13694.6025"/><polygon fill="#181818" points="1600.1875,13684.6025,1604.1875,13694.6025,1608.1875,13684.6025,1604.1875,13688.6025" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="238" x="1608.1875" y="13674.5083">Timer3 enabled and interrupt flag cleared</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13728.5713" y2="13748.5713"/><polygon fill="#181818" points="1600.1875,13738.5713,1604.1875,13748.5713,1608.1875,13738.5713,1604.1875,13742.5713" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13782.54" y2="13823.939"/><polygon fill="#181818" points="1600.1875,13813.939,1604.1875,13823.939,1608.1875,13813.939,1604.1875,13817.939" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="1608.1875" y="13803.8447">Enable Timer3 interrupts</text><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13857.9077" y2="13877.9077"/><polygon fill="#181818" points="1600.1875,13867.9077,1604.1875,13877.9077,1608.1875,13867.9077,1604.1875,13871.9077" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12270.8584" y2="12295.2607"/><polygon fill="#181818" points="1600.1875,12285.2607,1604.1875,12295.2607,1608.1875,12285.2607,1604.1875,12289.2607" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1696.1875" x2="1859.1875" y1="12258.8584" y2="12258.8584"/><polygon fill="#181818" points="1855.1875,13089.4761,1859.1875,13099.4761,1863.1875,13089.4761,1859.1875,13093.4761" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1859.1875" x2="1859.1875" y1="12258.8584" y2="13943.8765"/><line style="stroke:#181818;stroke-width:1.0;" x1="1859.1875" x2="1616.1875" y1="13943.8765" y2="13943.8765"/><polygon fill="#181818" points="1626.1875,13939.8765,1616.1875,13943.8765,1626.1875,13947.8765,1622.1875,13943.8765" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13911.8765" y2="13931.8765"/><polygon fill="#181818" points="1600.1875,13921.8765,1604.1875,13931.8765,1608.1875,13921.8765,1604.1875,13925.8765" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="12226.8584" y2="12246.8584"/><polygon fill="#181818" points="1600.1875,12236.8584,1604.1875,12246.8584,1608.1875,12236.8584,1604.1875,12240.8584" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="13955.8765" y2="13975.8765"/><polygon fill="#181818" points="1600.1875,13965.8765,1604.1875,13975.8765,1608.1875,13965.8765,1604.1875,13969.8765" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1604.1875" x2="1604.1875" y1="14009.8452" y2="14029.8452"/><polygon fill="#181818" points="1600.1875,14019.8452,1604.1875,14029.8452,1608.1875,14019.8452,1604.1875,14023.8452" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[3fcd67189a62cc3361c67b74edeafa02]
@startuml 
start
->Calculate next commutation period

Measure the duration of current commutation period,
and update Comm_Period4x by averaging a fraction of it.

Called immediately after each commutation

Stop global & timer 2 interrupts & Read commutation time;
:IE_EA = 0;
:TMR2CN0_TR2 = 0;
:Temp1 = TMR2L;
:Temp2 = TMR2H;
:Temp3 = Timer2_X;
->Check if interrupt is pending;
if (TMR2CN0_TF2H == 1) then
  ->yes -> If it is pending, then timer has already wrapped;
  :Temp3++;
endif
->Enable global & timer 2 interrupts again;
:IE_EA = 1;
:TMR2CN0_TR2 = 1;
if (MCU_48MHZ == 1) then
  ->yes -> divide time by 2;
  :CARRY_BIT = 0;
  :Temp3 = CARRY_BIT::Temp3 >> 1;
  :Temp2 = CARRY_BIT::Temp2 >> 1;
  :Temp1 = CARRY_BIT::Temp1 >> 1;
endif
if (Flag_Startup_Phase == 0) then
  ->yes -> Calculate this commutation time;
  :CARRY_BIT = 0;
  :A = Temp1;
  :A = A - Prev_Comm_L;
  ->Save timestamp as previous commutation;
  :Prev_Comm_L = Temp1;
  ->Temp1 = Temp1 - (Prev_Comm_L + CARRY_BIT); 
  :Temp1 = A;
  :A = Temp2;
  :A = A - (Prev_Comm_H + CARRY_BIT);
  ->Save timestamp as previous commutation;
  :Prev_Comm_H = Temp2;
  if (MCU_48MHZ == 1) then
    :A = A & 0x7F;
  endif
  ->Temp2 = Temp2 - (Prev_Comm_H + CARRY_BIT); 
  :Temp2 = A;
  ->Check high or normal rpm;
  if (Flag_High_Rpm == 1) then
    ->yes -> high RPM
    Fast calculation (Comm_Period4x_H less than 2)
    Comm_Period4x holds the time of 4 commutations
    (calc_next_comm_period_fast);
    :Temp3 = Comm_Period4x_L;
    :Temp4 = Comm_Period4x_H;
    ->Divide by 16 and store in Temp5;
    :Divide_12Bit_By_16	Temp4, Temp3, Temp5;
    ->Subtract a fraction;
    :CARRY_BIT = 0;
    :A = Temp3;
    :A = A - Temp5;
    :Temp3 = A;
    :A = Temp4;
    :A = A - (0 + CARRY_BIT);
    :Temp4 = A;
    ->Note: Temp2 is assumed to be zero (approx. Comm_Period4x_H / 4);
    :A = Temp1;
    :A = A >> 1;
    :A = A >> 1;
    :A = A & 0x3F;
    ->Add the divided new time;
    :A = A + Temp3;
    :A = A + (0 + CARRY_BIT);
    :Temp4 = A;
    ->Store Comm_Period4x;
    :Comm_Period4x_L = Temp3;
    :Comm_Period4x_H = Temp4;
    ->Is Comm_Period4x_H 2 or more? (below ~160k erpm);
    :CARRY_BIT = 0;
    :A = A - 2;
    if (CARRY_BIT == 1) then
      ->Yes - Clear high rpm bit;
      :Flag_High_Rpm = 0;
    endif
    ->Divide Comm_Period4x by 16 and store in Temp4/3;
    :A = Temp4;
    ->Exchange lo/hi 4bits (nibbles)
    :SWAP A;
    :Temp7 = A;
    ->Clear waiting time high byte;
    :Temp4 = 0;
    :A = Temp3;
    ->Exchange lo/hi 4bits (nibbles)
    :SWAP A;
    :A = A & 0x0F;
    :A = A | Temp7;
    ->Timing reduction;
    :CARRY_BIT = 0;
    :A = A - 2;
    :Temp3 = A;
    ->Check A < 2;
    if (CARRY_BIT == 1) then
      ->yes -> Set minimum waiting time
      (Timers cannot wait for a delay of 0);
      :Temp3 = 1;
    endif
  else
    ->no -> normal RPM
    Prepare averaging by dividing Comm_Period4x and
    current commutation period (Temp2/1) according to speed;
    :Temp3 = Comm_Period4x_L;
    :Temp4 = Comm_Period4x_H;
    :CARRY_BIT = 0;
    :A = Temp4;
    :A = A - 4;
    ->Check Comm_Period4x_H < 4 
    (CARRY_BIT is 1)
    above ~80k erpm;
    if (CARRY_BIT == 1) then
      ->yes -> Use averaging for high speeds
      Update Comm_Period4x from 1/4 new commutation period
      Divide Temp4/3 by 16 and store in Temp5
      (calc_next_comm_div_16_4);
      :Divide_12Bit_By_16	Temp4, Temp3, Temp5;
      :Temp6 = 0;
      ->Divide Temp2/1 by 4 and store in Temp2/1;
      :Divide_By_4	Temp2, Temp1, Temp2, Temp1;
    else
      ->no -> Check Comm_Period4x_H < 8;
      :A = A - 4;
      ->Check Comm_Period4x_H < 8 
      (CARRY_BIT is 1)
      above ~40k erpm;
      if (CARRY_BIT == 1) then
        ->Yes -> Use averaging for low speeds
        Update Comm_Period4x from 1/2 new commutation period
		Divide Temp4/3 by 8 and store in Temp5
		(calc_next_comm_div_8_2);
        :Divide_11Bit_By_8	Temp4, Temp3, Temp5;
        :Temp6 = 0;
        ->Divide by 2;
        :CARRY_BIT = 0;
        :Temp2 = CARRY_BIT::Temp2 >> 1;
        :Temp1 = CARRY_BIT::Temp1 >> 1;
      else
        ->No -> Use averaging for even lower speeds;
        if (Flag_Initial_Run_Phase == 1) then
          ->Yes -> Do not average very fast during initial run
          Update Comm_Period4x from 1/2 new commutation period
          Divide Temp4/3 by 8 and store in Temp6/5
          (calc_next_comm_div_8_2_slow);
          :Divide_By_8	Temp4, Temp3, Temp6, Temp5;
          ->Divide by 2;
          :CARRY_BIT = 0;
          :Temp2 = CARRY_BIT::Temp2 >> 1;
          :Temp1 = CARRY_BIT::Temp1 >> 1;
        else
          ->no
          (calc_next_comm_div_4_1);
          :TDivide_By_4	Temp4, Temp3, Temp6, Temp5;
        endif
      endif
    endif
    
    ->(calc_next_comm_average_and_update)
    Comm_Period4x = 
        Comm_Period4x - (Comm_Period4x / (16, 8 or 4)) +
        (Comm_Period / (4, 2 or 1))
	Temp6/5: Comm_Period4x divided by (16, 8 or 4)
	Subtract a fraction;
    :CARRI_BIT = 0;
    ->Comm_Period4x_L;
    :A = Temp3;
    :A = A - (Temp5 + CARRY_BIT);
    :Temp3 = A;
    ->Comm_Period4x_H;
    :A = Temp4;
    :A = A - (Temp4 + CARRY_BIT);
    :Temp4 = A;
    ->Temp2/1: This commutation period divided by (4, 2 or 1);
	:A = Temp3;
	:A = A + Temp1;
	:Comm_Period4x_L = A;
	:A = Temp4;
	:A = A + Temp2 + CARRY_BIT;
	:Comm_Period4x_H = A;   
	->Is period larger than 0xffff?;
	if (CARRY_BIT == 1) then
	  ->Yes -> Set commutation period registers to very slow timing (0xffff);
	  :Comm_Period4x_L = 0xFF;
	  :Comm_Period4x_H = 0xFF;
	endif

    ->(calc_next_comm_done)
    Is Comm_Period4x_H below 2? (above ~160k erpm);
    :CARRY_BIT = 0;
    :A = Comm_Period4x_H;
    :A = A - 2;
    ->Is Comm_Period4x_H below 2? (above ~160k erpm, CARRY_BIT is 1);
    if (CARRY_BIT == 1) then
      ->yes -> Set high rpm flag;
      :Flag_High_Rpm = 1;
    endif
    	
    ->(calc_next_comm_15deg)
    - Commutation period: 
        360 deg / 6 runs = 60 deg
        60 deg / 4 = 15 deg
    - Load current commutation timing and
      compute 15 deg timing
    - Divide Comm_Period4x by 16 
      (Comm_Period1x divided by 4)
      and store in Temp4/3;
    :Divide_By_16	Comm_Period4x_H, Comm_Period4x_L, Temp4, Temp3;
    ->Subtract timing reduction;
    :CARRY_BIT = 0;
    :A = Temp3;
    :A = A - (2 + CARRY_BIT);
    :Temp3 = A;
    :A = Temp4;
    :A = A - (0 + CARRY_BIT);
    :Temp4 = A;
    ->Check that result is still positive
      (Temp4::Temp3 < 0);
    if (CARRY_BIT == 1) then
      ->yes -> Set minimum waiting time (Timers cannot wait for a delay of 0);
      :Temp3 = 1;
      :Temp4 = 0;
    else
      if (A == 0) then
        ->yes -> Check Temp3 is 0;
        :A = Temp3;
        ->Check Temp4::Temp3 is 0;
        if (A == 0) then
          ->yes -> Set minimum waiting time (Timers cannot wait for a delay of 0);
          :Temp3 = 1;
          :Temp4 = 0;
        endif
      endif
    endif
  endif
else
  ->no -> Calculate this commutation time;
  :Temp4 = TMR2L;
  :Temp5 = TMR2H;
  :Temp6 = Timer2_X;
  ->Store timestamp as previous commutation;
  :Prev_Comm_L = Temp1;
  :Prev_Comm_H = Temp2;
  :Prev_Comm_X = Temp3;
  ->Calculate the new commutation time;
  :CARRY_BIT = 0;
  :A = Temp1;
  :A = A - (Temp4 + CARRY_BIT);
  :A = Temp2;
  :A = A - (Temp5 + CARRY_BIT);
  :A = Temp3;
  :A = A - (Temp6 + CARRY_BIT);
  if (MCU_48MHZ == 1) then
    :A = A & 0x7F;
  endif
  ->Check extended byte is 0;
  if (A != 0) then
    ->yes -> Extended byte is not zero,
    so commutation time is above 0xFFFF;
    :Comm_Period4x_L = 0xFF;
    :Comm_Period4x_H = 0xFF;
  else
    ->no -> Extended byte = 0, so
    commutation time fits within two bytes;
    :Temp7 = Prev_Prev_Comm_L;
    :Temp8 = Prev_Prev_Comm_H;
    ->Update Prev_Prev_Comm times;
    :Prev_Prev_Comm_L = Temp4;
    :Prev_Prev_Comm_H = Temp5;
    ->Calculate the new commutation time
    based upon the two last
    commutations (to reduce sensitivity to offset);
    :CARRY_BIT = 0;
    :A = Temp1;
    :A = A - (Temp7 + CARRY_BIT);
    :Temp1 = A;
    :A = Temp2;
    :A = A - (Temp8 + CARRY_BIT);
    :Temp2 = A;
    ->Comm_Period4x holds the time of
    4 commutations;
    :Temp3 = Comm_Period4x_L;
    :Temp4 = Comm_Period4x_H;
    
    ->(calc_next_comm_div_4_1);
    :TDivide_By_4	Temp4, Temp3, Temp6, Temp5;
    
    ->(calc_next_comm_average_and_update)
    Comm_Period4x = 
        Comm_Period4x - (Comm_Period4x / (16, 8 or 4)) +
        (Comm_Period / (4, 2 or 1))
	Temp6/5: Comm_Period4x divided by (16, 8 or 4)
	Subtract a fraction;
    :CARRI_BIT = 0;
    ->Comm_Period4x_L;
    :A = Temp3;
    :A = A - (Temp5 + CARRY_BIT);
    :Temp3 = A;
    ->Comm_Period4x_H;
    :A = Temp4;
    :A = A - (Temp4 + CARRY_BIT);
    :Temp4 = A;
    ->Temp2/1: This commutation period divided by (4, 2 or 1);
	:A = Temp3;
	:A = A + Temp1;
	:Comm_Period4x_L = A;
	:A = Temp4;
	:A = A + Temp2 + CARRY_BIT;
	:Comm_Period4x_H = A;   
	->Is period larger than 0xffff?;
	if (CARRY_BIT == 1) then
	  ->Yes -> Set commutation period registers to very slow timing (0xffff);
	  :Comm_Period4x_L = 0xFF;
	  :Comm_Period4x_H = 0xFF;
	endif
  endif
  
  ->(calc_next_comm_done)
  Is Comm_Period4x_H below 2? (above ~160k erpm);
  :CARRY_BIT = 0;
  :A = Comm_Period4x_H;
  :A = A - 2;
  ->Is Comm_Period4x_H below 2? (above ~160k erpm, CARRY_BIT is 1);
  if (CARRY_BIT == 1) then
    ->yes -> Set high rpm flag;
    :Flag_High_Rpm = 1;
  endif
  	
  ->(calc_next_comm_15deg)
  - Commutation period: 
      360 deg / 6 runs = 60 deg
      60 deg / 4 = 15 deg
  - Load current commutation timing and
    compute 15 deg timing
  - Divide Comm_Period4x by 16 
    (Comm_Period1x divided by 4)
    and store in Temp4/3;
  :Divide_By_16	Comm_Period4x_H, Comm_Period4x_L, Temp4, Temp3;
  ->Subtract timing reduction;
  :CARRY_BIT = 0;
  :A = Temp3;
  :A = A - (2 + CARRY_BIT);
  :Temp3 = A;
  :A = Temp4;
  :A = A - (0 + CARRY_BIT);
  :Temp4 = A;
  ->Check that result is still positive
    (Temp4::Temp3 < 0);
  if (CARRY_BIT == 1) then
    ->yes -> Set minimum waiting time (Timers cannot wait for a delay of 0);
    :Temp3 = 1;
    :Temp4 = 0;
  else
    if (A == 0) then
      ->yes -> Check Temp3 is 0;
      :A = Temp3;
      ->Check Temp4::Temp3 is 0;
      if (A == 0) then
        ->yes -> Set minimum waiting time (Timers cannot wait for a delay of 0);
        :Temp3 = 1;
        :Temp4 = 0;
      endif
    endif
  endif
endif
->(wait_advance_timing)
Wait advance timing
Waits for the advance timing to elapse
NOTE: Be VERY careful if using temp registers. 
They are passed over this routine
If it has not already, we wait here for the 
Wt_Adv_Start_ delay to elapse.;
:Wait_For_Timer3;
->At this point Timer3 has (already) wrapped 
and been reloaded with the Wt_Zc_Scan_Start_ 
delay.
In case this delay has also elapsed, Timer3 
has been reloaded with a short delay any 
number of times.
- The interrupt flag is set and the pending 
flag will clear immediately after enabling 
the interrupt.
Setup next wait time;
:TMR3RLL = Wt_ZC_Tout_Start_L;
:TMR3RLH = Wt_ZC_Tout_Start_H;
:Flag_Timer3_Pending = 1;
:EIE1 = EIE1 | 0x80;
->(calc_new_wait_times)
Calculate new wait times
Load commutation timing setting;
:Temp1 = &Pgm_Comm_Timing;
:A = *Temp1;
->Store in Temp8;
:Temp8 = A;

:CARRY_BIT = 0;
:A = 0;
->Negate;
:A = A - (Temp3 + CARRY_BIT);
:Temp1 = A;
:A = 0;
:A = A - (Temp4 + CARRY_BIT);
:Temp2 = A;
if (MCU_48MHZ == 1) then
  :CARRY_BIT = 0;
  ->Multiply by 2;
  :Temp1 = Temp1::CARRY_BIT << 1;
  :Temp2 = Temp2::CARRY_BIT << 1;
endif
->Temp2/1 = 15deg Timer2 period
Branch if high rpm;
if (Flag_High_Rpm == 1) then
  ->yes ->
  (calc_new_wait_times_fast)
  Calculate new wait times fast routine
  Copy values;
  :A = Temp1;
  :Temp3 = A;
  ->Negative numbers - set carry;
  :CARRY_BIT = 1;
  ->Divide by 2;
  :A = CARRY_BIT::A >> 1;
  :Temp5 = A;
  ->Use this value for zero cross scan delay (7.5deg);
  :Wt_Zc_Scan_Start_L = Temp5;
  ->Set 15deg time for zero cross scan timeout;
  :Wt_Zc_Tout_Start_L = Temp1;
  :CARRY_BIT = 0;
  ->(Temp8 has Pgm_Comm_Timing);
  :A = Temp8;
  ->Is timing normal?;
  :A = A - (Temp3 + CARRY_BIT);
  
  if (A == 0) then
  	->(store_times_decrease_fast)
  	Yes - branch
  	Now commutation time (~60deg) divided by 4 (~15deg nominal);
  	:Wt_Comm_Start_L = Temp1;
  	->New commutation advance time (~15deg nominal);
  	:Wt_Adv_Start_L = Temp3;
  else
  	->no;
  	:A = Temp8;
  	->If an odd number - branch;
  	if (A.0 == 1) then
  	  ->(adjust_timing_two_steps_fast)
  	  Add 15deg and store in Temp1;
  	  :A = Temp1;
  	  :A = A + Temp1;
  	  :A = A + 1;
  	  :Temp1 = A;
  	  ->Store minimum time in Temp3;
  	  :Temp3 = Temp3 - 1;
  	else
  	  ->no -> Add 7.5deg and store in Temp1;
  	  :A = Temp1;
  	  :A = A + Temp5;
  	  :Temp1 = A;
  	  ->Store 7.5deg in Temp3;
  	  :A = Temp5;
  	  :Temp3 = A;
  	endif
  	
  	->(store_times_up_or_down_fast);
  	:CARRY_BIT = 0;
  	:A = Temp8;
  	->Is timing higher than normal?;
  	:A = A - (3 + CARRY_BIT);
  	if (CARRY_BIT == 1) then
  	  ->yes -> (store_times_decrease_fast)
      Now commutation time (~60deg) divided by 4 (~15deg nominal);
      :Wt_Comm_Start_L = Temp1;
      ->New commutation advance time (~15deg nominal);
      :Wt_Adv_Start_L = Temp3;
  	else
  	  ->no -> (store_times_increase_fast)
      Now commutation time (~60deg) divided by 4 (~15deg nominal);
      :Wt_Comm_Start_L = Temp3;
      ->New commutation advance time (~15deg nominal);
      :Wt_Adv_Start_L = Temp1;
  	endif
  	
  endif
else
  ->no -> Load programmed commutation timing;
  if (Flag_Startup_Phase == 0) then
  	->yes
  	(adjust_comm_timing)
  	Adjust commutation timing according to demag metric;
  	:CARRY_BIT = 0;
  	->Check demag metric;
  	:A = Demag_Detected_Metric;
  	:A = A - (130 + CARRY_BIT);
  	if (CARRY_BIT == 0) then
  	  ->yes -> Increase timing (if metric 130 or above);
  	  :Temp8 = Temp8 + 1;
  	  ->Increase timing again (if metric 160 or above);
  	  :A = A - (30 + CARRY_BIT);
  	  if (CARRY_BIT == 0) then
  	    :Temp8 = Temp8 + 1;
  	  endif
  	  ->Limit timing to max;
  	  :CARRY_BIT = 0;
  	  :A = Temp8;
  	  :A = A - (6 + CARRY_BIT);
  	  if (CARRY_BIT == 0) then
  	    :Temp8 = 5;
  	  endif
  	endif
  else
    ->no -> Set dedicated timing during startup;
    :Temp8 = 3;
  endif
  
  ->(load_comm_timing_done)
  Copy values;
  :A = Temp1;
  :Temp3 = A;
  :A = Temp2;
  :Temp4 = A;
  ->Negative numbers - set carry
  Store 7.5deg in Temp5/6 (15deg / 2);
  :CARRY_BIT = 1;
  :A = Temp2;
  :A = CARRY_BIT::A >> 1;
  :Temp6 = A;
  :A = Temp1;
  :A = CARRY_BIT::A >> 1;
  :Temp5 = A;
  ->Set 7.5deg time for zero cross scan delay;
  :Wt_Zc_Scan_Start_L = Temp5;
  :Wt_Zc_Scan_Start_H = Temp6;
  ->Set 15deg time for zero cross scan timeout;
  :Wt_Zc_Tout_Start_L = Temp1;
  :Wt_Zc_Tout_Start_H = Temp2;
  ->(Temp8 has Pgm_Comm_Timing)
    Is timing normal?
    Yes - branch;
  :CARRY_BIT = 0;
  :A = Temp8;
  :A = A - (3 + CARRY_BIT);
  if (A == 0) then
    ->yes
    (store_times_decrease)
    Now commutation time (~60deg)
    divided by 4 (~15deg nominal);
    :Wt_Comm_Start_L = Temp1;
    :Wt_Comm_Start_H = Temp2;
    ->New commutation advance
    time (~15deg nominal);
    :Wt_Adv_Start_L = Temp3;
    :Wt_Adv_Start_H = Temp4;
    ->Set very short delays for
    all but advance time during
    startup, in order to widen
    zero cross capture range;
    if (Flag_Startup_Phase == 1) then (yes)
      :Wt_Comm_Start_L = -16;
      :Wt_Comm_Start_H = -1;
      :Wt_Zc_Scan_Start_L = -16;
      :Wt_Zc_Scan_Start_H = -1;
      :Wt_Zc_Tout_Start_L = -16;
      :Wt_Zc_Tout_Start_H = -1;
    endif
  else
    ->no -> If an odd number - branch;
    :A = Temp8;
    if (A.0 == 1) then
      ->yes ->
      (adjust_timing_two_steps)
      Commutation timing setting is 1 or 5
      Store 30deg in Temp1/2 (15deg + 15deg)
      Add 1 to final result (Temp1/2 * 2 + 1);
      :A = Temp1;
      :CARRY_BIT = 1;
      :A = A + (Temp1 + CARRY_BIT);
      :Temp1 = A;
      :A = Temp2;
      :A = A + (Temp2 + CARRY_BIT);
      :Temp2 = A;
      ->Store minimum time (0deg) in Temp3/4;
      :Temp3 = -1;
      :Temp4 = -1;
    else
      ->no -> Commutation timing setting is 2 or 4
      Store 22.5deg in Temp1/2 (15deg + 7.5deg);
      :A = Temp1;
      :A = A + Temp5;
      :Temp1 = A;
      :A = Temp2;
      :A = A + (Temp6 + CARRY_BIT);
      :Temp2 = A;
      :A = Temp5;
      :Temp3 = A;
      :A = Temp6;
      :Temp4 = A;
    endif
    
    ->(store_times_up_or_down)
    Is timing higher than normal?;
    :CARRY_BIT = 0;
    :A = Temp8;
    :A = A - (3 + CARRY_BIT);
    if (CARRY_BIT == 1) then
      ->yes ->
      (store_times_decrease)
      Now commutation time (~60deg)
      divided by 4 (~15deg nominal);
      :Wt_Comm_Start_L = Temp1;
      :Wt_Comm_Start_H = Temp2;
      ->New commutation advance
      time (~15deg nominal);
      :Wt_Adv_Start_L = Temp3;
      :Wt_Adv_Start_H = Temp4;
      ->Set very short delays for
      all but advance time during
      startup, in order to widen
      zero cross capture range;
      if (Flag_Startup_Phase == 1) then (yes)
        :Wt_Comm_Start_L = -16;
        :Wt_Comm_Start_H = -1;
        :Wt_Zc_Scan_Start_L = -16;
        :Wt_Zc_Scan_Start_H = -1;
        :Wt_Zc_Tout_Start_L = -16;
        :Wt_Zc_Tout_Start_H = -1;
      endif
    else
      ->no ->
      (store_times_increase)
      Now commutation time (~60deg)
      divided by 4 (~15deg nominal);
      :Wt_Comm_Start_L = Temp3;
      :Wt_Comm_Start_H = Temp4;
      ->New commutation advance time
      (~15deg nominal);
      :Wt_Adv_Start_L = Temp1;
      :Wt_Adv_Start_H = Temp2;
    endif
  endif
endif
->(wait_before_zc_scan)
Wait before zero cross scan
Waits for the zero cross scan wait time to elapse
If it has not already, we wait here for the Wt_Zc_Scan_Start_ delay to elapse.;
:Wait_For_Timer3;
->At this point Timer3 has (already) wrapped and been reloaded with the Wt_ZC_Tout_Start_ delay.
In case this delay has also elapsed, Timer3 has been reloaded with a short delay any number of times.
- The interrupt flag is set and the pending flag will clear immediately after enabling the interrupt.;
:Startup_Zc_Timeout_Cntd = 2;
:Flag_Timer3_Pending = 1;
->Enable Timer3 interrupts;
:EIE1 = EIE1 | 0x80;
if (Flag_Initial_Run_Phase == 1) then
  ->yes -> Set long timeout when starting;
  :Temp1 = Comm_Period4x_L;
  :Temp2 = Comm_Period4x_H;
  :CARRY_BIT = 0;
  :Temp2 = CARRY_BIT::Temp2 >> 1;
  :Temp1 = CARRY_BIT::Temp1 >> 1;
  if (MCU_48MHZ == 0) then
    :CARRY_BIT = 0;
    :Temp2 = CARRY_BIT::Temp2 >> 1;
    :Temp1 = CARRY_BIT::Temp1 >> 1;
  endif
  if (Flag_Startup_Phase == 1) then
    ->Increase timeout somewhat to avoid false wind up;
    :A = Temp2;
    :A = A + 40;
    :Temp2 = A;
  endif
  ->Disable Timer3 interrupts;
  :IE_EA = 0;
  :EIE1 = EIE1 & 0x7F;
  ->Timer3 disabled and interrupt flag cleared;
  :TMR3CN0 = 0;
  ->Set timeout;
  :CARRY_BIT = 0;
  :A = 0;
  :A = A - (Temp1 + CARRY_BIT);
  :TMR3L = A;
  :A = 0;
  :A = A - (Temp2 + CARRY_BIT);
  :TMR3H = A;
  ->Timer3 enabled and interrupt flag cleared;
  :TMR3CN0 = 0x04;
  :Flag_Timer3_Pending = 1;
  ->Enable Timer3 interrupts;
  :EIE1 = EIE1 | 0x80;
  :IE_EA = 1;
endif
:ret;
stop
@enduml

PlantUML version 1.2022.6(Tue Jun 21 17:34:49 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>